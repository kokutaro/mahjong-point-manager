
> mahjong-point-manager@0.1.0 test:coverage
> jest --coverage

PASS src/components/__tests__/ErrorDisplay.test.tsx
  ‚óè Console

    console.error
      Error: Not implemented: navigation (except hash changes)
          at reload (src/components/ErrorDisplay.tsx:250:48)
          at click (src/components/__tests__/ErrorDisplay.test.tsx:442:30)
          at Object.toThrow (src/components/__tests__/ErrorDisplay.test.tsx:442:55)
          at new Promise (<anonymous>) {
        type: 'not implemented'
      }

      248 |             {errorInfo.type === "server" && (
      249 |               <button
    > 250 |                 onClick={() => window.location.reload()}
          |                                                ^
      251 |                 className="px-3 py-1.5 bg-white bg-opacity-70 hover:bg-opacity-90 rounded text-xs font-medium border border-current border-opacity-30 transition-all"
      252 |               >
      253 |                 „Éö„Éº„Ç∏„ÇíÂÜçË™≠„ÅøËæº„Åø

      at VirtualConsole.<anonymous> (node_modules/@jest/environment-jsdom-abstract/build/index.js:78:23)
      at module.exports (node_modules/jsdom/lib/jsdom/browser/not-implemented.js:12:26)
      at navigateFetch (node_modules/jsdom/lib/jsdom/living/window/navigation.js:77:3)
      at exports.navigate (node_modules/jsdom/lib/jsdom/living/window/navigation.js:55:3)
      at LocationImpl.reload (node_modules/jsdom/lib/jsdom/living/window/Location-impl.js:225:5)
      at Location.reload (node_modules/jsdom/lib/jsdom/living/generated/Location.js:102:36)
      at reload (src/components/ErrorDisplay.tsx:250:48)
      at HTMLUnknownElement.callCallback (node_modules/react-dom/cjs/react-dom.development.js:4164:14)
      at HTMLUnknownElement.callTheUserObjectsOperation (node_modules/jsdom/lib/jsdom/living/generated/EventListener.js:26:30)
      at innerInvokeEventListeners (node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:350:25)
      at invokeEventListeners (node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:286:3)
      at HTMLUnknownElementImpl._dispatch (node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:233:9)
      at HTMLUnknownElementImpl.dispatchEvent (node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:104:17)
      at HTMLUnknownElement.dispatchEvent (node_modules/jsdom/lib/jsdom/living/generated/EventTarget.js:241:34)
      at Object.invokeGuardedCallbackDev (node_modules/react-dom/cjs/react-dom.development.js:4213:16)
      at invokeGuardedCallback (node_modules/react-dom/cjs/react-dom.development.js:4277:31)
      at invokeGuardedCallbackAndCatchFirstError (node_modules/react-dom/cjs/react-dom.development.js:4291:25)
      at executeDispatch (node_modules/react-dom/cjs/react-dom.development.js:9041:3)
      at processDispatchQueueItemsInOrder (node_modules/react-dom/cjs/react-dom.development.js:9073:7)
      at processDispatchQueue (node_modules/react-dom/cjs/react-dom.development.js:9086:5)
      at dispatchEventsForPlugins (node_modules/react-dom/cjs/react-dom.development.js:9097:3)
      at node_modules/react-dom/cjs/react-dom.development.js:9288:12
      at batchedUpdates$1 (node_modules/react-dom/cjs/react-dom.development.js:26179:12)
      at batchedUpdates (node_modules/react-dom/cjs/react-dom.development.js:3991:12)
      at dispatchEventForPluginEventSystem (node_modules/react-dom/cjs/react-dom.development.js:9287:3)
      at dispatchEventWithEnableCapturePhaseSelectiveHydrationWithoutDiscreteEventReplay (node_modules/react-dom/cjs/react-dom.development.js:6465:5)
      at dispatchEvent (node_modules/react-dom/cjs/react-dom.development.js:6457:5)
      at dispatchDiscreteEvent (node_modules/react-dom/cjs/react-dom.development.js:6430:5)
      at HTMLDivElement.callTheUserObjectsOperation (node_modules/jsdom/lib/jsdom/living/generated/EventListener.js:26:30)
      at innerInvokeEventListeners (node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:350:25)
      at invokeEventListeners (node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:286:3)
      at HTMLButtonElementImpl._dispatch (node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:233:9)
      at HTMLButtonElementImpl.dispatchEvent (node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:104:17)
      at HTMLButtonElement.dispatchEvent (node_modules/jsdom/lib/jsdom/living/generated/EventTarget.js:241:34)
      at node_modules/@testing-library/dom/dist/events.js:19:20
      at node_modules/@testing-library/react/dist/pure.js:108:16
      at node_modules/@testing-library/react/dist/act-compat.js:48:24
      at act (node_modules/react/cjs/react.development.js:2512:16)
      at node_modules/@testing-library/react/dist/act-compat.js:47:25
      at Object.eventWrapper (node_modules/@testing-library/react/dist/pure.js:107:28)
      at fireEvent (node_modules/@testing-library/dom/dist/events.js:12:35)
      at Function.fireEvent.<computed> [as click] (node_modules/@testing-library/dom/dist/events.js:110:36)
      at Function.fireEvent.<computed> [as click] (node_modules/@testing-library/react/dist/fire-event.js:15:52)
      at click (src/components/__tests__/ErrorDisplay.test.tsx:442:30)
      at Object.<anonymous> (node_modules/expect/build/index.js:1824:9)
      at Object.throwingMatcher [as toThrow] (node_modules/expect/build/index.js:2231:93)
      at Object.toThrow (src/components/__tests__/ErrorDisplay.test.tsx:442:55)

PASS src/hooks/__tests__/useSocket.test.ts
  ‚óè Console

    console.log
      WebSocket connected: s1

      at EventEmitter.log (src/hooks/useSocket.ts:84:17)

    console.log
      Received game state in useSocket: {
        gameId: 'game123',
        players: [
          {
            playerId: 'player1',
            name: '„Éó„É¨„Ç§„É§„Éº1',
            position: 0,
            points: 25000,
            isReach: false,
            isConnected: true
          }
        ],
        currentRound: 1,
        currentOya: 0,
        honba: 0,
        kyotaku: 0,
        gamePhase: 'playing'
      }

      at Object.log [as gameState] (src/hooks/useSocket.ts:119:17)

    console.log
      Player connected: {
        playerId: 'player1',
        name: '„Éó„É¨„Ç§„É§„Éº1',
        gameState: {
          gameId: 'game123',
          players: [],
          currentRound: 1,
          currentOya: 0,
          honba: 0,
          kyotaku: 0,
          gamePhase: 'playing'
        }
      }

      at Object.log [as playerConnected] (src/hooks/useSocket.ts:124:17)

    console.log
      Player joined event in useSocket: {
        playerId: 'player2',
        name: '„Éó„É¨„Ç§„É§„Éº2',
        gameState: {
          gameId: 'game123',
          players: [],
          currentRound: 1,
          currentOya: 0,
          honba: 0,
          kyotaku: 0,
          gamePhase: 'waiting'
        }
      }

      at Object.log [as playerJoined] (src/hooks/useSocket.ts:165:17)

    console.log
      Score updated in useSocket: {
        gameId: 'game123',
        winnerId: 'player1',
        han: 3,
        fu: 30,
        gameState: {
          gameId: 'game123',
          players: [],
          currentRound: 2,
          currentOya: 1,
          honba: 0,
          kyotaku: 0,
          gamePhase: 'playing'
        }
      }

      at Object.log [as scoreUpdated] (src/hooks/useSocket.ts:131:17)

    console.log
      Riichi declared in useSocket: {
        gameId: 'game123',
        playerId: 'player1',
        gameState: {
          gameId: 'game123',
          players: [],
          currentRound: 1,
          currentOya: 0,
          honba: 0,
          kyotaku: 1,
          gamePhase: 'playing'
        }
      }

      at Object.log [as riichiDeclared] (src/hooks/useSocket.ts:138:17)

    console.log
      Ryukyoku in useSocket: {
        gameId: 'game123',
        reason: '‰πùÁ®Æ‰πùÁâå',
        tenpaiPlayers: [ 'player1' ],
        gameState: {
          gameId: 'game123',
          players: [],
          currentRound: 2,
          currentOya: 0,
          honba: 1,
          kyotaku: 0,
          gamePhase: 'playing'
        }
      }

      at Object.log [as ryukyoku] (src/hooks/useSocket.ts:145:17)

    console.log
      Seat order updated in useSocket: {
        gameState: {
          gameId: 'game123',
          players: [],
          currentRound: 1,
          currentOya: 0,
          honba: 0,
          kyotaku: 0,
          gamePhase: 'waiting'
        }
      }

      at Object.log [as seatOrderUpdated] (src/hooks/useSocket.ts:152:17)

    console.error
      WebSocket connection error: Error: Connection failed
          at /Users/nyanpass/source/repos/mahjong-point-manager/src/hooks/__tests__/useSocket.test.ts:329:40
          at /Users/nyanpass/source/repos/mahjong-point-manager/node_modules/@testing-library/react/dist/act-compat.js:48:24
          at act (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/react/cjs/react.development.js:2512:16)
          at /Users/nyanpass/source/repos/mahjong-point-manager/node_modules/@testing-library/react/dist/act-compat.js:47:25
          at Object.<anonymous> (/Users/nyanpass/source/repos/mahjong-point-manager/src/hooks/__tests__/useSocket.test.ts:328:10)
          at Promise.finally.completed (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/jestAdapterInit.js:1559:28)
          at new Promise (<anonymous>)
          at callAsyncCircusFn (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/jestAdapterInit.js:1499:10)
          at _callCircusTest (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/jestAdapterInit.js:1009:40)
          at processTicksAndRejections (node:internal/process/task_queues:105:5)
          at _runTest (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/jestAdapterInit.js:949:3)
          at _runTestsForDescribeBlock (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/jestAdapterInit.js:839:13)
          at _runTestsForDescribeBlock (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/jestAdapterInit.js:829:11)
          at _runTestsForDescribeBlock (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/jestAdapterInit.js:829:11)
          at run (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/jestAdapterInit.js:757:3)
          at runAndTransformResultsToJestFormat (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/jestAdapterInit.js:1920:21)
          at jestAdapter (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/runner.js:101:19)
          at runTestInternal (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-runner/build/testWorker.js:272:16)
          at runTest (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-runner/build/testWorker.js:340:7)
          at Object.worker (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-runner/build/testWorker.js:494:12)

      105 |
      106 |       const handleConnectError = (error: SocketIOError) => {
    > 107 |         console.error("WebSocket connection error:", error)
          |                 ^
      108 |         setIsConnected(false)
      109 |         setError("Êé•Á∂ö„Ç®„É©„Éº„ÅåÁô∫Áîü„Åó„Åæ„Åó„Åü„ÄÇÂÜçÊé•Á∂ö„ÇíË©¶Ë°å‰∏≠...")
      110 |         reconnect()

      at EventEmitter.error (src/hooks/useSocket.ts:107:17)
      at emit (src/hooks/__tests__/useSocket.test.ts:329:18)
      at node_modules/@testing-library/react/dist/act-compat.js:48:24
      at act (node_modules/react/cjs/react.development.js:2512:16)
      at node_modules/@testing-library/react/dist/act-compat.js:47:25
      at Object.<anonymous> (src/hooks/__tests__/useSocket.test.ts:328:10)

    console.error
      WebSocket error: { message: '‰Ωï„Çâ„Åã„ÅÆ„Ç®„É©„Éº„ÅåÁô∫Áîü„Åó„Åæ„Åó„Åü', code: 'ERROR_CODE' }

      112 |
      113 |       const handleError = (error: SocketError) => {
    > 114 |         console.error("WebSocket error:", error)
          |                 ^
      115 |         setError(error.message || "ÈÄö‰ø°„Ç®„É©„Éº„ÅåÁô∫Áîü„Åó„Åæ„Åó„Åü")
      116 |       }
      117 |

      at Object.error (src/hooks/useSocket.ts:114:17)
      at src/hooks/__tests__/useSocket.test.ts:350:40
      at node_modules/@testing-library/react/dist/act-compat.js:48:24
      at act (node_modules/react/cjs/react.development.js:2512:16)
      at node_modules/@testing-library/react/dist/act-compat.js:47:25
      at Object.<anonymous> (src/hooks/__tests__/useSocket.test.ts:349:10)

    console.error
      WebSocket error: {}

      112 |
      113 |       const handleError = (error: SocketError) => {
    > 114 |         console.error("WebSocket error:", error)
          |                 ^
      115 |         setError(error.message || "ÈÄö‰ø°„Ç®„É©„Éº„ÅåÁô∫Áîü„Åó„Åæ„Åó„Åü")
      116 |       }
      117 |

      at Object.error (src/hooks/useSocket.ts:114:17)
      at src/hooks/__tests__/useSocket.test.ts:360:40
      at node_modules/@testing-library/react/dist/act-compat.js:48:24
      at act (node_modules/react/cjs/react.development.js:2512:16)
      at node_modules/@testing-library/react/dist/act-compat.js:47:25
      at Object.<anonymous> (src/hooks/__tests__/useSocket.test.ts:359:10)

    console.log
      WebSocket disconnected: transport close

      at EventEmitter.log (src/hooks/useSocket.ts:93:17)

    console.log
      WebSocket disconnected: io client disconnect

      at EventEmitter.log (src/hooks/useSocket.ts:93:17)

    console.log
      WebSocket disconnected: io server disconnect

      at EventEmitter.log (src/hooks/useSocket.ts:93:17)

    console.log
      WebSocket disconnected: transport close

      at EventEmitter.log (src/hooks/useSocket.ts:93:17)

    console.log
      WebSocket disconnected: transport close

      at EventEmitter.log (src/hooks/useSocket.ts:93:17)

    console.log
      WebSocket disconnected: transport close

      at EventEmitter.log (src/hooks/useSocket.ts:93:17)

    console.log
      WebSocket disconnected: transport close

      at EventEmitter.log (src/hooks/useSocket.ts:93:17)

    console.log
      WebSocket disconnected: transport close

      at EventEmitter.log (src/hooks/useSocket.ts:93:17)

    console.log
      WebSocket disconnected: transport close

      at EventEmitter.log (src/hooks/useSocket.ts:93:17)

    console.log
      WebSocket disconnected: transport close

      at EventEmitter.log (src/hooks/useSocket.ts:93:17)

    console.log
      WebSocket disconnected: transport close

      at EventEmitter.log (src/hooks/useSocket.ts:93:17)

    console.log
      WebSocket disconnected: transport close

      at EventEmitter.log (src/hooks/useSocket.ts:93:17)

    console.log
      WebSocket disconnected: transport close

      at EventEmitter.log (src/hooks/useSocket.ts:93:17)

    console.log
      WebSocket disconnected: transport close

      at EventEmitter.log (src/hooks/useSocket.ts:93:17)

    console.log
      WebSocket disconnected: transport close

      at EventEmitter.log (src/hooks/useSocket.ts:93:17)

    console.log
      WebSocket disconnected: transport close

      at EventEmitter.log (src/hooks/useSocket.ts:93:17)

    console.log
      WebSocket disconnected: transport close

      at EventEmitter.log (src/hooks/useSocket.ts:93:17)

    console.log
      WebSocket disconnected: transport close

      at EventEmitter.log (src/hooks/useSocket.ts:93:17)

    console.log
      WebSocket disconnected: transport close

      at EventEmitter.log (src/hooks/useSocket.ts:93:17)

    console.log
      WebSocket disconnected: transport close

      at EventEmitter.log (src/hooks/useSocket.ts:93:17)

    console.log
      WebSocket disconnected: transport close

      at EventEmitter.log (src/hooks/useSocket.ts:93:17)

    console.log
      WebSocket disconnected: transport close

      at EventEmitter.log (src/hooks/useSocket.ts:93:17)

    console.log
      WebSocket disconnected: transport close

      at EventEmitter.log (src/hooks/useSocket.ts:93:17)

    console.log
      WebSocket disconnected: transport close

      at EventEmitter.log (src/hooks/useSocket.ts:93:17)

    console.log
      WebSocket disconnected: transport close

      at EventEmitter.log (src/hooks/useSocket.ts:93:17)

    console.log
      WebSocket disconnected: transport close

      at EventEmitter.log (src/hooks/useSocket.ts:93:17)

    console.log
      WebSocket disconnected: transport close

      at EventEmitter.log (src/hooks/useSocket.ts:93:17)

    console.log
      WebSocket disconnected: transport close

      at EventEmitter.log (src/hooks/useSocket.ts:93:17)

    console.log
      WebSocket disconnected: transport close

      at EventEmitter.log (src/hooks/useSocket.ts:93:17)

    console.log
      WebSocket disconnected: transport close

      at EventEmitter.log (src/hooks/useSocket.ts:93:17)

    console.log
      WebSocket disconnected: transport close

      at EventEmitter.log (src/hooks/useSocket.ts:93:17)

    console.log
      WebSocket disconnected: transport close

      at EventEmitter.log (src/hooks/useSocket.ts:93:17)

    console.log
      WebSocket disconnected: transport close

      at EventEmitter.log (src/hooks/useSocket.ts:93:17)

    console.log
      WebSocket disconnected: transport close

      at EventEmitter.log (src/hooks/useSocket.ts:93:17)

    console.log
      WebSocket disconnected: transport close

      at EventEmitter.log (src/hooks/useSocket.ts:93:17)

    console.log
      WebSocket disconnected: transport close

      at EventEmitter.log (src/hooks/useSocket.ts:93:17)

    console.log
      WebSocket disconnected: transport close

      at EventEmitter.log (src/hooks/useSocket.ts:93:17)

    console.log
      WebSocket disconnected: transport close

      at EventEmitter.log (src/hooks/useSocket.ts:93:17)

    console.log
      WebSocket disconnected: transport close

      at EventEmitter.log (src/hooks/useSocket.ts:93:17)

    console.log
      WebSocket disconnected: transport close

      at EventEmitter.log (src/hooks/useSocket.ts:93:17)

    console.log
      WebSocket disconnected: transport close

      at EventEmitter.log (src/hooks/useSocket.ts:93:17)

    console.log
      WebSocket disconnected: transport close

      at EventEmitter.log (src/hooks/useSocket.ts:93:17)

    console.log
      WebSocket disconnected: transport close

      at EventEmitter.log (src/hooks/useSocket.ts:93:17)

    console.log
      WebSocket disconnected: transport close

      at EventEmitter.log (src/hooks/useSocket.ts:93:17)

    console.log
      WebSocket disconnected: transport close

      at EventEmitter.log (src/hooks/useSocket.ts:93:17)

    console.log
      WebSocket disconnected: transport close

      at EventEmitter.log (src/hooks/useSocket.ts:93:17)

    console.log
      WebSocket disconnected: transport close

      at EventEmitter.log (src/hooks/useSocket.ts:93:17)

    console.log
      WebSocket disconnected: transport close

      at EventEmitter.log (src/hooks/useSocket.ts:93:17)

    console.log
      WebSocket disconnected: transport close

      at EventEmitter.log (src/hooks/useSocket.ts:93:17)

    console.log
      WebSocket disconnected: transport close

      at EventEmitter.log (src/hooks/useSocket.ts:93:17)

    console.log
      WebSocket disconnected: transport close

      at EventEmitter.log (src/hooks/useSocket.ts:93:17)

    console.log
      WebSocket disconnected: transport close

      at EventEmitter.log (src/hooks/useSocket.ts:93:17)

    console.log
      WebSocket disconnected: transport close

      at EventEmitter.log (src/hooks/useSocket.ts:93:17)

    console.log
      WebSocket disconnected: transport close

      at EventEmitter.log (src/hooks/useSocket.ts:93:17)

    console.log
      WebSocket disconnected: transport close

      at EventEmitter.log (src/hooks/useSocket.ts:93:17)

    console.log
      WebSocket disconnected: transport close

      at EventEmitter.log (src/hooks/useSocket.ts:93:17)

    console.log
      WebSocket disconnected: transport close

      at EventEmitter.log (src/hooks/useSocket.ts:93:17)

    console.log
      WebSocket disconnected: transport close

      at EventEmitter.log (src/hooks/useSocket.ts:93:17)

    console.log
      WebSocket disconnected: transport close

      at EventEmitter.log (src/hooks/useSocket.ts:93:17)

    console.log
      WebSocket disconnected: transport close

      at EventEmitter.log (src/hooks/useSocket.ts:93:17)

    console.log
      WebSocket disconnected: transport close

      at EventEmitter.log (src/hooks/useSocket.ts:93:17)

    console.log
      WebSocket disconnected: transport close

      at EventEmitter.log (src/hooks/useSocket.ts:93:17)

    console.log
      WebSocket disconnected: transport close

      at EventEmitter.log (src/hooks/useSocket.ts:93:17)

    console.log
      WebSocket disconnected: transport close

      at EventEmitter.log (src/hooks/useSocket.ts:93:17)

    console.log
      WebSocket disconnected: transport close

      at EventEmitter.log (src/hooks/useSocket.ts:93:17)

    console.log
      WebSocket disconnected: transport close

      at EventEmitter.log (src/hooks/useSocket.ts:93:17)

    console.log
      WebSocket disconnected: transport close

      at EventEmitter.log (src/hooks/useSocket.ts:93:17)

    console.log
      WebSocket disconnected: transport close

      at EventEmitter.log (src/hooks/useSocket.ts:93:17)

    console.log
      WebSocket disconnected: transport close

      at EventEmitter.log (src/hooks/useSocket.ts:93:17)

    console.log
      WebSocket disconnected: transport close

      at EventEmitter.log (src/hooks/useSocket.ts:93:17)

    console.log
      WebSocket disconnected: transport close

      at EventEmitter.log (src/hooks/useSocket.ts:93:17)

    console.log
      WebSocket disconnected: transport close

      at EventEmitter.log (src/hooks/useSocket.ts:93:17)

    console.log
      WebSocket disconnected: transport close

      at EventEmitter.log (src/hooks/useSocket.ts:93:17)

    console.log
      WebSocket disconnected: transport close

      at EventEmitter.log (src/hooks/useSocket.ts:93:17)

    console.log
      WebSocket disconnected: transport close

      at EventEmitter.log (src/hooks/useSocket.ts:93:17)

    console.log
      WebSocket disconnected: transport close

      at EventEmitter.log (src/hooks/useSocket.ts:93:17)

    console.log
      WebSocket disconnected: transport close

      at EventEmitter.log (src/hooks/useSocket.ts:93:17)

    console.log
      WebSocket disconnected: transport close

      at EventEmitter.log (src/hooks/useSocket.ts:93:17)

    console.log
      WebSocket disconnected: transport close

      at EventEmitter.log (src/hooks/useSocket.ts:93:17)

    console.log
      WebSocket disconnected: transport close

      at EventEmitter.log (src/hooks/useSocket.ts:93:17)

    console.log
      WebSocket disconnected: transport close

      at EventEmitter.log (src/hooks/useSocket.ts:93:17)

    console.log
      WebSocket disconnected: transport close

      at EventEmitter.log (src/hooks/useSocket.ts:93:17)

    console.log
      WebSocket disconnected: transport close

      at EventEmitter.log (src/hooks/useSocket.ts:93:17)

    console.log
      WebSocket disconnected: transport close

      at EventEmitter.log (src/hooks/useSocket.ts:93:17)

    console.log
      WebSocket disconnected: transport close

      at EventEmitter.log (src/hooks/useSocket.ts:93:17)

    console.log
      WebSocket disconnected: transport close

      at EventEmitter.log (src/hooks/useSocket.ts:93:17)

    console.log
      WebSocket disconnected: transport close

      at EventEmitter.log (src/hooks/useSocket.ts:93:17)

    console.log
      WebSocket disconnected: transport close

      at EventEmitter.log (src/hooks/useSocket.ts:93:17)

    console.log
      WebSocket disconnected: transport close

      at EventEmitter.log (src/hooks/useSocket.ts:93:17)

    console.log
      WebSocket disconnected: transport close

      at EventEmitter.log (src/hooks/useSocket.ts:93:17)

    console.log
      WebSocket disconnected: transport close

      at EventEmitter.log (src/hooks/useSocket.ts:93:17)

    console.log
      WebSocket disconnected: transport close

      at EventEmitter.log (src/hooks/useSocket.ts:93:17)

    console.log
      WebSocket disconnected: transport close

      at EventEmitter.log (src/hooks/useSocket.ts:93:17)

    console.log
      WebSocket disconnected: transport close

      at EventEmitter.log (src/hooks/useSocket.ts:93:17)

    console.log
      WebSocket disconnected: transport close

      at EventEmitter.log (src/hooks/useSocket.ts:93:17)

    console.log
      WebSocket disconnected: transport close

      at EventEmitter.log (src/hooks/useSocket.ts:93:17)

    console.log
      WebSocket disconnected: transport close

      at EventEmitter.log (src/hooks/useSocket.ts:93:17)

    console.log
      WebSocket disconnected: transport close

      at EventEmitter.log (src/hooks/useSocket.ts:93:17)

    console.log
      WebSocket disconnected: transport close

      at EventEmitter.log (src/hooks/useSocket.ts:93:17)

    console.log
      WebSocket disconnected: transport close

      at EventEmitter.log (src/hooks/useSocket.ts:93:17)

    console.log
      WebSocket disconnected: transport close

      at EventEmitter.log (src/hooks/useSocket.ts:93:17)

    console.log
      WebSocket disconnected: transport close

      at EventEmitter.log (src/hooks/useSocket.ts:93:17)

    console.log
      WebSocket disconnected: transport close

      at EventEmitter.log (src/hooks/useSocket.ts:93:17)

    console.log
      WebSocket disconnected: transport close

      at EventEmitter.log (src/hooks/useSocket.ts:93:17)

    console.log
      WebSocket disconnected: transport close

      at EventEmitter.log (src/hooks/useSocket.ts:93:17)

    console.log
      WebSocket disconnected: transport close

      at EventEmitter.log (src/hooks/useSocket.ts:93:17)

    console.log
      WebSocket disconnected: transport close

      at EventEmitter.log (src/hooks/useSocket.ts:93:17)

    console.log
      WebSocket disconnected: transport close

      at EventEmitter.log (src/hooks/useSocket.ts:93:17)

    console.log
      WebSocket disconnected: transport close

      at EventEmitter.log (src/hooks/useSocket.ts:93:17)

    console.log
      WebSocket connected: s1

      at EventEmitter.log (src/hooks/useSocket.ts:84:17)

    console.log
      üè† joinRoom called: {
        roomCode: 'ROOM123',
        playerId: 'player1',
        isConnected: true,
        socketConnected: true
      }

      at Object.log [as joinRoom] (src/hooks/useSocket.ts:206:15)

    console.log
      üè† Immediately joining room via WebSocket: ROOM123 player1

      at Object.log [as joinRoom] (src/hooks/useSocket.ts:227:17)

    console.log
      üè† joinRoom called: {
        roomCode: 'ROOM123',
        playerId: 'player1',
        isConnected: false,
        socketConnected: false
      }

      at Object.log [as joinRoom] (src/hooks/useSocket.ts:206:15)

    console.warn
      üè† Socket not connected, delaying join room

      211 |       })
      212 |       if (!isConnected || !socket?.connected) {
    > 213 |         console.warn("üè† Socket not connected, delaying join room")
          |                 ^
      214 |         setTimeout(() => {
      215 |           if (socket?.connected) {
      216 |             console.log(

      at Object.warn [as joinRoom] (src/hooks/useSocket.ts:213:17)
      at joinRoom (src/hooks/__tests__/useSocket.test.ts:507:24)
      at node_modules/@testing-library/react/dist/act-compat.js:48:24
      at act (node_modules/react/cjs/react.development.js:2512:16)
      at node_modules/@testing-library/react/dist/act-compat.js:47:25
      at Object.<anonymous> (src/hooks/__tests__/useSocket.test.ts:506:10)

    console.log
      üè† Delayed joining room via WebSocket: ROOM123 player1

      at log (src/hooks/useSocket.ts:216:21)

    console.log
      üè† joinRoom called: {
        roomCode: 'ROOM123',
        playerId: 'player1',
        isConnected: false,
        socketConnected: false
      }

      at Object.log [as joinRoom] (src/hooks/useSocket.ts:206:15)

    console.warn
      üè† Socket not connected, delaying join room

      211 |       })
      212 |       if (!isConnected || !socket?.connected) {
    > 213 |         console.warn("üè† Socket not connected, delaying join room")
          |                 ^
      214 |         setTimeout(() => {
      215 |           if (socket?.connected) {
      216 |             console.log(

      at Object.warn [as joinRoom] (src/hooks/useSocket.ts:213:17)
      at joinRoom (src/hooks/__tests__/useSocket.test.ts:533:24)
      at node_modules/@testing-library/react/dist/act-compat.js:48:24
      at act (node_modules/react/cjs/react.development.js:2512:16)
      at node_modules/@testing-library/react/dist/act-compat.js:47:25
      at Object.<anonymous> (src/hooks/__tests__/useSocket.test.ts:532:10)

PASS src/components/__tests__/PlayerStatus.test.tsx
PASS src/components/__tests__/PointAnimation.test.tsx
  ‚óè Console

    console.error
      Warning: An update to PointAnimation inside a test was not wrapped in act(...).
      
      When testing, code that causes React state updates should be wrapped into act(...):
      
      act(() => {
        /* fire events that update state */
      });
      /* assert on the output */
      
      This ensures that you're testing the behavior the user would see in the browser. Learn more at https://reactjs.org/link/wrap-tests-with-act
          at players (/Users/nyanpass/source/repos/mahjong-point-manager/src/components/PointAnimation.tsx:21:3)

      55 |
      56 |       // „Éï„Çß„Éº„Ç∫2: „Ç´„Ç¶„É≥„Éà„Ç¢„ÉÉ„Éó/„ÉÄ„Ç¶„É≥ (800ms)
    > 57 |       setAnimationPhase("counting")
         |       ^
      58 |
      59 |       // „Ç´„Ç¶„É≥„Éà„Ç¢„ÉÉ„Éó„Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥
      60 |       const animationDuration = 800

      at printWarning (node_modules/react-dom/cjs/react-dom.development.js:86:30)
      at error (node_modules/react-dom/cjs/react-dom.development.js:60:7)
      at warnIfUpdatesNotWrappedWithActDEV (node_modules/react-dom/cjs/react-dom.development.js:27628:9)
      at scheduleUpdateOnFiber (node_modules/react-dom/cjs/react-dom.development.js:25547:5)
      at dispatchSetState (node_modules/react-dom/cjs/react-dom.development.js:16708:7)
      at setAnimationPhase (src/components/PointAnimation.tsx:57:7)

    console.error
      Warning: An update to PointAnimation inside a test was not wrapped in act(...).
      
      When testing, code that causes React state updates should be wrapped into act(...):
      
      act(() => {
        /* fire events that update state */
      });
      /* assert on the output */
      
      This ensures that you're testing the behavior the user would see in the browser. Learn more at https://reactjs.org/link/wrap-tests-with-act
          at players (/Users/nyanpass/source/repos/mahjong-point-manager/src/components/PointAnimation.tsx:21:3)

      55 |
      56 |       // „Éï„Çß„Éº„Ç∫2: „Ç´„Ç¶„É≥„Éà„Ç¢„ÉÉ„Éó/„ÉÄ„Ç¶„É≥ (800ms)
    > 57 |       setAnimationPhase("counting")
         |       ^
      58 |
      59 |       // „Ç´„Ç¶„É≥„Éà„Ç¢„ÉÉ„Éó„Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥
      60 |       const animationDuration = 800

      at printWarning (node_modules/react-dom/cjs/react-dom.development.js:86:30)
      at error (node_modules/react-dom/cjs/react-dom.development.js:60:7)
      at warnIfUpdatesNotWrappedWithActDEV (node_modules/react-dom/cjs/react-dom.development.js:27628:9)
      at scheduleUpdateOnFiber (node_modules/react-dom/cjs/react-dom.development.js:25547:5)
      at dispatchSetState (node_modules/react-dom/cjs/react-dom.development.js:16708:7)
      at setAnimationPhase (src/components/PointAnimation.tsx:57:7)

    console.error
      Warning: An update to PointAnimation inside a test was not wrapped in act(...).
      
      When testing, code that causes React state updates should be wrapped into act(...):
      
      act(() => {
        /* fire events that update state */
      });
      /* assert on the output */
      
      This ensures that you're testing the behavior the user would see in the browser. Learn more at https://reactjs.org/link/wrap-tests-with-act
          at players (/Users/nyanpass/source/repos/mahjong-point-manager/src/components/PointAnimation.tsx:21:3)

      55 |
      56 |       // „Éï„Çß„Éº„Ç∫2: „Ç´„Ç¶„É≥„Éà„Ç¢„ÉÉ„Éó/„ÉÄ„Ç¶„É≥ (800ms)
    > 57 |       setAnimationPhase("counting")
         |       ^
      58 |
      59 |       // „Ç´„Ç¶„É≥„Éà„Ç¢„ÉÉ„Éó„Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥
      60 |       const animationDuration = 800

      at printWarning (node_modules/react-dom/cjs/react-dom.development.js:86:30)
      at error (node_modules/react-dom/cjs/react-dom.development.js:60:7)
      at warnIfUpdatesNotWrappedWithActDEV (node_modules/react-dom/cjs/react-dom.development.js:27628:9)
      at scheduleUpdateOnFiber (node_modules/react-dom/cjs/react-dom.development.js:25547:5)
      at dispatchSetState (node_modules/react-dom/cjs/react-dom.development.js:16708:7)
      at setAnimationPhase (src/components/PointAnimation.tsx:57:7)

    console.error
      Warning: An update to PointAnimation inside a test was not wrapped in act(...).
      
      When testing, code that causes React state updates should be wrapped into act(...):
      
      act(() => {
        /* fire events that update state */
      });
      /* assert on the output */
      
      This ensures that you're testing the behavior the user would see in the browser. Learn more at https://reactjs.org/link/wrap-tests-with-act
          at players (/Users/nyanpass/source/repos/mahjong-point-manager/src/components/PointAnimation.tsx:21:3)

      55 |
      56 |       // „Éï„Çß„Éº„Ç∫2: „Ç´„Ç¶„É≥„Éà„Ç¢„ÉÉ„Éó/„ÉÄ„Ç¶„É≥ (800ms)
    > 57 |       setAnimationPhase("counting")
         |       ^
      58 |
      59 |       // „Ç´„Ç¶„É≥„Éà„Ç¢„ÉÉ„Éó„Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥
      60 |       const animationDuration = 800

      at printWarning (node_modules/react-dom/cjs/react-dom.development.js:86:30)
      at error (node_modules/react-dom/cjs/react-dom.development.js:60:7)
      at warnIfUpdatesNotWrappedWithActDEV (node_modules/react-dom/cjs/react-dom.development.js:27628:9)
      at scheduleUpdateOnFiber (node_modules/react-dom/cjs/react-dom.development.js:25547:5)
      at dispatchSetState (node_modules/react-dom/cjs/react-dom.development.js:16708:7)
      at setAnimationPhase (src/components/PointAnimation.tsx:57:7)

    console.error
      Warning: An update to PointAnimation inside a test was not wrapped in act(...).
      
      When testing, code that causes React state updates should be wrapped into act(...):
      
      act(() => {
        /* fire events that update state */
      });
      /* assert on the output */
      
      This ensures that you're testing the behavior the user would see in the browser. Learn more at https://reactjs.org/link/wrap-tests-with-act
          at players (/Users/nyanpass/source/repos/mahjong-point-manager/src/components/PointAnimation.tsx:21:3)

      55 |
      56 |       // „Éï„Çß„Éº„Ç∫2: „Ç´„Ç¶„É≥„Éà„Ç¢„ÉÉ„Éó/„ÉÄ„Ç¶„É≥ (800ms)
    > 57 |       setAnimationPhase("counting")
         |       ^
      58 |
      59 |       // „Ç´„Ç¶„É≥„Éà„Ç¢„ÉÉ„Éó„Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥
      60 |       const animationDuration = 800

      at printWarning (node_modules/react-dom/cjs/react-dom.development.js:86:30)
      at error (node_modules/react-dom/cjs/react-dom.development.js:60:7)
      at warnIfUpdatesNotWrappedWithActDEV (node_modules/react-dom/cjs/react-dom.development.js:27628:9)
      at scheduleUpdateOnFiber (node_modules/react-dom/cjs/react-dom.development.js:25547:5)
      at dispatchSetState (node_modules/react-dom/cjs/react-dom.development.js:16708:7)
      at setAnimationPhase (src/components/PointAnimation.tsx:57:7)

    console.error
      Warning: An update to PointAnimation inside a test was not wrapped in act(...).
      
      When testing, code that causes React state updates should be wrapped into act(...):
      
      act(() => {
        /* fire events that update state */
      });
      /* assert on the output */
      
      This ensures that you're testing the behavior the user would see in the browser. Learn more at https://reactjs.org/link/wrap-tests-with-act
          at players (/Users/nyanpass/source/repos/mahjong-point-manager/src/components/PointAnimation.tsx:21:3)

      55 |
      56 |       // „Éï„Çß„Éº„Ç∫2: „Ç´„Ç¶„É≥„Éà„Ç¢„ÉÉ„Éó/„ÉÄ„Ç¶„É≥ (800ms)
    > 57 |       setAnimationPhase("counting")
         |       ^
      58 |
      59 |       // „Ç´„Ç¶„É≥„Éà„Ç¢„ÉÉ„Éó„Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥
      60 |       const animationDuration = 800

      at printWarning (node_modules/react-dom/cjs/react-dom.development.js:86:30)
      at error (node_modules/react-dom/cjs/react-dom.development.js:60:7)
      at warnIfUpdatesNotWrappedWithActDEV (node_modules/react-dom/cjs/react-dom.development.js:27628:9)
      at scheduleUpdateOnFiber (node_modules/react-dom/cjs/react-dom.development.js:25547:5)
      at dispatchSetState (node_modules/react-dom/cjs/react-dom.development.js:16708:7)
      at setAnimationPhase (src/components/PointAnimation.tsx:57:7)

    console.error
      Warning: An update to PointAnimation inside a test was not wrapped in act(...).
      
      When testing, code that causes React state updates should be wrapped into act(...):
      
      act(() => {
        /* fire events that update state */
      });
      /* assert on the output */
      
      This ensures that you're testing the behavior the user would see in the browser. Learn more at https://reactjs.org/link/wrap-tests-with-act
          at players (/Users/nyanpass/source/repos/mahjong-point-manager/src/components/PointAnimation.tsx:21:3)

      55 |
      56 |       // „Éï„Çß„Éº„Ç∫2: „Ç´„Ç¶„É≥„Éà„Ç¢„ÉÉ„Éó/„ÉÄ„Ç¶„É≥ (800ms)
    > 57 |       setAnimationPhase("counting")
         |       ^
      58 |
      59 |       // „Ç´„Ç¶„É≥„Éà„Ç¢„ÉÉ„Éó„Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥
      60 |       const animationDuration = 800

      at printWarning (node_modules/react-dom/cjs/react-dom.development.js:86:30)
      at error (node_modules/react-dom/cjs/react-dom.development.js:60:7)
      at warnIfUpdatesNotWrappedWithActDEV (node_modules/react-dom/cjs/react-dom.development.js:27628:9)
      at scheduleUpdateOnFiber (node_modules/react-dom/cjs/react-dom.development.js:25547:5)
      at dispatchSetState (node_modules/react-dom/cjs/react-dom.development.js:16708:7)
      at setAnimationPhase (src/components/PointAnimation.tsx:57:7)

    console.error
      Warning: An update to PointAnimation inside a test was not wrapped in act(...).
      
      When testing, code that causes React state updates should be wrapped into act(...):
      
      act(() => {
        /* fire events that update state */
      });
      /* assert on the output */
      
      This ensures that you're testing the behavior the user would see in the browser. Learn more at https://reactjs.org/link/wrap-tests-with-act
          at players (/Users/nyanpass/source/repos/mahjong-point-manager/src/components/PointAnimation.tsx:21:3)

      88 |         })
      89 |
    > 90 |         setCurrentPoints(newPoints)
         |         ^
      91 |
      92 |         if (currentFrame >= totalFrames) {
      93 |           clearInterval(animationInterval)

      at printWarning (node_modules/react-dom/cjs/react-dom.development.js:86:30)
      at error (node_modules/react-dom/cjs/react-dom.development.js:60:7)
      at warnIfUpdatesNotWrappedWithActDEV (node_modules/react-dom/cjs/react-dom.development.js:27628:9)
      at scheduleUpdateOnFiber (node_modules/react-dom/cjs/react-dom.development.js:25547:5)
      at dispatchSetState (node_modules/react-dom/cjs/react-dom.development.js:16708:7)
      at setCurrentPoints (src/components/PointAnimation.tsx:90:9)
      at callTimer (node_modules/@sinonjs/fake-timers/src/fake-timers-src.js:806:24)
      at doTickInner (node_modules/@sinonjs/fake-timers/src/fake-timers-src.js:1413:29)
      at doTick (node_modules/@sinonjs/fake-timers/src/fake-timers-src.js:1494:20)
      at Object.tick (node_modules/@sinonjs/fake-timers/src/fake-timers-src.js:1502:20)
      at Object.runToLast (node_modules/@sinonjs/fake-timers/src/fake-timers-src.js:1661:26)
      at FakeTimers.runOnlyPendingTimers (node_modules/@jest/fake-timers/build/index.js:542:19)
      at Object.runOnlyPendingTimers (src/components/__tests__/PointAnimation.test.tsx:66:10)

    console.error
      Warning: An update to PointAnimation inside a test was not wrapped in act(...).
      
      When testing, code that causes React state updates should be wrapped into act(...):
      
      act(() => {
        /* fire events that update state */
      });
      /* assert on the output */
      
      This ensures that you're testing the behavior the user would see in the browser. Learn more at https://reactjs.org/link/wrap-tests-with-act
          at players (/Users/nyanpass/source/repos/mahjong-point-manager/src/components/PointAnimation.tsx:21:3)

      88 |         })
      89 |
    > 90 |         setCurrentPoints(newPoints)
         |         ^
      91 |
      92 |         if (currentFrame >= totalFrames) {
      93 |           clearInterval(animationInterval)

      at printWarning (node_modules/react-dom/cjs/react-dom.development.js:86:30)
      at error (node_modules/react-dom/cjs/react-dom.development.js:60:7)
      at warnIfUpdatesNotWrappedWithActDEV (node_modules/react-dom/cjs/react-dom.development.js:27628:9)
      at scheduleUpdateOnFiber (node_modules/react-dom/cjs/react-dom.development.js:25547:5)
      at dispatchSetState (node_modules/react-dom/cjs/react-dom.development.js:16708:7)
      at setCurrentPoints (src/components/PointAnimation.tsx:90:9)
      at callTimer (node_modules/@sinonjs/fake-timers/src/fake-timers-src.js:806:24)
      at doTickInner (node_modules/@sinonjs/fake-timers/src/fake-timers-src.js:1413:29)
      at doTick (node_modules/@sinonjs/fake-timers/src/fake-timers-src.js:1494:20)
      at Object.tick (node_modules/@sinonjs/fake-timers/src/fake-timers-src.js:1502:20)
      at Object.runToLast (node_modules/@sinonjs/fake-timers/src/fake-timers-src.js:1661:26)
      at FakeTimers.runOnlyPendingTimers (node_modules/@jest/fake-timers/build/index.js:542:19)
      at Object.runOnlyPendingTimers (src/components/__tests__/PointAnimation.test.tsx:66:10)

    console.error
      Warning: An update to PointAnimation inside a test was not wrapped in act(...).
      
      When testing, code that causes React state updates should be wrapped into act(...):
      
      act(() => {
        /* fire events that update state */
      });
      /* assert on the output */
      
      This ensures that you're testing the behavior the user would see in the browser. Learn more at https://reactjs.org/link/wrap-tests-with-act
          at players (/Users/nyanpass/source/repos/mahjong-point-manager/src/components/PointAnimation.tsx:21:3)

      88 |         })
      89 |
    > 90 |         setCurrentPoints(newPoints)
         |         ^
      91 |
      92 |         if (currentFrame >= totalFrames) {
      93 |           clearInterval(animationInterval)

      at printWarning (node_modules/react-dom/cjs/react-dom.development.js:86:30)
      at error (node_modules/react-dom/cjs/react-dom.development.js:60:7)
      at warnIfUpdatesNotWrappedWithActDEV (node_modules/react-dom/cjs/react-dom.development.js:27628:9)
      at scheduleUpdateOnFiber (node_modules/react-dom/cjs/react-dom.development.js:25547:5)
      at dispatchSetState (node_modules/react-dom/cjs/react-dom.development.js:16708:7)
      at setCurrentPoints (src/components/PointAnimation.tsx:90:9)
      at callTimer (node_modules/@sinonjs/fake-timers/src/fake-timers-src.js:806:24)
      at doTickInner (node_modules/@sinonjs/fake-timers/src/fake-timers-src.js:1413:29)
      at doTick (node_modules/@sinonjs/fake-timers/src/fake-timers-src.js:1494:20)
      at Object.tick (node_modules/@sinonjs/fake-timers/src/fake-timers-src.js:1502:20)
      at Object.runToLast (node_modules/@sinonjs/fake-timers/src/fake-timers-src.js:1661:26)
      at FakeTimers.runOnlyPendingTimers (node_modules/@jest/fake-timers/build/index.js:542:19)
      at Object.runOnlyPendingTimers (src/components/__tests__/PointAnimation.test.tsx:66:10)

    console.error
      Warning: An update to PointAnimation inside a test was not wrapped in act(...).
      
      When testing, code that causes React state updates should be wrapped into act(...):
      
      act(() => {
        /* fire events that update state */
      });
      /* assert on the output */
      
      This ensures that you're testing the behavior the user would see in the browser. Learn more at https://reactjs.org/link/wrap-tests-with-act
          at players (/Users/nyanpass/source/repos/mahjong-point-manager/src/components/PointAnimation.tsx:21:3)

      55 |
      56 |       // „Éï„Çß„Éº„Ç∫2: „Ç´„Ç¶„É≥„Éà„Ç¢„ÉÉ„Éó/„ÉÄ„Ç¶„É≥ (800ms)
    > 57 |       setAnimationPhase("counting")
         |       ^
      58 |
      59 |       // „Ç´„Ç¶„É≥„Éà„Ç¢„ÉÉ„Éó„Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥
      60 |       const animationDuration = 800

      at printWarning (node_modules/react-dom/cjs/react-dom.development.js:86:30)
      at error (node_modules/react-dom/cjs/react-dom.development.js:60:7)
      at warnIfUpdatesNotWrappedWithActDEV (node_modules/react-dom/cjs/react-dom.development.js:27628:9)
      at scheduleUpdateOnFiber (node_modules/react-dom/cjs/react-dom.development.js:25547:5)
      at dispatchSetState (node_modules/react-dom/cjs/react-dom.development.js:16708:7)
      at setAnimationPhase (src/components/PointAnimation.tsx:57:7)

    console.error
      Warning: An update to PointAnimation inside a test was not wrapped in act(...).
      
      When testing, code that causes React state updates should be wrapped into act(...):
      
      act(() => {
        /* fire events that update state */
      });
      /* assert on the output */
      
      This ensures that you're testing the behavior the user would see in the browser. Learn more at https://reactjs.org/link/wrap-tests-with-act
          at players (/Users/nyanpass/source/repos/mahjong-point-manager/src/components/PointAnimation.tsx:21:3)

      55 |
      56 |       // „Éï„Çß„Éº„Ç∫2: „Ç´„Ç¶„É≥„Éà„Ç¢„ÉÉ„Éó/„ÉÄ„Ç¶„É≥ (800ms)
    > 57 |       setAnimationPhase("counting")
         |       ^
      58 |
      59 |       // „Ç´„Ç¶„É≥„Éà„Ç¢„ÉÉ„Éó„Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥
      60 |       const animationDuration = 800

      at printWarning (node_modules/react-dom/cjs/react-dom.development.js:86:30)
      at error (node_modules/react-dom/cjs/react-dom.development.js:60:7)
      at warnIfUpdatesNotWrappedWithActDEV (node_modules/react-dom/cjs/react-dom.development.js:27628:9)
      at scheduleUpdateOnFiber (node_modules/react-dom/cjs/react-dom.development.js:25547:5)
      at dispatchSetState (node_modules/react-dom/cjs/react-dom.development.js:16708:7)
      at setAnimationPhase (src/components/PointAnimation.tsx:57:7)

    console.error
      Warning: An update to PointAnimation inside a test was not wrapped in act(...).
      
      When testing, code that causes React state updates should be wrapped into act(...):
      
      act(() => {
        /* fire events that update state */
      });
      /* assert on the output */
      
      This ensures that you're testing the behavior the user would see in the browser. Learn more at https://reactjs.org/link/wrap-tests-with-act
          at players (/Users/nyanpass/source/repos/mahjong-point-manager/src/components/PointAnimation.tsx:21:3)

      55 |
      56 |       // „Éï„Çß„Éº„Ç∫2: „Ç´„Ç¶„É≥„Éà„Ç¢„ÉÉ„Éó/„ÉÄ„Ç¶„É≥ (800ms)
    > 57 |       setAnimationPhase("counting")
         |       ^
      58 |
      59 |       // „Ç´„Ç¶„É≥„Éà„Ç¢„ÉÉ„Éó„Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥
      60 |       const animationDuration = 800

      at printWarning (node_modules/react-dom/cjs/react-dom.development.js:86:30)
      at error (node_modules/react-dom/cjs/react-dom.development.js:60:7)
      at warnIfUpdatesNotWrappedWithActDEV (node_modules/react-dom/cjs/react-dom.development.js:27628:9)
      at scheduleUpdateOnFiber (node_modules/react-dom/cjs/react-dom.development.js:25547:5)
      at dispatchSetState (node_modules/react-dom/cjs/react-dom.development.js:16708:7)
      at setAnimationPhase (src/components/PointAnimation.tsx:57:7)

PASS src/app/solo/create/__tests__/page.test.tsx
PASS src/components/__tests__/MenuDrawer.test.tsx
PASS src/components/__tests__/ForceEndConfirmModal.test.tsx
PASS src/components/__tests__/VotingProgress.test.tsx
PASS src/__tests__/components/SessionHistoryTable.test.tsx
  ‚óè Console

    console.error
      Session details fetch error: Error: „Çª„ÉÉ„Ç∑„Éß„É≥„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì
          at fetchSessionDetails (/Users/nyanpass/source/repos/mahjong-point-manager/src/components/SessionHistoryTable.tsx:73:15)

      84 |       }
      85 |     } catch (error) {
    > 86 |       console.error("Session details fetch error:", error)
         |               ^
      87 |       setError(
      88 |         error instanceof Error
      89 |           ? error.message

      at error (src/components/SessionHistoryTable.tsx:86:15)

PASS src/app/api/game/[gameId]/cancel-vote-session/__tests__/route.test.ts
  ‚óè Console

    console.log
      üó≥Ô∏è Cancel vote for player „ÉÜ„Çπ„Éà„Éó„É¨„Ç§„É§„Éº in game game1

      at log (src/app/api/game/[gameId]/cancel-vote-session/route.ts:20:13)

    console.log
      üó≥Ô∏è Vote cancelled for „ÉÜ„Çπ„Éà„Éó„É¨„Ç§„É§„Éº

      at log (src/app/api/game/[gameId]/cancel-vote-session/route.ts:30:15)

    console.log
      üó≥Ô∏è Remaining votes for game game1: { player2: false }

      at log (src/app/api/game/[gameId]/cancel-vote-session/route.ts:31:15)

    console.log
      üîå Cancel Vote API: Found WebSocket instance in process

      at log (src/app/api/game/[gameId]/cancel-vote-session/route.ts:54:17)

    console.log
      üîå Broadcasted vote cancellation to room TEST123

      at log (src/app/api/game/[gameId]/cancel-vote-session/route.ts:64:17)

    console.log
      üó≥Ô∏è Cancel vote for player „ÉÜ„Çπ„Éà„Éó„É¨„Ç§„É§„Éº in game game1

      at log (src/app/api/game/[gameId]/cancel-vote-session/route.ts:20:13)

    console.log
      üó≥Ô∏è Vote cancelled for „ÉÜ„Çπ„Éà„Éó„É¨„Ç§„É§„Éº

      at log (src/app/api/game/[gameId]/cancel-vote-session/route.ts:30:15)

    console.log
      üó≥Ô∏è Remaining votes for game game1: {}

      at log (src/app/api/game/[gameId]/cancel-vote-session/route.ts:31:15)

    console.log
      üó≥Ô∏è All votes cleared for game game1

      at log (src/app/api/game/[gameId]/cancel-vote-session/route.ts:39:17)

    console.log
      üîå Cancel Vote API: Found WebSocket instance in process

      at log (src/app/api/game/[gameId]/cancel-vote-session/route.ts:54:17)

    console.log
      üîå Broadcasted vote cancellation to room TEST123

      at log (src/app/api/game/[gameId]/cancel-vote-session/route.ts:64:17)

    console.log
      üó≥Ô∏è Cancel vote for player „ÉÜ„Çπ„Éà„Éó„É¨„Ç§„É§„Éº in game game1

      at log (src/app/api/game/[gameId]/cancel-vote-session/route.ts:20:13)

    console.log
      üó≥Ô∏è Vote cancelled for „ÉÜ„Çπ„Éà„Éó„É¨„Ç§„É§„Éº

      at log (src/app/api/game/[gameId]/cancel-vote-session/route.ts:30:15)

    console.log
      üó≥Ô∏è Remaining votes for game game1: { player2: false }

      at log (src/app/api/game/[gameId]/cancel-vote-session/route.ts:31:15)

    console.log
      üîå Cancel Vote API: Found WebSocket instance in process

      at log (src/app/api/game/[gameId]/cancel-vote-session/route.ts:54:17)

    console.log
      üîå Broadcasted vote cancellation to room TEST123

      at log (src/app/api/game/[gameId]/cancel-vote-session/route.ts:64:17)

    console.log
      üó≥Ô∏è Cancel vote for player „ÉÜ„Çπ„Éà„Éó„É¨„Ç§„É§„Éº in game game1

      at log (src/app/api/game/[gameId]/cancel-vote-session/route.ts:20:13)

    console.log
      üîå Cancel Vote API: Found WebSocket instance in process

      at log (src/app/api/game/[gameId]/cancel-vote-session/route.ts:54:17)

    console.log
      üîå Broadcasted vote cancellation to room TEST123

      at log (src/app/api/game/[gameId]/cancel-vote-session/route.ts:64:17)

    console.log
      üó≥Ô∏è Cancel vote for player „ÉÜ„Çπ„Éà„Éó„É¨„Ç§„É§„Éº in game game1

      at log (src/app/api/game/[gameId]/cancel-vote-session/route.ts:20:13)

    console.log
      üîå Cancel Vote API: Found WebSocket instance in process

      at log (src/app/api/game/[gameId]/cancel-vote-session/route.ts:54:17)

    console.log
      üîå Broadcasted vote cancellation to room TEST123

      at log (src/app/api/game/[gameId]/cancel-vote-session/route.ts:64:17)

    console.log
      üó≥Ô∏è Cancel vote for player „ÉÜ„Çπ„Éà„Éó„É¨„Ç§„É§„Éº in game game1

      at log (src/app/api/game/[gameId]/cancel-vote-session/route.ts:20:13)

    console.log
      üó≥Ô∏è Vote cancelled for „ÉÜ„Çπ„Éà„Éó„É¨„Ç§„É§„Éº

      at log (src/app/api/game/[gameId]/cancel-vote-session/route.ts:30:15)

    console.log
      üó≥Ô∏è Remaining votes for game game1: {}

      at log (src/app/api/game/[gameId]/cancel-vote-session/route.ts:31:15)

    console.log
      üó≥Ô∏è All votes cleared for game game1

      at log (src/app/api/game/[gameId]/cancel-vote-session/route.ts:39:17)

    console.log
      üó≥Ô∏è Cancel vote for player „ÉÜ„Çπ„Éà„Éó„É¨„Ç§„É§„Éº in game game1

      at log (src/app/api/game/[gameId]/cancel-vote-session/route.ts:20:13)

    console.log
      üó≥Ô∏è Vote cancelled for „ÉÜ„Çπ„Éà„Éó„É¨„Ç§„É§„Éº

      at log (src/app/api/game/[gameId]/cancel-vote-session/route.ts:30:15)

    console.log
      üó≥Ô∏è Remaining votes for game game1: {}

      at log (src/app/api/game/[gameId]/cancel-vote-session/route.ts:31:15)

    console.log
      üó≥Ô∏è All votes cleared for game game1

      at log (src/app/api/game/[gameId]/cancel-vote-session/route.ts:39:17)

    console.log
      üó≥Ô∏è Cancel vote for player „ÉÜ„Çπ„Éà„Éó„É¨„Ç§„É§„Éº in game game1

      at log (src/app/api/game/[gameId]/cancel-vote-session/route.ts:20:13)

    console.log
      üó≥Ô∏è Vote cancelled for „ÉÜ„Çπ„Éà„Éó„É¨„Ç§„É§„Éº

      at log (src/app/api/game/[gameId]/cancel-vote-session/route.ts:30:15)

    console.log
      üó≥Ô∏è Remaining votes for game game1: {}

      at log (src/app/api/game/[gameId]/cancel-vote-session/route.ts:31:15)

    console.log
      üó≥Ô∏è All votes cleared for game game1

      at log (src/app/api/game/[gameId]/cancel-vote-session/route.ts:39:17)

    console.log
      üó≥Ô∏è Cancel vote for player „ÉÜ„Çπ„Éà„Éó„É¨„Ç§„É§„Éº in game game1

      at log (src/app/api/game/[gameId]/cancel-vote-session/route.ts:20:13)

    console.error
      Cancel vote failed: Error: Database error
          at Object.<anonymous> (/Users/nyanpass/source/repos/mahjong-point-manager/src/app/api/game/[gameId]/cancel-vote-session/__tests__/route.test.ts:305:9)
          at Promise.finally.completed (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/jestAdapterInit.js:1559:28)
          at new Promise (<anonymous>)
          at callAsyncCircusFn (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/jestAdapterInit.js:1499:10)
          at _callCircusTest (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/jestAdapterInit.js:1009:40)
          at processTicksAndRejections (node:internal/process/task_queues:105:5)
          at _runTest (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/jestAdapterInit.js:949:3)
          at _runTestsForDescribeBlock (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/jestAdapterInit.js:839:13)
          at _runTestsForDescribeBlock (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/jestAdapterInit.js:829:11)
          at _runTestsForDescribeBlock (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/jestAdapterInit.js:829:11)
          at run (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/jestAdapterInit.js:757:3)
          at runAndTransformResultsToJestFormat (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/jestAdapterInit.js:1920:21)
          at jestAdapter (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/runner.js:101:19)
          at runTestInternal (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-runner/build/testWorker.js:272:16)
          at runTest (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-runner/build/testWorker.js:340:7)
          at Object.worker (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-runner/build/testWorker.js:494:12)

      88 |     }
      89 |
    > 90 |     console.error("Cancel vote failed:", error)
         |             ^
      91 |     return NextResponse.json(
      92 |       {
      93 |         success: false,

      at error (src/app/api/game/[gameId]/cancel-vote-session/route.ts:90:13)
      at Object.<anonymous> (src/app/api/game/[gameId]/cancel-vote-session/__tests__/route.test.ts:315:24)

    console.error
      Cancel vote failed: Unknown error

      88 |     }
      89 |
    > 90 |     console.error("Cancel vote failed:", error)
         |             ^
      91 |     return NextResponse.json(
      92 |       {
      93 |         success: false,

      at error (src/app/api/game/[gameId]/cancel-vote-session/route.ts:90:13)
      at Object.<anonymous> (src/app/api/game/[gameId]/cancel-vote-session/__tests__/route.test.ts:336:24)

    console.log
      üó≥Ô∏è Cancel vote for player „ÉÜ„Çπ„Éà„Éó„É¨„Ç§„É§„Éº in game game1

      at log (src/app/api/game/[gameId]/cancel-vote-session/route.ts:20:13)

    console.log
      üîå Cancel Vote API: Found WebSocket instance in process

      at log (src/app/api/game/[gameId]/cancel-vote-session/route.ts:54:17)

    console.log
      üîå Broadcasted vote cancellation to room TEST123

      at log (src/app/api/game/[gameId]/cancel-vote-session/route.ts:64:17)

    console.log
      üó≥Ô∏è Cancel vote for player „ÉÜ„Çπ„Éà„Éó„É¨„Ç§„É§„Éº in game game1

      at log (src/app/api/game/[gameId]/cancel-vote-session/route.ts:20:13)

    console.log
      üó≥Ô∏è Vote cancelled for „ÉÜ„Çπ„Éà„Éó„É¨„Ç§„É§„Éº

      at log (src/app/api/game/[gameId]/cancel-vote-session/route.ts:30:15)

    console.log
      üó≥Ô∏è Remaining votes for game game1: { player2: false }

      at log (src/app/api/game/[gameId]/cancel-vote-session/route.ts:31:15)

    console.log
      üîå Cancel Vote API: Found WebSocket instance in process

      at log (src/app/api/game/[gameId]/cancel-vote-session/route.ts:54:17)

    console.log
      üîå Broadcasted vote cancellation to room TEST123

      at log (src/app/api/game/[gameId]/cancel-vote-session/route.ts:64:17)

PASS src/app/api/score/calculate/__tests__/route.test.ts
  ‚óè Console

    console.error
      Score calculation failed: Error: fail
          at Object.<anonymous> (/Users/nyanpass/source/repos/mahjong-point-manager/src/app/api/score/calculate/__tests__/route.test.ts:65:54)
          at Promise.finally.completed (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/jestAdapterInit.js:1559:28)
          at new Promise (<anonymous>)
          at callAsyncCircusFn (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/jestAdapterInit.js:1499:10)
          at _callCircusTest (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/jestAdapterInit.js:1009:40)
          at processTicksAndRejections (node:internal/process/task_queues:105:5)
          at _runTest (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/jestAdapterInit.js:949:3)
          at _runTestsForDescribeBlock (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/jestAdapterInit.js:839:13)
          at _runTestsForDescribeBlock (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/jestAdapterInit.js:829:11)
          at run (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/jestAdapterInit.js:757:3)
          at runAndTransformResultsToJestFormat (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/jestAdapterInit.js:1920:21)
          at jestAdapter (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/runner.js:101:19)
          at runTestInternal (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-runner/build/testWorker.js:272:16)
          at runTest (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-runner/build/testWorker.js:340:7)
          at Object.worker (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-runner/build/testWorker.js:494:12)

      54 |     }
      55 |
    > 56 |     console.error("Score calculation failed:", error)
         |             ^
      57 |     return NextResponse.json(
      58 |       {
      59 |         success: false,

      at error (src/app/api/score/calculate/route.ts:56:13)
      at Object.<anonymous> (src/app/api/score/calculate/__tests__/route.test.ts:75:17)

PASS src/components/__tests__/RyukyokuForm.test.tsx
PASS src/app/api/game/[gameId]/ryukyoku/__tests__/route.test.ts
  ‚óè Console

    console.log
      Processing unified ryukyoku for gameId: test-game-id

      at log (src/app/api/game/[gameId]/ryukyoku/route.ts:82:13)

    console.log
      Processing as multiplayer ryukyoku

      at log (src/app/api/game/[gameId]/ryukyoku/route.ts:90:15)

    console.log
      üîå API: Found WebSocket instance in process

      at log (src/app/api/game/[gameId]/ryukyoku/route.ts:50:13)

    console.log
      Emitting ryukyoku to room TEST123

      at log (src/app/api/game/[gameId]/ryukyoku/route.ts:169:15)

    console.log
      Processing unified ryukyoku for gameId: test-game-id

      at log (src/app/api/game/[gameId]/ryukyoku/route.ts:82:13)

    console.log
      Processing as multiplayer ryukyoku

      at log (src/app/api/game/[gameId]/ryukyoku/route.ts:90:15)

    console.log
      üîå API: Found WebSocket instance in process

      at log (src/app/api/game/[gameId]/ryukyoku/route.ts:50:13)

    console.log
      Emitting ryukyoku to room TEST123

      at log (src/app/api/game/[gameId]/ryukyoku/route.ts:169:15)

    console.log
      Processing unified ryukyoku for gameId: test-game-id

      at log (src/app/api/game/[gameId]/ryukyoku/route.ts:82:13)

    console.log
      Processing as multiplayer ryukyoku

      at log (src/app/api/game/[gameId]/ryukyoku/route.ts:90:15)

    console.log
      üîå API: Found WebSocket instance in process

      at log (src/app/api/game/[gameId]/ryukyoku/route.ts:50:13)

    console.log
      Emitting ryukyoku to room TEST123

      at log (src/app/api/game/[gameId]/ryukyoku/route.ts:169:15)

    console.log
      Processing unified ryukyoku for gameId: test-game-id

      at log (src/app/api/game/[gameId]/ryukyoku/route.ts:82:13)

    console.log
      Processing as multiplayer ryukyoku

      at log (src/app/api/game/[gameId]/ryukyoku/route.ts:90:15)

    console.log
      üîå API: Found WebSocket instance in process

      at log (src/app/api/game/[gameId]/ryukyoku/route.ts:50:13)

    console.log
      Emitting ryukyoku to room TEST123

      at log (src/app/api/game/[gameId]/ryukyoku/route.ts:169:15)

    console.log
      Processing unified ryukyoku for gameId: test-game-id

      at log (src/app/api/game/[gameId]/ryukyoku/route.ts:82:13)

    console.log
      Processing as multiplayer ryukyoku

      at log (src/app/api/game/[gameId]/ryukyoku/route.ts:90:15)

    console.log
      üîå API: Found WebSocket instance in process

      at log (src/app/api/game/[gameId]/ryukyoku/route.ts:50:13)

    console.log
      Multiplayer game ended: „Ç™„Éº„É©„ÇπÊµÅÂ±ÄÁµÇ‰∫Ü

      at log (src/app/api/game/[gameId]/ryukyoku/route.ts:162:15)

    console.log
      Processing unified ryukyoku for gameId: test-game-id

      at log (src/app/api/game/[gameId]/ryukyoku/route.ts:82:13)

    console.log
      Processing as multiplayer ryukyoku

      at log (src/app/api/game/[gameId]/ryukyoku/route.ts:90:15)

    console.log
      üîå API: Found WebSocket instance in process

      at log (src/app/api/game/[gameId]/ryukyoku/route.ts:50:13)

    console.log
      Emitting ryukyoku to room TEST123

      at log (src/app/api/game/[gameId]/ryukyoku/route.ts:169:15)

    console.log
      Processing unified ryukyoku for gameId: test-solo-game-id

      at log (src/app/api/game/[gameId]/ryukyoku/route.ts:82:13)

    console.log
      Processing as solo ryukyoku

      at log (src/app/api/game/[gameId]/ryukyoku/route.ts:109:15)

    console.log
      Processing unified ryukyoku for gameId: test-solo-game-id

      at log (src/app/api/game/[gameId]/ryukyoku/route.ts:82:13)

    console.log
      Processing as solo ryukyoku

      at log (src/app/api/game/[gameId]/ryukyoku/route.ts:109:15)

    console.log
      Processing unified ryukyoku for gameId: test-solo-game-id

      at log (src/app/api/game/[gameId]/ryukyoku/route.ts:82:13)

    console.log
      Processing as solo ryukyoku

      at log (src/app/api/game/[gameId]/ryukyoku/route.ts:109:15)

    console.log
      Processing unified ryukyoku for gameId: test-solo-game-id

      at log (src/app/api/game/[gameId]/ryukyoku/route.ts:82:13)

    console.log
      Processing as solo ryukyoku

      at log (src/app/api/game/[gameId]/ryukyoku/route.ts:109:15)

    console.log
      Processing unified ryukyoku for gameId: test-solo-game-id

      at log (src/app/api/game/[gameId]/ryukyoku/route.ts:82:13)

    console.log
      Processing as solo ryukyoku

      at log (src/app/api/game/[gameId]/ryukyoku/route.ts:109:15)

    console.log
      Processing unified ryukyoku for gameId: test-solo-game-id

      at log (src/app/api/game/[gameId]/ryukyoku/route.ts:82:13)

    console.log
      Processing as solo ryukyoku

      at log (src/app/api/game/[gameId]/ryukyoku/route.ts:109:15)

    console.log
      Processing unified ryukyoku for gameId: test-solo-game-id

      at log (src/app/api/game/[gameId]/ryukyoku/route.ts:82:13)

    console.log
      Processing as solo ryukyoku

      at log (src/app/api/game/[gameId]/ryukyoku/route.ts:109:15)

    console.log
      Processing unified ryukyoku for gameId: test-solo-game-id

      at log (src/app/api/game/[gameId]/ryukyoku/route.ts:82:13)

    console.log
      Processing as solo ryukyoku

      at log (src/app/api/game/[gameId]/ryukyoku/route.ts:109:15)

    console.log
      Processing unified ryukyoku for gameId: nonexistent-game

      at log (src/app/api/game/[gameId]/ryukyoku/route.ts:82:13)

    console.log
      Processing unified ryukyoku for gameId: test-game-id

      at log (src/app/api/game/[gameId]/ryukyoku/route.ts:82:13)

    console.log
      Processing as multiplayer ryukyoku

      at log (src/app/api/game/[gameId]/ryukyoku/route.ts:90:15)

    console.log
      üîå API: Found WebSocket instance in process

      at log (src/app/api/game/[gameId]/ryukyoku/route.ts:50:13)

    console.log
      Emitting ryukyoku to room TEST123

      at log (src/app/api/game/[gameId]/ryukyoku/route.ts:169:15)

    console.log
      Processing unified ryukyoku for gameId: test-game-id

      at log (src/app/api/game/[gameId]/ryukyoku/route.ts:82:13)

    console.log
      Processing as multiplayer ryukyoku

      at log (src/app/api/game/[gameId]/ryukyoku/route.ts:90:15)

    console.log
      üîå API: Found WebSocket instance in process

      at log (src/app/api/game/[gameId]/ryukyoku/route.ts:50:13)

    console.log
      Emitting ryukyoku to room TEST123

      at log (src/app/api/game/[gameId]/ryukyoku/route.ts:169:15)

    console.log
      Processing unified ryukyoku for gameId: test-game-id

      at log (src/app/api/game/[gameId]/ryukyoku/route.ts:82:13)

    console.log
      Processing as multiplayer ryukyoku

      at log (src/app/api/game/[gameId]/ryukyoku/route.ts:90:15)

    console.log
      üîå API: Found WebSocket instance in process

      at log (src/app/api/game/[gameId]/ryukyoku/route.ts:50:13)

    console.log
      Emitting ryukyoku to room TEST123

      at log (src/app/api/game/[gameId]/ryukyoku/route.ts:169:15)

    console.log
      Processing unified ryukyoku for gameId: test-game-id

      at log (src/app/api/game/[gameId]/ryukyoku/route.ts:82:13)

    console.log
      Processing as multiplayer ryukyoku

      at log (src/app/api/game/[gameId]/ryukyoku/route.ts:90:15)

    console.log
      üîå API: Found WebSocket instance in process

      at log (src/app/api/game/[gameId]/ryukyoku/route.ts:50:13)

    console.log
      Emitting ryukyoku to room TEST123

      at log (src/app/api/game/[gameId]/ryukyoku/route.ts:169:15)

PASS src/app/api/admin/migrate-to-sessions/__tests__/route.test.ts
  ‚óè Console

    console.error
      Session migration error: Error: Database connection failed
          at Object.<anonymous> (/Users/nyanpass/source/repos/mahjong-point-manager/src/app/api/admin/migrate-to-sessions/__tests__/route.test.ts:363:9)
          at Promise.finally.completed (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/jestAdapterInit.js:1559:28)
          at new Promise (<anonymous>)
          at callAsyncCircusFn (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/jestAdapterInit.js:1499:10)
          at _callCircusTest (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/jestAdapterInit.js:1009:40)
          at processTicksAndRejections (node:internal/process/task_queues:105:5)
          at _runTest (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/jestAdapterInit.js:949:3)
          at _runTestsForDescribeBlock (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/jestAdapterInit.js:839:13)
          at _runTestsForDescribeBlock (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/jestAdapterInit.js:829:11)
          at _runTestsForDescribeBlock (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/jestAdapterInit.js:829:11)
          at run (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/jestAdapterInit.js:757:3)
          at runAndTransformResultsToJestFormat (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/jestAdapterInit.js:1920:21)
          at jestAdapter (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/runner.js:101:19)
          at runTestInternal (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-runner/build/testWorker.js:272:16)
          at runTest (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-runner/build/testWorker.js:340:7)
          at Object.worker (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-runner/build/testWorker.js:494:12)

      183 |     })
      184 |   } catch (error) {
    > 185 |     console.error("Session migration error:", error)
          |             ^
      186 |     return NextResponse.json(
      187 |       {
      188 |         success: false,

      at error (src/app/api/admin/migrate-to-sessions/route.ts:185:13)
      at Object.<anonymous> (src/app/api/admin/migrate-to-sessions/__tests__/route.test.ts:374:24)

    console.error
      Session migration error: SyntaxError: Unexpected token 'i', "invalid json" is not valid JSON
          at JSON.parse (<anonymous>)
          at NextRequest.parse [as json] (/Users/nyanpass/source/repos/mahjong-point-manager/jest.setup.js:52:17)
          at json (/Users/nyanpass/source/repos/mahjong-point-manager/src/app/api/admin/migrate-to-sessions/route.ts:7:32)
          at Object.<anonymous> (/Users/nyanpass/source/repos/mahjong-point-manager/src/app/api/admin/migrate-to-sessions/__tests__/route.test.ts:392:34)
          at Promise.finally.completed (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/jestAdapterInit.js:1559:28)
          at new Promise (<anonymous>)
          at callAsyncCircusFn (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/jestAdapterInit.js:1499:10)
          at _callCircusTest (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/jestAdapterInit.js:1009:40)
          at processTicksAndRejections (node:internal/process/task_queues:105:5)
          at _runTest (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/jestAdapterInit.js:949:3)
          at _runTestsForDescribeBlock (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/jestAdapterInit.js:839:13)
          at _runTestsForDescribeBlock (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/jestAdapterInit.js:829:11)
          at _runTestsForDescribeBlock (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/jestAdapterInit.js:829:11)
          at run (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/jestAdapterInit.js:757:3)
          at runAndTransformResultsToJestFormat (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/jestAdapterInit.js:1920:21)
          at jestAdapter (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/runner.js:101:19)
          at runTestInternal (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-runner/build/testWorker.js:272:16)
          at runTest (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-runner/build/testWorker.js:340:7)
          at Object.worker (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-runner/build/testWorker.js:494:12)

      183 |     })
      184 |   } catch (error) {
    > 185 |     console.error("Session migration error:", error)
          |             ^
      186 |     return NextResponse.json(
      187 |       {
      188 |         success: false,

      at error (src/app/api/admin/migrate-to-sessions/route.ts:185:13)
      at Object.<anonymous> (src/app/api/admin/migrate-to-sessions/__tests__/route.test.ts:392:24)

PASS src/app/room/create/__tests__/page.test.tsx
PASS src/lib/__tests__/score.test.ts
PASS src/components/__tests__/LazyComponents.test.tsx
PASS src/components/__tests__/QRCodeModal.test.tsx
PASS src/components/__tests__/LoadingSpinner.test.tsx
PASS src/app/api/game/[gameId]/score/__tests__/route.test.ts
  ‚óè Console

    console.log
      Processing unified score calculation for gameId: test-game-id

      at log (src/app/api/game/[gameId]/score/route.ts:100:13)

    console.log
      Processing as multiplayer game

      at log (src/app/api/game/[gameId]/score/route.ts:108:15)

    console.log
      üîå API: Found WebSocket instance in process

      at log (src/app/api/game/[gameId]/score/route.ts:56:13)

    console.log
      Emitting score_updated to room TEST123

      at log (src/app/api/game/[gameId]/score/route.ts:246:15)

    console.log
      Processing unified score calculation for gameId: test-game-id

      at log (src/app/api/game/[gameId]/score/route.ts:100:13)

    console.log
      Processing as multiplayer game

      at log (src/app/api/game/[gameId]/score/route.ts:108:15)

    console.log
      üîå API: Found WebSocket instance in process

      at log (src/app/api/game/[gameId]/score/route.ts:56:13)

    console.log
      Emitting score_updated to room TEST123

      at log (src/app/api/game/[gameId]/score/route.ts:246:15)

    console.log
      Processing unified score calculation for gameId: test-game-id

      at log (src/app/api/game/[gameId]/score/route.ts:100:13)

    console.log
      Processing as multiplayer game

      at log (src/app/api/game/[gameId]/score/route.ts:108:15)

    console.log
      üîå API: Found WebSocket instance in process

      at log (src/app/api/game/[gameId]/score/route.ts:56:13)

    console.log
      Multiplayer game ended: „Ç™„Éº„É©„ÇπÁµÇ‰∫Ü

      at log (src/app/api/game/[gameId]/score/route.ts:239:15)

    console.log
      Processing unified score calculation for gameId: test-game-id

      at log (src/app/api/game/[gameId]/score/route.ts:100:13)

    console.log
      Processing as multiplayer game

      at log (src/app/api/game/[gameId]/score/route.ts:108:15)

    console.error
      Unexpected error: Error: „Ç≤„Éº„É†Áä∂ÊÖã„ÅåÁÑ°Âäπ„Åß„Åô„ÄÇÊúüÂæÖ: playing, ÁèæÂú®: ended
          at processMultiplayerScore (/Users/nyanpass/source/repos/mahjong-point-manager/src/app/api/game/[gameId]/score/route.ts:198:11)
          at processTicksAndRejections (node:internal/process/task_queues:105:5)
          at /Users/nyanpass/source/repos/mahjong-point-manager/src/app/api/game/[gameId]/score/route.ts:121:14
          at /Users/nyanpass/source/repos/mahjong-point-manager/src/lib/error-handler.ts:196:14
          at Object.<anonymous> (/Users/nyanpass/source/repos/mahjong-point-manager/src/app/api/game/[gameId]/score/__tests__/route.test.ts:286:24)

      137 |     statusCode = 400
      138 |   } else if (error instanceof Error) {
    > 139 |     console.error("Unexpected error:", error)
          |             ^
      140 |     apiError = {
      141 |       code: "INTERNAL_ERROR",
      142 |       message: defaultMessage,

      at error (src/lib/error-handler.ts:139:13)
      at createErrorResponse (src/lib/error-handler.ts:198:14)
      at Object.<anonymous> (src/app/api/game/[gameId]/score/__tests__/route.test.ts:286:24)

    console.log
      Processing unified score calculation for gameId: test-solo-game-id

      at log (src/app/api/game/[gameId]/score/route.ts:100:13)

    console.log
      Processing as solo game

      at log (src/app/api/game/[gameId]/score/route.ts:130:15)

    console.log
      Processing unified score calculation for gameId: test-solo-game-id

      at log (src/app/api/game/[gameId]/score/route.ts:100:13)

    console.log
      Processing as solo game

      at log (src/app/api/game/[gameId]/score/route.ts:130:15)

    console.log
      Processing unified score calculation for gameId: nonexistent-game

      at log (src/app/api/game/[gameId]/score/route.ts:100:13)

    console.error
      Unexpected error: Error: „Ç≤„Éº„É†„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì
          at /Users/nyanpass/source/repos/mahjong-point-manager/src/app/api/game/[gameId]/score/route.ts:179:11
          at processTicksAndRejections (node:internal/process/task_queues:105:5)
          at /Users/nyanpass/source/repos/mahjong-point-manager/src/lib/error-handler.ts:196:14
          at Object.<anonymous> (/Users/nyanpass/source/repos/mahjong-point-manager/src/app/api/game/[gameId]/score/__tests__/route.test.ts:447:24)

      137 |     statusCode = 400
      138 |   } else if (error instanceof Error) {
    > 139 |     console.error("Unexpected error:", error)
          |             ^
      140 |     apiError = {
      141 |       code: "INTERNAL_ERROR",
      142 |       message: defaultMessage,

      at error (src/lib/error-handler.ts:139:13)
      at createErrorResponse (src/lib/error-handler.ts:198:14)
      at Object.<anonymous> (src/app/api/game/[gameId]/score/__tests__/route.test.ts:447:24)

PASS src/components/__tests__/OptimizedImage.test.tsx
PASS src/lib/__tests__/point-manager.test.ts
  ‚óè Console

    console.log
      üèÅ Starting settlement calculation with settings: { uma: [ 20, 10, -10, -20 ], basePoints: 30000 }

      at PointManager.log [as calculateSettlement] (src/lib/point-manager.ts:602:13)

    console.log
      üèÅ Sorted participants: [
        { name: 'Unknown', points: 34500, position: 0 },
        { name: 'Unknown', points: 27400, position: 1 },
        { name: 'Unknown', points: 22600, position: 2 },
        { name: 'Unknown', points: 15500, position: 3 }
      ]

      at PointManager.log [as calculateSettlement] (src/lib/point-manager.ts:616:13)

    console.log
      üèÅ Results before adjustment: [
        {
          playerId: 'player1',
          finalPoints: 34500,
          rank: 1,
          pointDiff: 4500,
          roundedDiff: 4,
          uma: 20,
          settlement: 0
        },
        {
          playerId: 'player2',
          finalPoints: 27400,
          rank: 2,
          pointDiff: -2600,
          roundedDiff: -2,
          uma: 10,
          settlement: 8
        },
        {
          playerId: 'player3',
          finalPoints: 22600,
          rank: 3,
          pointDiff: -7400,
          roundedDiff: -7,
          uma: -10,
          settlement: -17
        },
        {
          playerId: 'player4',
          finalPoints: 15500,
          rank: 4,
          pointDiff: -14500,
          roundedDiff: -14,
          uma: -20,
          settlement: -34
        }
      ]

      at PointManager.log [as calculateSettlement] (src/lib/point-manager.ts:662:13)

    console.log
      üèÅ Others rounded diff total: -23

      at PointManager.log [as calculateSettlement] (src/lib/point-manager.ts:677:13)

    console.log
      üèÅ First place rounded diff: 23 (= --23)

      at PointManager.log [as calculateSettlement] (src/lib/point-manager.ts:678:13)

    console.log
      üèÅ First place uma: 20

      at PointManager.log [as calculateSettlement] (src/lib/point-manager.ts:681:13)

    console.log
      üèÅ First place settlement: 23 + 20 = 43

      at PointManager.log [as calculateSettlement] (src/lib/point-manager.ts:682:13)

    console.log
      üèÅ Final total check (should be 0): 0

      at PointManager.log [as calculateSettlement] (src/lib/point-manager.ts:688:13)

    console.log
      üèÅ Final results: [
        {
          playerId: 'player1',
          finalPoints: 34500,
          rank: 1,
          pointDiff: 4500,
          roundedDiff: 23,
          uma: 20,
          settlement: 43
        },
        {
          playerId: 'player2',
          finalPoints: 27400,
          rank: 2,
          pointDiff: -2600,
          roundedDiff: -2,
          uma: 10,
          settlement: 8
        },
        {
          playerId: 'player3',
          finalPoints: 22600,
          rank: 3,
          pointDiff: -7400,
          roundedDiff: -7,
          uma: -10,
          settlement: -17
        },
        {
          playerId: 'player4',
          finalPoints: 15500,
          rank: 4,
          pointDiff: -14500,
          roundedDiff: -14,
          uma: -20,
          settlement: -34
        }
      ]

      at PointManager.log [as calculateSettlement] (src/lib/point-manager.ts:690:13)

    console.log
      üèÅ Starting settlement calculation with settings: { uma: [ 20, 10, -10, -20 ], basePoints: 25000 }

      at PointManager.log [as calculateSettlement] (src/lib/point-manager.ts:602:13)

    console.log
      üèÅ Sorted participants: [
        { name: 'Unknown', points: 25000, position: 0 },
        { name: 'Unknown', points: 25000, position: 1 },
        { name: 'Unknown', points: 25000, position: 2 },
        { name: 'Unknown', points: 25000, position: 3 }
      ]

      at PointManager.log [as calculateSettlement] (src/lib/point-manager.ts:616:13)

    console.log
      üèÅ Results before adjustment: [
        {
          playerId: 'player1',
          finalPoints: 25000,
          rank: 1,
          pointDiff: 0,
          roundedDiff: 0,
          uma: 20,
          settlement: 0
        },
        {
          playerId: 'player2',
          finalPoints: 25000,
          rank: 2,
          pointDiff: 0,
          roundedDiff: 0,
          uma: 10,
          settlement: 10
        },
        {
          playerId: 'player3',
          finalPoints: 25000,
          rank: 3,
          pointDiff: 0,
          roundedDiff: 0,
          uma: -10,
          settlement: -10
        },
        {
          playerId: 'player4',
          finalPoints: 25000,
          rank: 4,
          pointDiff: 0,
          roundedDiff: 0,
          uma: -20,
          settlement: -20
        }
      ]

      at PointManager.log [as calculateSettlement] (src/lib/point-manager.ts:662:13)

    console.log
      üèÅ Others rounded diff total: 0

      at PointManager.log [as calculateSettlement] (src/lib/point-manager.ts:677:13)

    console.log
      üèÅ First place rounded diff: 0 (= -0)

      at PointManager.log [as calculateSettlement] (src/lib/point-manager.ts:678:13)

    console.log
      üèÅ First place uma: 20

      at PointManager.log [as calculateSettlement] (src/lib/point-manager.ts:681:13)

    console.log
      üèÅ First place settlement: 0 + 20 = 20

      at PointManager.log [as calculateSettlement] (src/lib/point-manager.ts:682:13)

    console.log
      üèÅ Final total check (should be 0): 0

      at PointManager.log [as calculateSettlement] (src/lib/point-manager.ts:688:13)

    console.log
      üèÅ Final results: [
        {
          playerId: 'player1',
          finalPoints: 25000,
          rank: 1,
          pointDiff: 0,
          roundedDiff: -0,
          uma: 20,
          settlement: 20
        },
        {
          playerId: 'player2',
          finalPoints: 25000,
          rank: 2,
          pointDiff: 0,
          roundedDiff: 0,
          uma: 10,
          settlement: 10
        },
        {
          playerId: 'player3',
          finalPoints: 25000,
          rank: 3,
          pointDiff: 0,
          roundedDiff: 0,
          uma: -10,
          settlement: -10
        },
        {
          playerId: 'player4',
          finalPoints: 25000,
          rank: 4,
          pointDiff: 0,
          roundedDiff: 0,
          uma: -20,
          settlement: -20
        }
      ]

      at PointManager.log [as calculateSettlement] (src/lib/point-manager.ts:690:13)

    console.log
      üéØ Game end check: gameType=undefined, currentRound=4, currentOya=undefined

      at PointManager.log [as checkRoundEnd] (src/lib/point-manager.ts:832:13)

    console.log
      üéØ Unknown gameType: undefined

      at PointManager.log [as checkRoundEnd] (src/lib/point-manager.ts:865:15)

    console.log
      üéØ Game continues: gameType=undefined, round=4

      at PointManager.log [as checkRoundEnd] (src/lib/point-manager.ts:868:13)

    console.log
      Transaction recorded: {
        fromPlayerId: 'player1',
        toPlayerId: 'KYOTAKU',
        amount: 1000,
        type: 'RIICHI',
        description: '„É™„Éº„ÉÅÂÆ£Ë®Ä'
      }

      at PointManager.log [as recordTransaction] (src/lib/point-manager.ts:780:13)

    console.log
      üìä Updating session statistics for gameId: test-game-id

      at PointManager.log [as updateSessionStatistics] (src/lib/point-manager.ts:944:13)

    console.log
      üìä No game result found for gameId: test-game-id skipping session statistics update

      at PointManager.log [as updateSessionStatistics] (src/lib/point-manager.ts:952:15)

    console.log
      üìä Updating session statistics for gameId: test-game-id

      at PointManager.log [as updateSessionStatistics] (src/lib/point-manager.ts:944:13)

    console.log
      üìä No session found for game, skipping session statistics update

      at PointManager.log [as updateSessionStatistics] (src/lib/point-manager.ts:970:15)

    console.log
      üìä Updating session statistics for gameId: test-game-id

      at PointManager.log [as updateSessionStatistics] (src/lib/point-manager.ts:944:13)

    console.log
      üìä Session statistics already up to date for gameId: test-game-id

      at PointManager.log [as updateSessionStatistics] (src/lib/point-manager.ts:997:15)

    console.log
      üìä Updating session statistics for gameId: test-game-id

      at PointManager.log [as updateSessionStatistics] (src/lib/point-manager.ts:944:13)

    console.log
      üìä Found session: session-id updating statistics for 2 participants

      at PointManager.log [as updateSessionStatistics] (src/lib/point-manager.ts:1004:13)

    console.log
      üìä Updating participant: player1 rank: 1 settlement: 20

      at PointManager.log [as updateSessionStatistics] (src/lib/point-manager.ts:1017:15)

    console.log
      üìä Updated session participant: undefined

      at PointManager.log [as updateSessionStatistics] (src/lib/point-manager.ts:1079:15)

    console.log
      üìä Updating participant: player2 rank: 2 settlement: -20

      at PointManager.log [as updateSessionStatistics] (src/lib/point-manager.ts:1017:15)

    console.log
      üìä Updated session participant: undefined

      at PointManager.log [as updateSessionStatistics] (src/lib/point-manager.ts:1079:15)

    console.log
      üìä Session statistics update completed

      at PointManager.log [as updateSessionStatistics] (src/lib/point-manager.ts:1082:13)

    console.log
      üìä Updating session statistics for gameId: test-game-id

      at PointManager.log [as updateSessionStatistics] (src/lib/point-manager.ts:944:13)

    console.log
      üìä Found session: session-id updating statistics for 2 participants

      at PointManager.log [as updateSessionStatistics] (src/lib/point-manager.ts:1004:13)

    console.log
      üìä Updating participant: player1 rank: 1 settlement: 20

      at PointManager.log [as updateSessionStatistics] (src/lib/point-manager.ts:1017:15)

    console.log
      üìä Statistics already updated for participant: player1

      at PointManager.log [as updateSessionStatistics] (src/lib/point-manager.ts:1043:17)

    console.log
      üìä Updating participant: player2 rank: 2 settlement: -20

      at PointManager.log [as updateSessionStatistics] (src/lib/point-manager.ts:1017:15)

    console.log
      üìä Updated session participant: undefined

      at PointManager.log [as updateSessionStatistics] (src/lib/point-manager.ts:1079:15)

    console.log
      üìä Session statistics update completed

      at PointManager.log [as updateSessionStatistics] (src/lib/point-manager.ts:1082:13)

    console.log
      Transaction recorded: {
        fromPlayerId: undefined,
        toPlayerId: 'player1',
        amount: 12000,
        type: 'WIN',
        description: '„ÉÑ„É¢Âíå‰∫Ü 12000ÁÇπ'
      }

      at PointManager.log [as recordTransaction] (src/lib/point-manager.ts:780:13)

    console.log
      Player position 1, currentOya: 0, isThisPlayerOya: false, payment: 4000

      at PointManager.log [as handleTsumoDistribution] (src/lib/point-manager.ts:171:17)

    console.log
      Transaction recorded: {
        fromPlayerId: 'player2',
        toPlayerId: 'GAME',
        amount: 4000,
        type: 'LOSE',
        description: '„ÉÑ„É¢ÊîØÊâï„ÅÑ -4000ÁÇπ'
      }

      at PointManager.log [as recordTransaction] (src/lib/point-manager.ts:780:13)

    console.log
      Player position 2, currentOya: 0, isThisPlayerOya: false, payment: 4000

      at PointManager.log [as handleTsumoDistribution] (src/lib/point-manager.ts:171:17)

    console.log
      Transaction recorded: {
        fromPlayerId: 'player3',
        toPlayerId: 'GAME',
        amount: 4000,
        type: 'LOSE',
        description: '„ÉÑ„É¢ÊîØÊâï„ÅÑ -4000ÁÇπ'
      }

      at PointManager.log [as recordTransaction] (src/lib/point-manager.ts:780:13)

    console.log
      Player position 3, currentOya: 0, isThisPlayerOya: false, payment: 4000

      at PointManager.log [as handleTsumoDistribution] (src/lib/point-manager.ts:171:17)

    console.log
      Transaction recorded: {
        fromPlayerId: 'player4',
        toPlayerId: 'GAME',
        amount: 4000,
        type: 'LOSE',
        description: '„ÉÑ„É¢ÊîØÊâï„ÅÑ -4000ÁÇπ'
      }

      at PointManager.log [as recordTransaction] (src/lib/point-manager.ts:780:13)

    console.log
      Transaction recorded: {
        fromPlayerId: undefined,
        toPlayerId: 'player1',
        amount: 7700,
        type: 'WIN',
        description: '„É≠„É≥Âíå‰∫Ü 7700ÁÇπ'
      }

      at PointManager.log [as recordTransaction] (src/lib/point-manager.ts:780:13)

    console.log
      Transaction recorded: {
        fromPlayerId: 'player2',
        toPlayerId: 'GAME',
        amount: 7700,
        type: 'LOSE',
        description: '„É≠„É≥ÊîØÊâï„ÅÑ -7700ÁÇπ'
      }

      at PointManager.log [as recordTransaction] (src/lib/point-manager.ts:780:13)

    console.log
      Ë¶™ÈÄ£Ëçò: Ë¶™=0Á∂ôÁ∂ö, Êú¨Â†¥=1 ‚Üí 2, Â±Ä=5

      at PointManager.log [as rotateDealer] (src/lib/point-manager.ts:418:15)

    console.log
      Â≠êÂíå‰∫Ü: ÊóßË¶™=0 ‚Üí Êñ∞Ë¶™=1, ÊóßÂ±Ä=5 ‚Üí Êñ∞Â±Ä=6, Êú¨Â†¥„É™„Çª„ÉÉ„Éà

      at PointManager.log [as rotateDealer] (src/lib/point-manager.ts:426:15)

    console.log
      üèÅ Starting settlement calculation with settings: { uma: [ 20, 10, -10, -20 ], basePoints: 30000 }

      at PointManager.log [as calculateSettlement] (src/lib/point-manager.ts:602:13)

    console.log
      üèÅ Sorted participants: [
        { name: '„ÉÜ„Çπ„Éà„Éó„É¨„Ç§„É§„Éº', points: 100000, position: 0 },
        { name: '„ÉÜ„Çπ„Éà„Éó„É¨„Ç§„É§„Éº', points: 0, position: 1 },
        { name: '„ÉÜ„Çπ„Éà„Éó„É¨„Ç§„É§„Éº', points: 0, position: 2 },
        { name: '„ÉÜ„Çπ„Éà„Éó„É¨„Ç§„É§„Éº', points: 0, position: 3 }
      ]

      at PointManager.log [as calculateSettlement] (src/lib/point-manager.ts:616:13)

    console.log
      üèÅ Results before adjustment: [
        {
          playerId: 'player1',
          finalPoints: 100000,
          rank: 1,
          pointDiff: 70000,
          roundedDiff: 70,
          uma: 20,
          settlement: 0
        },
        {
          playerId: 'player1',
          finalPoints: 0,
          rank: 2,
          pointDiff: -30000,
          roundedDiff: -30,
          uma: 10,
          settlement: -20
        },
        {
          playerId: 'player1',
          finalPoints: 0,
          rank: 3,
          pointDiff: -30000,
          roundedDiff: -30,
          uma: -10,
          settlement: -40
        },
        {
          playerId: 'player1',
          finalPoints: 0,
          rank: 4,
          pointDiff: -30000,
          roundedDiff: -30,
          uma: -20,
          settlement: -50
        }
      ]

      at PointManager.log [as calculateSettlement] (src/lib/point-manager.ts:662:13)

    console.log
      üèÅ Others rounded diff total: -90

      at PointManager.log [as calculateSettlement] (src/lib/point-manager.ts:677:13)

    console.log
      üèÅ First place rounded diff: 90 (= --90)

      at PointManager.log [as calculateSettlement] (src/lib/point-manager.ts:678:13)

    console.log
      üèÅ First place uma: 20

      at PointManager.log [as calculateSettlement] (src/lib/point-manager.ts:681:13)

    console.log
      üèÅ First place settlement: 90 + 20 = 110

      at PointManager.log [as calculateSettlement] (src/lib/point-manager.ts:682:13)

    console.log
      üèÅ Final total check (should be 0): 0

      at PointManager.log [as calculateSettlement] (src/lib/point-manager.ts:688:13)

    console.log
      üèÅ Final results: [
        {
          playerId: 'player1',
          finalPoints: 100000,
          rank: 1,
          pointDiff: 70000,
          roundedDiff: 90,
          uma: 20,
          settlement: 110
        },
        {
          playerId: 'player1',
          finalPoints: 0,
          rank: 2,
          pointDiff: -30000,
          roundedDiff: -30,
          uma: 10,
          settlement: -20
        },
        {
          playerId: 'player1',
          finalPoints: 0,
          rank: 3,
          pointDiff: -30000,
          roundedDiff: -30,
          uma: -10,
          settlement: -40
        },
        {
          playerId: 'player1',
          finalPoints: 0,
          rank: 4,
          pointDiff: -30000,
          roundedDiff: -30,
          uma: -20,
          settlement: -50
        }
      ]

      at PointManager.log [as calculateSettlement] (src/lib/point-manager.ts:690:13)

    console.log
      üèÅ Starting settlement calculation with settings: { uma: [ 20, 10, -10, -20 ], basePoints: 30000 }

      at PointManager.log [as calculateSettlement] (src/lib/point-manager.ts:602:13)

    console.log
      üèÅ Sorted participants: [
        { name: '„ÉÜ„Çπ„Éà„Éó„É¨„Ç§„É§„Éº', points: 50000, position: 0 },
        { name: '„ÉÜ„Çπ„Éà„Éó„É¨„Ç§„É§„Éº', points: 25000, position: 1 },
        { name: '„ÉÜ„Çπ„Éà„Éó„É¨„Ç§„É§„Éº', points: 25000, position: 2 },
        { name: '„ÉÜ„Çπ„Éà„Éó„É¨„Ç§„É§„Éº', points: -1000, position: 3 }
      ]

      at PointManager.log [as calculateSettlement] (src/lib/point-manager.ts:616:13)

    console.log
      üèÅ Results before adjustment: [
        {
          playerId: 'player1',
          finalPoints: 50000,
          rank: 1,
          pointDiff: 20000,
          roundedDiff: 20,
          uma: 20,
          settlement: 0
        },
        {
          playerId: 'player1',
          finalPoints: 25000,
          rank: 2,
          pointDiff: -5000,
          roundedDiff: -5,
          uma: 10,
          settlement: 5
        },
        {
          playerId: 'player1',
          finalPoints: 25000,
          rank: 3,
          pointDiff: -5000,
          roundedDiff: -5,
          uma: -10,
          settlement: -15
        },
        {
          playerId: 'player1',
          finalPoints: -1000,
          rank: 4,
          pointDiff: -31000,
          roundedDiff: -31,
          uma: -20,
          settlement: -51
        }
      ]

      at PointManager.log [as calculateSettlement] (src/lib/point-manager.ts:662:13)

    console.log
      üèÅ Others rounded diff total: -41

      at PointManager.log [as calculateSettlement] (src/lib/point-manager.ts:677:13)

    console.log
      üèÅ First place rounded diff: 41 (= --41)

      at PointManager.log [as calculateSettlement] (src/lib/point-manager.ts:678:13)

    console.log
      üèÅ First place uma: 20

      at PointManager.log [as calculateSettlement] (src/lib/point-manager.ts:681:13)

    console.log
      üèÅ First place settlement: 41 + 20 = 61

      at PointManager.log [as calculateSettlement] (src/lib/point-manager.ts:682:13)

    console.log
      üèÅ Final total check (should be 0): 0

      at PointManager.log [as calculateSettlement] (src/lib/point-manager.ts:688:13)

    console.log
      üèÅ Final results: [
        {
          playerId: 'player1',
          finalPoints: 50000,
          rank: 1,
          pointDiff: 20000,
          roundedDiff: 41,
          uma: 20,
          settlement: 61
        },
        {
          playerId: 'player1',
          finalPoints: 25000,
          rank: 2,
          pointDiff: -5000,
          roundedDiff: -5,
          uma: 10,
          settlement: 5
        },
        {
          playerId: 'player1',
          finalPoints: 25000,
          rank: 3,
          pointDiff: -5000,
          roundedDiff: -5,
          uma: -10,
          settlement: -15
        },
        {
          playerId: 'player1',
          finalPoints: -1000,
          rank: 4,
          pointDiff: -31000,
          roundedDiff: -31,
          uma: -20,
          settlement: -51
        }
      ]

      at PointManager.log [as calculateSettlement] (src/lib/point-manager.ts:690:13)

    console.log
      üéØ Game end check: gameType=TONPUU, currentRound=5, currentOya=0

      at PointManager.log [as checkRoundEnd] (src/lib/point-manager.ts:832:13)

    console.log
      üéØ TONPUU check: currentRound=5 > 4? true

      at PointManager.log [as checkRoundEnd] (src/lib/point-manager.ts:838:15)

    console.log
      üéØ TONPUU ending: round 5

      at PointManager.log [as checkRoundEnd] (src/lib/point-manager.ts:844:17)

    console.log
      üéØ Game end check: gameType=HANCHAN, currentRound=9, currentOya=0

      at PointManager.log [as checkRoundEnd] (src/lib/point-manager.ts:832:13)

    console.log
      üéØ HANCHAN check: currentRound=9 > 8? true

      at PointManager.log [as checkRoundEnd] (src/lib/point-manager.ts:852:15)

    console.log
      üéØ HANCHAN ending: round 9

      at PointManager.log [as checkRoundEnd] (src/lib/point-manager.ts:858:17)

PASS src/app/api/solo/create/__tests__/route.test.ts
  ‚óè Console

    console.error
      Solo game creation error: Error: DB error
          at Object.<anonymous> (/Users/nyanpass/source/repos/mahjong-point-manager/src/app/api/solo/create/__tests__/route.test.ts:138:47)
          at Promise.finally.completed (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/jestAdapterInit.js:1559:28)
          at new Promise (<anonymous>)
          at callAsyncCircusFn (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/jestAdapterInit.js:1499:10)
          at _callCircusTest (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/jestAdapterInit.js:1009:40)
          at processTicksAndRejections (node:internal/process/task_queues:105:5)
          at _runTest (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/jestAdapterInit.js:949:3)
          at _runTestsForDescribeBlock (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/jestAdapterInit.js:839:13)
          at _runTestsForDescribeBlock (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/jestAdapterInit.js:829:11)
          at run (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/jestAdapterInit.js:757:3)
          at runAndTransformResultsToJestFormat (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/jestAdapterInit.js:1920:21)
          at jestAdapter (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/runner.js:101:19)
          at runTestInternal (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-runner/build/testWorker.js:272:16)
          at runTest (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-runner/build/testWorker.js:340:7)
          at Object.worker (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-runner/build/testWorker.js:494:12)

      158 |     )
      159 |   } catch (error) {
    > 160 |     console.error("Solo game creation error:", error)
          |             ^
      161 |
      162 |     return NextResponse.json(
      163 |       {

      at error (src/app/api/solo/create/route.ts:160:13)
      at Object.<anonymous> (src/app/api/solo/create/__tests__/route.test.ts:145:22)

PASS src/components/common/__tests__/BaseRyukyokuForm.test.tsx
  ‚óè Console

    console.error
      Ryukyoku submission failed: Error: ÈÄÅ‰ø°„Ç®„É©„Éº
          at Object.<anonymous> (/Users/nyanpass/source/repos/mahjong-point-manager/src/components/common/__tests__/BaseRyukyokuForm.test.tsx:391:38)
          at Promise.finally.completed (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/jestAdapterInit.js:1559:28)
          at new Promise (<anonymous>)
          at callAsyncCircusFn (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/jestAdapterInit.js:1499:10)
          at _callCircusTest (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/jestAdapterInit.js:1009:40)
          at _runTest (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/jestAdapterInit.js:949:3)
          at _runTestsForDescribeBlock (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/jestAdapterInit.js:839:13)
          at _runTestsForDescribeBlock (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/jestAdapterInit.js:829:11)
          at _runTestsForDescribeBlock (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/jestAdapterInit.js:829:11)
          at run (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/jestAdapterInit.js:757:3)
          at runAndTransformResultsToJestFormat (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/jestAdapterInit.js:1920:21)
          at jestAdapter (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/runner.js:101:19)
          at runTestInternal (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-runner/build/testWorker.js:272:16)
          at runTest (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-runner/build/testWorker.js:340:7)
          at Object.worker (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-runner/build/testWorker.js:494:12)

      39 |       await onSubmit(tenpaiPlayerIds)
      40 |     } catch (error) {
    > 41 |       console.error("Ryukyoku submission failed:", error)
         |               ^
      42 |     }
      43 |   }
      44 |

      at error (src/components/common/BaseRyukyokuForm.tsx:41:15)

PASS src/store/__tests__/useAppStore.test.ts
PASS src/__tests__/api/unified-api.test.ts
  ‚óè Console

    console.log
      Fetching unified game state for gameId: solo-game-id

      at log (src/app/api/game/[gameId]/route.ts:22:13)

    console.log
      Found solo game: { id: 'solo-game-id', status: 'PLAYING', playersCount: 4 }

      at log (src/app/api/game/[gameId]/route.ts:94:15)

    console.log
      Fetching unified game state for gameId: multi-game-id

      at log (src/app/api/game/[gameId]/route.ts:22:13)

    console.log
      Found multiplayer game: { id: 'multi-game-id', status: 'PLAYING', participantsCount: 2 }

      at log (src/app/api/game/[gameId]/route.ts:37:15)

    console.log
      Fetching unified game state for gameId: non-existent-id

      at log (src/app/api/game/[gameId]/route.ts:22:13)

    console.log
      Processing unified force-end for gameId: solo-game-id reason: „ÉÜ„Çπ„ÉàÂº∑Âà∂ÁµÇ‰∫Ü

      at log (src/app/api/game/[gameId]/route.ts:293:13)

    console.log
      Processing as solo force-end

      at log (src/app/api/game/[gameId]/route.ts:384:15)

PASS src/components/__tests__/GameResult.test.tsx
  ‚óè Console

    console.log
      GameResult API Response: {
        status: undefined,
        data: {
          success: true,
          data: {
            gameId: 'test-game-id',
            roomCode: 'TEST123',
            results: [Array],
            gameType: 'TONPUU',
            endReason: 'Êù±4Â±ÄÁµÇ‰∫Ü',
            endedAt: '2023-01-01T12:00:00Z',
            basePoints: 30000,
            sessionId: 'test-session-id',
            sessionCode: 'SES123',
            sessionName: '„ÉÜ„Çπ„Éà„Çª„ÉÉ„Ç∑„Éß„É≥',
            hostPlayerId: 'player1'
          }
        }
      }

      at log (src/components/GameResult.tsx:109:15)

    console.log
      Setting result data: {
        gameId: 'test-game-id',
        roomCode: 'TEST123',
        results: [
          {
            playerId: 'player1',
            name: '„ÉÜ„Çπ„Éà„Éó„É¨„Ç§„É§„Éº1',
            finalPoints: 35000,
            rank: 1,
            uma: 3000,
            settlement: 8000
          },
          {
            playerId: 'player2',
            name: '„ÉÜ„Çπ„Éà„Éó„É¨„Ç§„É§„Éº2',
            finalPoints: 28000,
            rank: 2,
            uma: 1000,
            settlement: -2000
          },
          {
            playerId: 'player3',
            name: '„ÉÜ„Çπ„Éà„Éó„É¨„Ç§„É§„Éº3',
            finalPoints: 22000,
            rank: 3,
            uma: -1000,
            settlement: -3000
          },
          {
            playerId: 'player4',
            name: '„ÉÜ„Çπ„Éà„Éó„É¨„Ç§„É§„Éº4',
            finalPoints: 15000,
            rank: 4,
            uma: -3000,
            settlement: -3000
          }
        ],
        gameType: 'TONPUU',
        endReason: 'Êù±4Â±ÄÁµÇ‰∫Ü',
        endedAt: '2023-01-01T12:00:00Z',
        basePoints: 30000,
        sessionId: 'test-session-id',
        sessionCode: 'SES123',
        sessionName: '„ÉÜ„Çπ„Éà„Çª„ÉÉ„Ç∑„Éß„É≥',
        hostPlayerId: 'player1'
      }

      at log (src/components/GameResult.tsx:116:17)

    console.log
      GameResult API Response: {
        status: undefined,
        data: {
          success: true,
          data: {
            gameId: 'test-game-id',
            roomCode: 'TEST123',
            results: [Array],
            gameType: 'TONPUU',
            endReason: 'Êù±4Â±ÄÁµÇ‰∫Ü',
            endedAt: '2023-01-01T12:00:00Z',
            basePoints: 30000,
            sessionId: 'test-session-id',
            sessionCode: 'SES123',
            sessionName: '„ÉÜ„Çπ„Éà„Çª„ÉÉ„Ç∑„Éß„É≥',
            hostPlayerId: 'player1'
          }
        }
      }

      at log (src/components/GameResult.tsx:109:15)

    console.log
      Setting result data: {
        gameId: 'test-game-id',
        roomCode: 'TEST123',
        results: [
          {
            playerId: 'player1',
            name: '„ÉÜ„Çπ„Éà„Éó„É¨„Ç§„É§„Éº1',
            finalPoints: 35000,
            rank: 1,
            uma: 3000,
            settlement: 8000
          },
          {
            playerId: 'player2',
            name: '„ÉÜ„Çπ„Éà„Éó„É¨„Ç§„É§„Éº2',
            finalPoints: 28000,
            rank: 2,
            uma: 1000,
            settlement: -2000
          },
          {
            playerId: 'player3',
            name: '„ÉÜ„Çπ„Éà„Éó„É¨„Ç§„É§„Éº3',
            finalPoints: 22000,
            rank: 3,
            uma: -1000,
            settlement: -3000
          },
          {
            playerId: 'player4',
            name: '„ÉÜ„Çπ„Éà„Éó„É¨„Ç§„É§„Éº4',
            finalPoints: 15000,
            rank: 4,
            uma: -3000,
            settlement: -3000
          }
        ],
        gameType: 'TONPUU',
        endReason: 'Êù±4Â±ÄÁµÇ‰∫Ü',
        endedAt: '2023-01-01T12:00:00Z',
        basePoints: 30000,
        sessionId: 'test-session-id',
        sessionCode: 'SES123',
        sessionName: '„ÉÜ„Çπ„Éà„Çª„ÉÉ„Ç∑„Éß„É≥',
        hostPlayerId: 'player1'
      }

      at log (src/components/GameResult.tsx:116:17)

    console.log
      GameResult API Response: {
        status: undefined,
        data: {
          success: true,
          data: {
            gameId: 'test-game-id',
            roomCode: 'TEST123',
            results: [Array],
            gameType: 'TONPUU',
            endReason: 'Êù±4Â±ÄÁµÇ‰∫Ü',
            endedAt: '2023-01-01T12:00:00Z',
            basePoints: 30000,
            sessionId: 'test-session-id',
            sessionCode: 'SES123',
            sessionName: '„ÉÜ„Çπ„Éà„Çª„ÉÉ„Ç∑„Éß„É≥',
            hostPlayerId: undefined
          }
        }
      }

      at log (src/components/GameResult.tsx:109:15)

    console.log
      Setting result data: {
        gameId: 'test-game-id',
        roomCode: 'TEST123',
        results: [
          {
            playerId: 'player1',
            name: '„ÉÜ„Çπ„Éà„Éó„É¨„Ç§„É§„Éº1',
            finalPoints: 35000,
            rank: 1,
            uma: 3000,
            settlement: 8000
          },
          {
            playerId: 'player2',
            name: '„ÉÜ„Çπ„Éà„Éó„É¨„Ç§„É§„Éº2',
            finalPoints: 28000,
            rank: 2,
            uma: 1000,
            settlement: -2000
          },
          {
            playerId: 'player3',
            name: '„ÉÜ„Çπ„Éà„Éó„É¨„Ç§„É§„Éº3',
            finalPoints: 22000,
            rank: 3,
            uma: -1000,
            settlement: -3000
          },
          {
            playerId: 'player4',
            name: '„ÉÜ„Çπ„Éà„Éó„É¨„Ç§„É§„Éº4',
            finalPoints: 15000,
            rank: 4,
            uma: -3000,
            settlement: -3000
          }
        ],
        gameType: 'TONPUU',
        endReason: 'Êù±4Â±ÄÁµÇ‰∫Ü',
        endedAt: '2023-01-01T12:00:00Z',
        basePoints: 30000,
        sessionId: 'test-session-id',
        sessionCode: 'SES123',
        sessionName: '„ÉÜ„Çπ„Éà„Çª„ÉÉ„Ç∑„Éß„É≥',
        hostPlayerId: undefined
      }

      at log (src/components/GameResult.tsx:116:17)

    console.log
      GameResult API Response: {
        status: undefined,
        data: {
          success: true,
          data: {
            gameId: 'test-game-id',
            roomCode: 'TEST123',
            results: [Array],
            gameType: 'TONPUU',
            endReason: 'Êù±4Â±ÄÁµÇ‰∫Ü',
            endedAt: '2023-01-01T12:00:00Z',
            basePoints: 30000,
            sessionId: 'test-session-id',
            sessionCode: 'SES123',
            sessionName: '„ÉÜ„Çπ„Éà„Çª„ÉÉ„Ç∑„Éß„É≥',
            hostPlayerId: 'player3'
          }
        }
      }

      at log (src/components/GameResult.tsx:109:15)

    console.log
      Setting result data: {
        gameId: 'test-game-id',
        roomCode: 'TEST123',
        results: [
          {
            playerId: 'player1',
            name: '„ÉÜ„Çπ„Éà„Éó„É¨„Ç§„É§„Éº1',
            finalPoints: 35000,
            rank: 1,
            uma: 3000,
            settlement: 8000
          },
          {
            playerId: 'player2',
            name: '„ÉÜ„Çπ„Éà„Éó„É¨„Ç§„É§„Éº2',
            finalPoints: 28000,
            rank: 2,
            uma: 1000,
            settlement: -2000
          },
          {
            playerId: 'player3',
            name: '„ÉÜ„Çπ„Éà„Éó„É¨„Ç§„É§„Éº3',
            finalPoints: 22000,
            rank: 3,
            uma: -1000,
            settlement: -3000
          },
          {
            playerId: 'player4',
            name: '„ÉÜ„Çπ„Éà„Éó„É¨„Ç§„É§„Éº4',
            finalPoints: 15000,
            rank: 4,
            uma: -3000,
            settlement: -3000
          }
        ],
        gameType: 'TONPUU',
        endReason: 'Êù±4Â±ÄÁµÇ‰∫Ü',
        endedAt: '2023-01-01T12:00:00Z',
        basePoints: 30000,
        sessionId: 'test-session-id',
        sessionCode: 'SES123',
        sessionName: '„ÉÜ„Çπ„Éà„Çª„ÉÉ„Ç∑„Éß„É≥',
        hostPlayerId: 'player3'
      }

      at log (src/components/GameResult.tsx:116:17)

    console.log
      GameResult API Response: {
        status: undefined,
        data: {
          success: true,
          data: {
            gameId: 'test-game-id',
            roomCode: 'TEST123',
            results: [Array],
            gameType: 'TONPUU',
            endReason: 'Êù±4Â±ÄÁµÇ‰∫Ü',
            endedAt: '2023-01-01T12:00:00Z',
            basePoints: 30000,
            sessionId: 'test-session-id',
            sessionCode: 'SES123',
            sessionName: '„ÉÜ„Çπ„Éà„Çª„ÉÉ„Ç∑„Éß„É≥',
            hostPlayerId: 'player1'
          }
        }
      }

      at log (src/components/GameResult.tsx:109:15)

    console.log
      Setting result data: {
        gameId: 'test-game-id',
        roomCode: 'TEST123',
        results: [
          {
            playerId: 'player1',
            name: '„ÉÜ„Çπ„Éà„Éó„É¨„Ç§„É§„Éº1',
            finalPoints: 35000,
            rank: 1,
            uma: 3000,
            settlement: 8000
          },
          {
            playerId: 'player2',
            name: '„ÉÜ„Çπ„Éà„Éó„É¨„Ç§„É§„Éº2',
            finalPoints: 28000,
            rank: 2,
            uma: 1000,
            settlement: -2000
          },
          {
            playerId: 'player3',
            name: '„ÉÜ„Çπ„Éà„Éó„É¨„Ç§„É§„Éº3',
            finalPoints: 22000,
            rank: 3,
            uma: -1000,
            settlement: -3000
          },
          {
            playerId: 'player4',
            name: '„ÉÜ„Çπ„Éà„Éó„É¨„Ç§„É§„Éº4',
            finalPoints: 15000,
            rank: 4,
            uma: -3000,
            settlement: -3000
          }
        ],
        gameType: 'TONPUU',
        endReason: 'Êù±4Â±ÄÁµÇ‰∫Ü',
        endedAt: '2023-01-01T12:00:00Z',
        basePoints: 30000,
        sessionId: 'test-session-id',
        sessionCode: 'SES123',
        sessionName: '„ÉÜ„Çπ„Éà„Çª„ÉÉ„Ç∑„Éß„É≥',
        hostPlayerId: 'player1'
      }

      at log (src/components/GameResult.tsx:116:17)

    console.log
      GameResult API Response: {
        status: undefined,
        data: {
          success: true,
          data: {
            gameId: 'test-game-id',
            roomCode: 'TEST123',
            results: [Array],
            gameType: 'TONPUU',
            endReason: 'Êù±4Â±ÄÁµÇ‰∫Ü',
            endedAt: '2023-01-01T12:00:00Z',
            basePoints: 30000,
            sessionId: 'test-session-id',
            sessionCode: 'SES123',
            sessionName: '„ÉÜ„Çπ„Éà„Çª„ÉÉ„Ç∑„Éß„É≥',
            hostPlayerId: 'player1'
          }
        }
      }

      at log (src/components/GameResult.tsx:109:15)

    console.log
      Setting result data: {
        gameId: 'test-game-id',
        roomCode: 'TEST123',
        results: [
          {
            playerId: 'player1',
            name: '„ÉÜ„Çπ„Éà„Éó„É¨„Ç§„É§„Éº1',
            finalPoints: 35000,
            rank: 1,
            uma: 3000,
            settlement: 8000
          },
          {
            playerId: 'player2',
            name: '„ÉÜ„Çπ„Éà„Éó„É¨„Ç§„É§„Éº2',
            finalPoints: 28000,
            rank: 2,
            uma: 1000,
            settlement: -2000
          },
          {
            playerId: 'player3',
            name: '„ÉÜ„Çπ„Éà„Éó„É¨„Ç§„É§„Éº3',
            finalPoints: 22000,
            rank: 3,
            uma: -1000,
            settlement: -3000
          },
          {
            playerId: 'player4',
            name: '„ÉÜ„Çπ„Éà„Éó„É¨„Ç§„É§„Éº4',
            finalPoints: 15000,
            rank: 4,
            uma: -3000,
            settlement: -3000
          }
        ],
        gameType: 'TONPUU',
        endReason: 'Êù±4Â±ÄÁµÇ‰∫Ü',
        endedAt: '2023-01-01T12:00:00Z',
        basePoints: 30000,
        sessionId: 'test-session-id',
        sessionCode: 'SES123',
        sessionName: '„ÉÜ„Çπ„Éà„Çª„ÉÉ„Ç∑„Éß„É≥',
        hostPlayerId: 'player1'
      }

      at log (src/components/GameResult.tsx:116:17)

    console.log
      GameResult API Response: {
        status: undefined,
        data: {
          success: true,
          data: {
            gameId: 'test-game-id',
            roomCode: 'TEST123',
            results: [Array],
            gameType: 'TONPUU',
            endReason: 'Êù±4Â±ÄÁµÇ‰∫Ü',
            endedAt: '2023-01-01T12:00:00Z',
            basePoints: 30000,
            sessionId: 'test-session-id',
            sessionCode: 'SES123',
            sessionName: '„ÉÜ„Çπ„Éà„Çª„ÉÉ„Ç∑„Éß„É≥',
            hostPlayerId: 'player1'
          }
        }
      }

      at log (src/components/GameResult.tsx:109:15)

    console.log
      Setting result data: {
        gameId: 'test-game-id',
        roomCode: 'TEST123',
        results: [
          {
            playerId: 'player1',
            name: '„ÉÜ„Çπ„Éà„Éó„É¨„Ç§„É§„Éº1',
            finalPoints: 35000,
            rank: 1,
            uma: 3000,
            settlement: 8000
          },
          {
            playerId: 'player2',
            name: '„ÉÜ„Çπ„Éà„Éó„É¨„Ç§„É§„Éº2',
            finalPoints: 28000,
            rank: 2,
            uma: 1000,
            settlement: -2000
          },
          {
            playerId: 'player3',
            name: '„ÉÜ„Çπ„Éà„Éó„É¨„Ç§„É§„Éº3',
            finalPoints: 22000,
            rank: 3,
            uma: -1000,
            settlement: -3000
          },
          {
            playerId: 'player4',
            name: '„ÉÜ„Çπ„Éà„Éó„É¨„Ç§„É§„Éº4',
            finalPoints: 15000,
            rank: 4,
            uma: -3000,
            settlement: -3000
          }
        ],
        gameType: 'TONPUU',
        endReason: 'Êù±4Â±ÄÁµÇ‰∫Ü',
        endedAt: '2023-01-01T12:00:00Z',
        basePoints: 30000,
        sessionId: 'test-session-id',
        sessionCode: 'SES123',
        sessionName: '„ÉÜ„Çπ„Éà„Çª„ÉÉ„Ç∑„Éß„É≥',
        hostPlayerId: 'player1'
      }

      at log (src/components/GameResult.tsx:116:17)

    console.log
      GameResult API Response: {
        status: undefined,
        data: {
          success: true,
          data: {
            gameId: 'test-game-id',
            roomCode: 'TEST123',
            results: [Array],
            gameType: 'TONPUU',
            endReason: 'Êù±4Â±ÄÁµÇ‰∫Ü',
            endedAt: '2023-01-01T12:00:00Z',
            basePoints: 30000,
            sessionId: 'test-session-id',
            sessionCode: 'SES123',
            sessionName: '„ÉÜ„Çπ„Éà„Çª„ÉÉ„Ç∑„Éß„É≥',
            hostPlayerId: 'player1'
          }
        }
      }

      at log (src/components/GameResult.tsx:109:15)

    console.log
      Setting result data: {
        gameId: 'test-game-id',
        roomCode: 'TEST123',
        results: [
          {
            playerId: 'player1',
            name: '„ÉÜ„Çπ„Éà„Éó„É¨„Ç§„É§„Éº1',
            finalPoints: 35000,
            rank: 1,
            uma: 3000,
            settlement: 8000
          },
          {
            playerId: 'player2',
            name: '„ÉÜ„Çπ„Éà„Éó„É¨„Ç§„É§„Éº2',
            finalPoints: 28000,
            rank: 2,
            uma: 1000,
            settlement: -2000
          },
          {
            playerId: 'player3',
            name: '„ÉÜ„Çπ„Éà„Éó„É¨„Ç§„É§„Éº3',
            finalPoints: 22000,
            rank: 3,
            uma: -1000,
            settlement: -3000
          },
          {
            playerId: 'player4',
            name: '„ÉÜ„Çπ„Éà„Éó„É¨„Ç§„É§„Éº4',
            finalPoints: 15000,
            rank: 4,
            uma: -3000,
            settlement: -3000
          }
        ],
        gameType: 'TONPUU',
        endReason: 'Êù±4Â±ÄÁµÇ‰∫Ü',
        endedAt: '2023-01-01T12:00:00Z',
        basePoints: 30000,
        sessionId: 'test-session-id',
        sessionCode: 'SES123',
        sessionName: '„ÉÜ„Çπ„Éà„Çª„ÉÉ„Ç∑„Éß„É≥',
        hostPlayerId: 'player1'
      }

      at log (src/components/GameResult.tsx:116:17)

    console.log
      GameResult API Response: {
        status: undefined,
        data: {
          success: true,
          data: {
            gameId: 'test-game-id',
            roomCode: 'TEST123',
            results: [Array],
            gameType: 'TONPUU',
            endReason: 'Êù±4Â±ÄÁµÇ‰∫Ü',
            endedAt: '2023-01-01T12:00:00Z',
            basePoints: 30000,
            sessionId: undefined,
            sessionCode: 'SES123',
            sessionName: '„ÉÜ„Çπ„Éà„Çª„ÉÉ„Ç∑„Éß„É≥',
            hostPlayerId: 'player1'
          }
        }
      }

      at log (src/components/GameResult.tsx:109:15)

    console.log
      Setting result data: {
        gameId: 'test-game-id',
        roomCode: 'TEST123',
        results: [
          {
            playerId: 'player1',
            name: '„ÉÜ„Çπ„Éà„Éó„É¨„Ç§„É§„Éº1',
            finalPoints: 35000,
            rank: 1,
            uma: 3000,
            settlement: 8000
          },
          {
            playerId: 'player2',
            name: '„ÉÜ„Çπ„Éà„Éó„É¨„Ç§„É§„Éº2',
            finalPoints: 28000,
            rank: 2,
            uma: 1000,
            settlement: -2000
          },
          {
            playerId: 'player3',
            name: '„ÉÜ„Çπ„Éà„Éó„É¨„Ç§„É§„Éº3',
            finalPoints: 22000,
            rank: 3,
            uma: -1000,
            settlement: -3000
          },
          {
            playerId: 'player4',
            name: '„ÉÜ„Çπ„Éà„Éó„É¨„Ç§„É§„Éº4',
            finalPoints: 15000,
            rank: 4,
            uma: -3000,
            settlement: -3000
          }
        ],
        gameType: 'TONPUU',
        endReason: 'Êù±4Â±ÄÁµÇ‰∫Ü',
        endedAt: '2023-01-01T12:00:00Z',
        basePoints: 30000,
        sessionId: undefined,
        sessionCode: 'SES123',
        sessionName: '„ÉÜ„Çπ„Éà„Çª„ÉÉ„Ç∑„Éß„É≥',
        hostPlayerId: 'player1'
      }

      at log (src/components/GameResult.tsx:116:17)

    console.log
      GameResult API Response: {
        status: undefined,
        data: {
          success: true,
          data: {
            gameId: 'test-game-id',
            roomCode: 'TEST123',
            results: [Array],
            gameType: 'TONPUU',
            endReason: 'Êù±4Â±ÄÁµÇ‰∫Ü',
            endedAt: '2023-01-01T12:00:00Z',
            basePoints: 30000,
            sessionId: 'test-session-id',
            sessionCode: 'SES123',
            sessionName: '„ÉÜ„Çπ„Éà„Çª„ÉÉ„Ç∑„Éß„É≥',
            hostPlayerId: 'player1'
          }
        }
      }

      at log (src/components/GameResult.tsx:109:15)

    console.log
      Setting result data: {
        gameId: 'test-game-id',
        roomCode: 'TEST123',
        results: [
          {
            playerId: 'player1',
            name: '„ÉÜ„Çπ„Éà„Éó„É¨„Ç§„É§„Éº1',
            finalPoints: 35000,
            rank: 1,
            uma: 3000,
            settlement: 8000
          },
          {
            playerId: 'player2',
            name: '„ÉÜ„Çπ„Éà„Éó„É¨„Ç§„É§„Éº2',
            finalPoints: 28000,
            rank: 2,
            uma: 1000,
            settlement: -2000
          },
          {
            playerId: 'player3',
            name: '„ÉÜ„Çπ„Éà„Éó„É¨„Ç§„É§„Éº3',
            finalPoints: 22000,
            rank: 3,
            uma: -1000,
            settlement: -3000
          },
          {
            playerId: 'player4',
            name: '„ÉÜ„Çπ„Éà„Éó„É¨„Ç§„É§„Éº4',
            finalPoints: 15000,
            rank: 4,
            uma: -3000,
            settlement: -3000
          }
        ],
        gameType: 'TONPUU',
        endReason: 'Êù±4Â±ÄÁµÇ‰∫Ü',
        endedAt: '2023-01-01T12:00:00Z',
        basePoints: 30000,
        sessionId: 'test-session-id',
        sessionCode: 'SES123',
        sessionName: '„ÉÜ„Çπ„Éà„Çª„ÉÉ„Ç∑„Éß„É≥',
        hostPlayerId: 'player1'
      }

      at log (src/components/GameResult.tsx:116:17)

    console.log
      GameResult API Response: {
        status: undefined,
        data: {
          success: true,
          data: {
            gameId: 'test-game-id',
            roomCode: 'TEST123',
            results: [Array],
            gameType: 'TONPUU',
            endReason: 'Êù±4Â±ÄÁµÇ‰∫Ü',
            endedAt: '2023-01-01T12:00:00Z',
            basePoints: 30000,
            sessionId: 'test-session-id',
            sessionCode: 'SES123',
            sessionName: '„ÉÜ„Çπ„Éà„Çª„ÉÉ„Ç∑„Éß„É≥',
            hostPlayerId: 'player1'
          }
        }
      }

      at log (src/components/GameResult.tsx:109:15)

    console.log
      Setting result data: {
        gameId: 'test-game-id',
        roomCode: 'TEST123',
        results: [
          {
            playerId: 'player1',
            name: '„ÉÜ„Çπ„Éà„Éó„É¨„Ç§„É§„Éº1',
            finalPoints: 35000,
            rank: 1,
            uma: 3000,
            settlement: 8000
          },
          {
            playerId: 'player2',
            name: '„ÉÜ„Çπ„Éà„Éó„É¨„Ç§„É§„Éº2',
            finalPoints: 28000,
            rank: 2,
            uma: 1000,
            settlement: -2000
          },
          {
            playerId: 'player3',
            name: '„ÉÜ„Çπ„Éà„Éó„É¨„Ç§„É§„Éº3',
            finalPoints: 22000,
            rank: 3,
            uma: -1000,
            settlement: -3000
          },
          {
            playerId: 'player4',
            name: '„ÉÜ„Çπ„Éà„Éó„É¨„Ç§„É§„Éº4',
            finalPoints: 15000,
            rank: 4,
            uma: -3000,
            settlement: -3000
          }
        ],
        gameType: 'TONPUU',
        endReason: 'Êù±4Â±ÄÁµÇ‰∫Ü',
        endedAt: '2023-01-01T12:00:00Z',
        basePoints: 30000,
        sessionId: 'test-session-id',
        sessionCode: 'SES123',
        sessionName: '„ÉÜ„Çπ„Éà„Çª„ÉÉ„Ç∑„Éß„É≥',
        hostPlayerId: 'player1'
      }

      at log (src/components/GameResult.tsx:116:17)

    console.error
      Warning: An update to GameResult inside a test was not wrapped in act(...).
      
      When testing, code that causes React state updates should be wrapped into act(...):
      
      act(() => {
        /* fire events that update state */
      });
      /* assert on the output */
      
      This ensures that you're testing the behavior the user would see in the browser. Learn more at https://reactjs.org/link/wrap-tests-with-act
          at gameId (/Users/nyanpass/source/repos/mahjong-point-manager/src/components/GameResult.tsx:46:3)

      368 |
      369 |       // ÊàêÂäüÊôÇ„ÅØ„É¢„Éº„ÉÄ„É´„ÇíÈñâ„Åò„Å¶„ÄÅÂ∞ë„ÅóÂæÖ„Å£„Å¶„Åã„Çâ„Éõ„Éº„É†„Å´ÈÅ∑Áßª
    > 370 |       setShowForceEndModal(false)
          |       ^
      371 |
      372 |       // ‰ªñ„ÅÆ„Éó„É¨„Ç§„É§„Éº„ÅåÈÄöÁü•„ÇíÁ¢∫Ë™ç„Åß„Åç„Çã„Çà„ÅÜ2ÁßíÂæÖÊ©ü
      373 |       setTimeout(() => {

      at printWarning (node_modules/react-dom/cjs/react-dom.development.js:86:30)
      at error (node_modules/react-dom/cjs/react-dom.development.js:60:7)
      at warnIfUpdatesNotWrappedWithActDEV (node_modules/react-dom/cjs/react-dom.development.js:27628:9)
      at scheduleUpdateOnFiber (node_modules/react-dom/cjs/react-dom.development.js:25547:5)
      at dispatchSetState (node_modules/react-dom/cjs/react-dom.development.js:16708:7)
      at setShowForceEndModal (src/components/GameResult.tsx:370:7)

    console.error
      Warning: An update to GameResult inside a test was not wrapped in act(...).
      
      When testing, code that causes React state updates should be wrapped into act(...):
      
      act(() => {
        /* fire events that update state */
      });
      /* assert on the output */
      
      This ensures that you're testing the behavior the user would see in the browser. Learn more at https://reactjs.org/link/wrap-tests-with-act
          at gameId (/Users/nyanpass/source/repos/mahjong-point-manager/src/components/GameResult.tsx:46:3)

      378 |       setGlobalError("„Çª„ÉÉ„Ç∑„Éß„É≥ÁµÇ‰∫Ü„Å´Â§±Êïó„Åó„Åæ„Åó„Åü")
      379 |     } finally {
    > 380 |       setIsForceEnding(false)
          |       ^
      381 |     }
      382 |   }
      383 |

      at printWarning (node_modules/react-dom/cjs/react-dom.development.js:86:30)
      at error (node_modules/react-dom/cjs/react-dom.development.js:60:7)
      at warnIfUpdatesNotWrappedWithActDEV (node_modules/react-dom/cjs/react-dom.development.js:27628:9)
      at scheduleUpdateOnFiber (node_modules/react-dom/cjs/react-dom.development.js:25547:5)
      at dispatchSetState (node_modules/react-dom/cjs/react-dom.development.js:16708:7)
      at setIsForceEnding (src/components/GameResult.tsx:380:7)

    console.log
      GameResult API Response: {
        status: undefined,
        data: {
          success: true,
          data: {
            gameId: 'test-game-id',
            roomCode: 'TEST123',
            results: [Array],
            gameType: 'TONPUU',
            endReason: 'Êù±4Â±ÄÁµÇ‰∫Ü',
            endedAt: '2023-01-01T12:00:00Z',
            basePoints: 30000,
            sessionId: 'test-session-id',
            sessionCode: 'SES123',
            sessionName: '„ÉÜ„Çπ„Éà„Çª„ÉÉ„Ç∑„Éß„É≥',
            hostPlayerId: 'player1'
          }
        }
      }

      at log (src/components/GameResult.tsx:109:15)

    console.log
      Setting result data: {
        gameId: 'test-game-id',
        roomCode: 'TEST123',
        results: [
          {
            playerId: 'player1',
            name: '„ÉÜ„Çπ„Éà„Éó„É¨„Ç§„É§„Éº1',
            finalPoints: 35000,
            rank: 1,
            uma: 3000,
            settlement: 8000
          },
          {
            playerId: 'player2',
            name: '„ÉÜ„Çπ„Éà„Éó„É¨„Ç§„É§„Éº2',
            finalPoints: 28000,
            rank: 2,
            uma: 1000,
            settlement: -2000
          },
          {
            playerId: 'player3',
            name: '„ÉÜ„Çπ„Éà„Éó„É¨„Ç§„É§„Éº3',
            finalPoints: 22000,
            rank: 3,
            uma: -1000,
            settlement: -3000
          },
          {
            playerId: 'player4',
            name: '„ÉÜ„Çπ„Éà„Éó„É¨„Ç§„É§„Éº4',
            finalPoints: 15000,
            rank: 4,
            uma: -3000,
            settlement: -3000
          }
        ],
        gameType: 'TONPUU',
        endReason: 'Êù±4Â±ÄÁµÇ‰∫Ü',
        endedAt: '2023-01-01T12:00:00Z',
        basePoints: 30000,
        sessionId: 'test-session-id',
        sessionCode: 'SES123',
        sessionName: '„ÉÜ„Çπ„Éà„Çª„ÉÉ„Ç∑„Éß„É≥',
        hostPlayerId: 'player1'
      }

      at log (src/components/GameResult.tsx:116:17)

    console.log
      GameResult API Response: {
        status: undefined,
        data: {
          success: true,
          data: {
            gameId: 'test-game-id',
            roomCode: 'TEST123',
            results: [Array],
            gameType: 'TONPUU',
            endReason: 'Êù±4Â±ÄÁµÇ‰∫Ü',
            endedAt: '2023-01-01T12:00:00Z',
            basePoints: 30000,
            sessionId: 'test-session-id',
            sessionCode: 'SES123',
            sessionName: '„ÉÜ„Çπ„Éà„Çª„ÉÉ„Ç∑„Éß„É≥',
            hostPlayerId: 'player1'
          }
        }
      }

      at log (src/components/GameResult.tsx:109:15)

    console.log
      Setting result data: {
        gameId: 'test-game-id',
        roomCode: 'TEST123',
        results: [
          {
            playerId: 'player1',
            name: '„ÉÜ„Çπ„Éà„Éó„É¨„Ç§„É§„Éº1',
            finalPoints: 35000,
            rank: 1,
            uma: 3000,
            settlement: 8000
          },
          {
            playerId: 'player2',
            name: '„ÉÜ„Çπ„Éà„Éó„É¨„Ç§„É§„Éº2',
            finalPoints: 28000,
            rank: 2,
            uma: 1000,
            settlement: -2000
          },
          {
            playerId: 'player3',
            name: '„ÉÜ„Çπ„Éà„Éó„É¨„Ç§„É§„Éº3',
            finalPoints: 22000,
            rank: 3,
            uma: -1000,
            settlement: -3000
          },
          {
            playerId: 'player4',
            name: '„ÉÜ„Çπ„Éà„Éó„É¨„Ç§„É§„Éº4',
            finalPoints: 15000,
            rank: 4,
            uma: -3000,
            settlement: -3000
          }
        ],
        gameType: 'TONPUU',
        endReason: 'Êù±4Â±ÄÁµÇ‰∫Ü',
        endedAt: '2023-01-01T12:00:00Z',
        basePoints: 30000,
        sessionId: 'test-session-id',
        sessionCode: 'SES123',
        sessionName: '„ÉÜ„Çπ„Éà„Çª„ÉÉ„Ç∑„Éß„É≥',
        hostPlayerId: 'player1'
      }

      at log (src/components/GameResult.tsx:116:17)

    console.log
      GameResult API Response: {
        status: undefined,
        data: {
          success: true,
          data: {
            gameId: 'test-game-id',
            roomCode: 'TEST123',
            results: [Array],
            gameType: 'TONPUU',
            endReason: 'Êù±4Â±ÄÁµÇ‰∫Ü',
            endedAt: '2023-01-01T12:00:00Z',
            basePoints: 30000,
            sessionId: 'test-session-id',
            sessionCode: 'SES123',
            sessionName: '„ÉÜ„Çπ„Éà„Çª„ÉÉ„Ç∑„Éß„É≥',
            hostPlayerId: 'player1'
          }
        }
      }

      at log (src/components/GameResult.tsx:109:15)

    console.log
      Setting result data: {
        gameId: 'test-game-id',
        roomCode: 'TEST123',
        results: [
          {
            playerId: 'player1',
            name: '„ÉÜ„Çπ„Éà„Éó„É¨„Ç§„É§„Éº1',
            finalPoints: 35000,
            rank: 1,
            uma: 3000,
            settlement: 8000
          },
          {
            playerId: 'player2',
            name: '„ÉÜ„Çπ„Éà„Éó„É¨„Ç§„É§„Éº2',
            finalPoints: 28000,
            rank: 2,
            uma: 1000,
            settlement: -2000
          },
          {
            playerId: 'player3',
            name: '„ÉÜ„Çπ„Éà„Éó„É¨„Ç§„É§„Éº3',
            finalPoints: 22000,
            rank: 3,
            uma: -1000,
            settlement: -3000
          },
          {
            playerId: 'player4',
            name: '„ÉÜ„Çπ„Éà„Éó„É¨„Ç§„É§„Éº4',
            finalPoints: 15000,
            rank: 4,
            uma: -3000,
            settlement: -3000
          }
        ],
        gameType: 'TONPUU',
        endReason: 'Êù±4Â±ÄÁµÇ‰∫Ü',
        endedAt: '2023-01-01T12:00:00Z',
        basePoints: 30000,
        sessionId: 'test-session-id',
        sessionCode: 'SES123',
        sessionName: '„ÉÜ„Çπ„Éà„Çª„ÉÉ„Ç∑„Éß„É≥',
        hostPlayerId: 'player1'
      }

      at log (src/components/GameResult.tsx:116:17)

    console.log
      GameResult API Response: {
        status: undefined,
        data: {
          success: true,
          data: {
            gameId: 'test-game-id',
            roomCode: 'TEST123',
            results: [Array],
            gameType: 'TONPUU',
            endReason: 'Êù±4Â±ÄÁµÇ‰∫Ü',
            endedAt: '2023-01-01T12:00:00Z',
            basePoints: 30000,
            sessionId: 'test-session-id',
            sessionCode: 'SES123',
            sessionName: '„ÉÜ„Çπ„Éà„Çª„ÉÉ„Ç∑„Éß„É≥',
            hostPlayerId: 'player1'
          }
        }
      }

      at log (src/components/GameResult.tsx:109:15)

    console.log
      Setting result data: {
        gameId: 'test-game-id',
        roomCode: 'TEST123',
        results: [
          {
            playerId: 'player1',
            name: '„ÉÜ„Çπ„Éà„Éó„É¨„Ç§„É§„Éº1',
            finalPoints: 35000,
            rank: 1,
            uma: 3000,
            settlement: 8000
          },
          {
            playerId: 'player2',
            name: '„ÉÜ„Çπ„Éà„Éó„É¨„Ç§„É§„Éº2',
            finalPoints: 28000,
            rank: 2,
            uma: 1000,
            settlement: -2000
          },
          {
            playerId: 'player3',
            name: '„ÉÜ„Çπ„Éà„Éó„É¨„Ç§„É§„Éº3',
            finalPoints: 22000,
            rank: 3,
            uma: -1000,
            settlement: -3000
          },
          {
            playerId: 'player4',
            name: '„ÉÜ„Çπ„Éà„Éó„É¨„Ç§„É§„Éº4',
            finalPoints: 15000,
            rank: 4,
            uma: -3000,
            settlement: -3000
          }
        ],
        gameType: 'TONPUU',
        endReason: 'Êù±4Â±ÄÁµÇ‰∫Ü',
        endedAt: '2023-01-01T12:00:00Z',
        basePoints: 30000,
        sessionId: 'test-session-id',
        sessionCode: 'SES123',
        sessionName: '„ÉÜ„Çπ„Éà„Çª„ÉÉ„Ç∑„Éß„É≥',
        hostPlayerId: 'player1'
      }

      at log (src/components/GameResult.tsx:116:17)

    console.log
      GameResult API Response: {
        status: undefined,
        data: {
          success: true,
          data: {
            gameId: 'test-game-id',
            roomCode: 'TEST123',
            results: [Array],
            gameType: 'TONPUU',
            endReason: 'Êù±4Â±ÄÁµÇ‰∫Ü',
            endedAt: '2023-01-01T12:00:00Z',
            basePoints: 30000,
            sessionId: 'test-session-id',
            sessionCode: 'SES123',
            sessionName: '„ÉÜ„Çπ„Éà„Çª„ÉÉ„Ç∑„Éß„É≥',
            hostPlayerId: 'player1'
          }
        }
      }

      at log (src/components/GameResult.tsx:109:15)

    console.log
      Setting result data: {
        gameId: 'test-game-id',
        roomCode: 'TEST123',
        results: [
          {
            playerId: 'player1',
            name: '„ÉÜ„Çπ„Éà„Éó„É¨„Ç§„É§„Éº1',
            finalPoints: 35000,
            rank: 1,
            uma: 3000,
            settlement: 8000
          },
          {
            playerId: 'player2',
            name: '„ÉÜ„Çπ„Éà„Éó„É¨„Ç§„É§„Éº2',
            finalPoints: 28000,
            rank: 2,
            uma: 1000,
            settlement: -2000
          },
          {
            playerId: 'player3',
            name: '„ÉÜ„Çπ„Éà„Éó„É¨„Ç§„É§„Éº3',
            finalPoints: 22000,
            rank: 3,
            uma: -1000,
            settlement: -3000
          },
          {
            playerId: 'player4',
            name: '„ÉÜ„Çπ„Éà„Éó„É¨„Ç§„É§„Éº4',
            finalPoints: 15000,
            rank: 4,
            uma: -3000,
            settlement: -3000
          }
        ],
        gameType: 'TONPUU',
        endReason: 'Êù±4Â±ÄÁµÇ‰∫Ü',
        endedAt: '2023-01-01T12:00:00Z',
        basePoints: 30000,
        sessionId: 'test-session-id',
        sessionCode: 'SES123',
        sessionName: '„ÉÜ„Çπ„Éà„Çª„ÉÉ„Ç∑„Éß„É≥',
        hostPlayerId: 'player1'
      }

      at log (src/components/GameResult.tsx:116:17)

    console.log
      GameResult API Response: {
        status: undefined,
        data: {
          success: true,
          data: {
            gameId: 'test-game-id',
            roomCode: 'TEST123',
            results: [Array],
            gameType: 'TONPUU',
            endReason: 'Êù±4Â±ÄÁµÇ‰∫Ü',
            endedAt: '2023-01-01T12:00:00Z',
            basePoints: 30000,
            sessionId: 'test-session-id',
            sessionCode: 'SES123',
            sessionName: '„ÉÜ„Çπ„Éà„Çª„ÉÉ„Ç∑„Éß„É≥',
            hostPlayerId: 'player1'
          }
        }
      }

      at log (src/components/GameResult.tsx:109:15)

    console.log
      Setting result data: {
        gameId: 'test-game-id',
        roomCode: 'TEST123',
        results: [
          {
            playerId: 'player1',
            name: '„ÉÜ„Çπ„Éà„Éó„É¨„Ç§„É§„Éº1',
            finalPoints: 35000,
            rank: 1,
            uma: 3000,
            settlement: 8000
          },
          {
            playerId: 'player2',
            name: '„ÉÜ„Çπ„Éà„Éó„É¨„Ç§„É§„Éº2',
            finalPoints: 28000,
            rank: 2,
            uma: 1000,
            settlement: -2000
          },
          {
            playerId: 'player3',
            name: '„ÉÜ„Çπ„Éà„Éó„É¨„Ç§„É§„Éº3',
            finalPoints: 22000,
            rank: 3,
            uma: -1000,
            settlement: -3000
          },
          {
            playerId: 'player4',
            name: '„ÉÜ„Çπ„Éà„Éó„É¨„Ç§„É§„Éº4',
            finalPoints: 15000,
            rank: 4,
            uma: -3000,
            settlement: -3000
          }
        ],
        gameType: 'TONPUU',
        endReason: 'Êù±4Â±ÄÁµÇ‰∫Ü',
        endedAt: '2023-01-01T12:00:00Z',
        basePoints: 30000,
        sessionId: 'test-session-id',
        sessionCode: 'SES123',
        sessionName: '„ÉÜ„Çπ„Éà„Çª„ÉÉ„Ç∑„Éß„É≥',
        hostPlayerId: 'player1'
      }

      at log (src/components/GameResult.tsx:116:17)

    console.log
      ‰ªñ„ÅÆ„Éó„É¨„Ç§„É§„Éº„ÅåÊäïÁ•®„Åó„Åæ„Åó„Åü

      at log (src/components/GameResult.tsx:244:19)

    console.log
      GameResult API Response: {
        status: undefined,
        data: {
          success: true,
          data: {
            gameId: 'test-game-id',
            roomCode: 'TEST123',
            results: [Array],
            gameType: 'TONPUU',
            endReason: 'Êù±4Â±ÄÁµÇ‰∫Ü',
            endedAt: '2023-01-01T12:00:00Z',
            basePoints: 30000,
            sessionId: 'test-session-id',
            sessionCode: 'SES123',
            sessionName: '„ÉÜ„Çπ„Éà„Çª„ÉÉ„Ç∑„Éß„É≥',
            hostPlayerId: 'player1'
          }
        }
      }

      at log (src/components/GameResult.tsx:109:15)

    console.log
      Setting result data: {
        gameId: 'test-game-id',
        roomCode: 'TEST123',
        results: [
          {
            playerId: 'player1',
            name: '„ÉÜ„Çπ„Éà„Éó„É¨„Ç§„É§„Éº1',
            finalPoints: 35000,
            rank: 1,
            uma: 3000,
            settlement: 8000
          },
          {
            playerId: 'player2',
            name: '„ÉÜ„Çπ„Éà„Éó„É¨„Ç§„É§„Éº2',
            finalPoints: 28000,
            rank: 2,
            uma: 1000,
            settlement: -2000
          },
          {
            playerId: 'player3',
            name: '„ÉÜ„Çπ„Éà„Éó„É¨„Ç§„É§„Éº3',
            finalPoints: 22000,
            rank: 3,
            uma: -1000,
            settlement: -3000
          },
          {
            playerId: 'player4',
            name: '„ÉÜ„Çπ„Éà„Éó„É¨„Ç§„É§„Éº4',
            finalPoints: 15000,
            rank: 4,
            uma: -3000,
            settlement: -3000
          }
        ],
        gameType: 'TONPUU',
        endReason: 'Êù±4Â±ÄÁµÇ‰∫Ü',
        endedAt: '2023-01-01T12:00:00Z',
        basePoints: 30000,
        sessionId: 'test-session-id',
        sessionCode: 'SES123',
        sessionName: '„ÉÜ„Çπ„Éà„Çª„ÉÉ„Ç∑„Éß„É≥',
        hostPlayerId: 'player1'
      }

      at log (src/components/GameResult.tsx:116:17)

    console.log
      GameResult API Response: {
        status: undefined,
        data: {
          success: true,
          data: {
            gameId: 'test-game-id',
            roomCode: 'TEST123',
            results: [Array],
            gameType: 'TONPUU',
            endReason: 'Êù±4Â±ÄÁµÇ‰∫Ü',
            endedAt: '2023-01-01T12:00:00Z',
            basePoints: 30000,
            sessionId: 'test-session-id',
            sessionCode: 'SES123',
            sessionName: '„ÉÜ„Çπ„Éà„Çª„ÉÉ„Ç∑„Éß„É≥',
            hostPlayerId: 'player1'
          }
        }
      }

      at log (src/components/GameResult.tsx:109:15)

    console.log
      Setting result data: {
        gameId: 'test-game-id',
        roomCode: 'TEST123',
        results: [
          {
            playerId: 'player1',
            name: '„ÉÜ„Çπ„Éà„Éó„É¨„Ç§„É§„Éº1',
            finalPoints: 35000,
            rank: 1,
            uma: 3000,
            settlement: 8000
          },
          {
            playerId: 'player2',
            name: '„ÉÜ„Çπ„Éà„Éó„É¨„Ç§„É§„Éº2',
            finalPoints: 28000,
            rank: 2,
            uma: 1000,
            settlement: -2000
          },
          {
            playerId: 'player3',
            name: '„ÉÜ„Çπ„Éà„Éó„É¨„Ç§„É§„Éº3',
            finalPoints: 22000,
            rank: 3,
            uma: -1000,
            settlement: -3000
          },
          {
            playerId: 'player4',
            name: '„ÉÜ„Çπ„Éà„Éó„É¨„Ç§„É§„Éº4',
            finalPoints: 15000,
            rank: 4,
            uma: -3000,
            settlement: -3000
          }
        ],
        gameType: 'TONPUU',
        endReason: 'Êù±4Â±ÄÁµÇ‰∫Ü',
        endedAt: '2023-01-01T12:00:00Z',
        basePoints: 30000,
        sessionId: 'test-session-id',
        sessionCode: 'SES123',
        sessionName: '„ÉÜ„Çπ„Éà„Çª„ÉÉ„Ç∑„Éß„É≥',
        hostPlayerId: 'player1'
      }

      at log (src/components/GameResult.tsx:116:17)

    console.log
      GameResult API Response: {
        status: undefined,
        data: {
          success: true,
          data: {
            gameId: 'test-game-id',
            roomCode: 'TEST123',
            results: [Array],
            gameType: 'TONPUU',
            endReason: 'Êù±4Â±ÄÁµÇ‰∫Ü',
            endedAt: '2023-01-01T12:00:00Z',
            basePoints: 30000,
            sessionId: 'test-session-id',
            sessionCode: 'SES123',
            sessionName: '„ÉÜ„Çπ„Éà„Çª„ÉÉ„Ç∑„Éß„É≥',
            hostPlayerId: 'player1'
          }
        }
      }

      at log (src/components/GameResult.tsx:109:15)

    console.log
      Setting result data: {
        gameId: 'test-game-id',
        roomCode: 'TEST123',
        results: [
          {
            playerId: 'player1',
            name: '„ÉÜ„Çπ„Éà„Éó„É¨„Ç§„É§„Éº1',
            finalPoints: 35000,
            rank: 1,
            uma: 3000,
            settlement: 8000
          },
          {
            playerId: 'player2',
            name: '„ÉÜ„Çπ„Éà„Éó„É¨„Ç§„É§„Éº2',
            finalPoints: 28000,
            rank: 2,
            uma: 1000,
            settlement: -2000
          },
          {
            playerId: 'player3',
            name: '„ÉÜ„Çπ„Éà„Éó„É¨„Ç§„É§„Éº3',
            finalPoints: 22000,
            rank: 3,
            uma: -1000,
            settlement: -3000
          },
          {
            playerId: 'player4',
            name: '„ÉÜ„Çπ„Éà„Éó„É¨„Ç§„É§„Éº4',
            finalPoints: 15000,
            rank: 4,
            uma: -3000,
            settlement: -3000
          }
        ],
        gameType: 'TONPUU',
        endReason: 'Êù±4Â±ÄÁµÇ‰∫Ü',
        endedAt: '2023-01-01T12:00:00Z',
        basePoints: 30000,
        sessionId: 'test-session-id',
        sessionCode: 'SES123',
        sessionName: '„ÉÜ„Çπ„Éà„Çª„ÉÉ„Ç∑„Éß„É≥',
        hostPlayerId: 'player1'
      }

      at log (src/components/GameResult.tsx:116:17)

    console.log
      GameResult API Response: {
        status: undefined,
        data: {
          success: true,
          data: {
            gameId: 'test-game-id',
            roomCode: 'TEST123',
            results: [Array],
            gameType: 'TONPUU',
            endReason: 'Êù±4Â±ÄÁµÇ‰∫Ü',
            endedAt: '2023-01-01T12:00:00Z',
            basePoints: 30000,
            sessionId: 'test-session-id',
            sessionCode: 'SES123',
            sessionName: '„ÉÜ„Çπ„Éà„Çª„ÉÉ„Ç∑„Éß„É≥',
            hostPlayerId: 'player1'
          }
        }
      }

      at log (src/components/GameResult.tsx:109:15)

    console.log
      Setting result data: {
        gameId: 'test-game-id',
        roomCode: 'TEST123',
        results: [
          {
            playerId: 'player1',
            name: '„ÉÜ„Çπ„Éà„Éó„É¨„Ç§„É§„Éº1',
            finalPoints: 35000,
            rank: 1,
            uma: 3000,
            settlement: 8000
          },
          {
            playerId: 'player2',
            name: '„ÉÜ„Çπ„Éà„Éó„É¨„Ç§„É§„Éº2',
            finalPoints: 28000,
            rank: 2,
            uma: 1000,
            settlement: -2000
          },
          {
            playerId: 'player3',
            name: '„ÉÜ„Çπ„Éà„Éó„É¨„Ç§„É§„Éº3',
            finalPoints: 22000,
            rank: 3,
            uma: -1000,
            settlement: -3000
          },
          {
            playerId: 'player4',
            name: '„ÉÜ„Çπ„Éà„Éó„É¨„Ç§„É§„Éº4',
            finalPoints: 15000,
            rank: 4,
            uma: -3000,
            settlement: -3000
          }
        ],
        gameType: 'TONPUU',
        endReason: 'Êù±4Â±ÄÁµÇ‰∫Ü',
        endedAt: '2023-01-01T12:00:00Z',
        basePoints: 30000,
        sessionId: 'test-session-id',
        sessionCode: 'SES123',
        sessionName: '„ÉÜ„Çπ„Éà„Çª„ÉÉ„Ç∑„Éß„É≥',
        hostPlayerId: 'player1'
      }

      at log (src/components/GameResult.tsx:116:17)

    console.log
      GameResult API Response: {
        status: 404,
        data: { success: false, error: { message: '„Ç≤„Éº„É†„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì' } }
      }

      at log (src/components/GameResult.tsx:109:15)

    console.error
      fetchGameResult error: Error: „Ç≤„Éº„É†„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì
          at /Users/nyanpass/source/repos/mahjong-point-manager/src/components/GameResult.tsx:112:15

      124 |       }
      125 |     } catch (error) {
    > 126 |       console.error("fetchGameResult error:", error)
          |               ^
      127 |       setError(
      128 |         error instanceof Error ? error.message : "ÁµêÊûú„ÅÆÂèñÂæó„Å´Â§±Êïó„Åó„Åæ„Åó„Åü"
      129 |       )

      at error (src/components/GameResult.tsx:126:15)

    console.error
      fetchGameResult error: Error: Network error
          at Object.<anonymous> (/Users/nyanpass/source/repos/mahjong-point-manager/src/components/__tests__/GameResult.test.tsx:664:52)
          at Promise.finally.completed (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/jestAdapterInit.js:1559:28)
          at new Promise (<anonymous>)
          at callAsyncCircusFn (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/jestAdapterInit.js:1499:10)
          at _callCircusTest (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/jestAdapterInit.js:1009:40)
          at _runTest (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/jestAdapterInit.js:949:3)
          at _runTestsForDescribeBlock (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/jestAdapterInit.js:839:13)
          at _runTestsForDescribeBlock (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/jestAdapterInit.js:829:11)
          at run (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/jestAdapterInit.js:757:3)
          at runAndTransformResultsToJestFormat (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/jestAdapterInit.js:1920:21)
          at jestAdapter (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/runner.js:101:19)
          at runTestInternal (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-runner/build/testWorker.js:272:16)
          at runTest (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-runner/build/testWorker.js:340:7)
          at Object.worker (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-runner/build/testWorker.js:494:12)

      124 |       }
      125 |     } catch (error) {
    > 126 |       console.error("fetchGameResult error:", error)
          |               ^
      127 |       setError(
      128 |         error instanceof Error ? error.message : "ÁµêÊûú„ÅÆÂèñÂæó„Å´Â§±Êïó„Åó„Åæ„Åó„Åü"
      129 |       )

      at error (src/components/GameResult.tsx:126:15)

    console.log
      GameResult API Response: {
        status: undefined,
        data: { success: false, error: { message: '„Éá„Éº„Çø„ÅÆÂèñÂæó„Å´Â§±Êïó' } }
      }

      at log (src/components/GameResult.tsx:109:15)

    console.error
      fetchGameResult error: Error: „Éá„Éº„Çø„ÅÆÂèñÂæó„Å´Â§±Êïó
          at /Users/nyanpass/source/repos/mahjong-point-manager/src/components/GameResult.tsx:123:15

      124 |       }
      125 |     } catch (error) {
    > 126 |       console.error("fetchGameResult error:", error)
          |               ^
      127 |       setError(
      128 |         error instanceof Error ? error.message : "ÁµêÊûú„ÅÆÂèñÂæó„Å´Â§±Êïó„Åó„Åæ„Åó„Åü"
      129 |       )

      at error (src/components/GameResult.tsx:126:15)

    console.error
      fetchGameResult error: Error: Invalid JSON
          at Object.json (/Users/nyanpass/source/repos/mahjong-point-manager/src/components/__tests__/GameResult.test.tsx:693:34)
          at json (/Users/nyanpass/source/repos/mahjong-point-manager/src/components/GameResult.tsx:108:35)

      124 |       }
      125 |     } catch (error) {
    > 126 |       console.error("fetchGameResult error:", error)
          |               ^
      127 |       setError(
      128 |         error instanceof Error ? error.message : "ÁµêÊûú„ÅÆÂèñÂæó„Å´Â§±Êïó„Åó„Åæ„Åó„Åü"
      129 |       )

      at error (src/components/GameResult.tsx:126:15)

    console.error
      Error: Not implemented: navigation (except hash changes)
          at Reflect.set (<anonymous>)
          at Object.<anonymous> (src/components/__tests__/GameResult.test.tsx:732:30)
          at new Promise (<anonymous>) {
        type: 'not implemented'
      }

      730 |     // location.href „ÅÆ„É¢„ÉÉ„ÇØ
      731 |     delete (window as any).location
    > 732 |     ;(window as any).location = { href: "" }
          |                              ^
      733 |   })
      734 |
      735 |   afterEach(() => {

      at VirtualConsole.<anonymous> (node_modules/@jest/environment-jsdom-abstract/build/index.js:78:23)
      at module.exports (node_modules/jsdom/lib/jsdom/browser/not-implemented.js:12:26)
      at navigateFetch (node_modules/jsdom/lib/jsdom/living/window/navigation.js:77:3)
      at exports.navigate (node_modules/jsdom/lib/jsdom/living/window/navigation.js:55:3)
      at LocationImpl._locationObjectNavigate (node_modules/jsdom/lib/jsdom/living/window/Location-impl.js:30:5)
      at LocationImpl._locationObjectSetterNavigate (node_modules/jsdom/lib/jsdom/living/window/Location-impl.js:24:17)
      at LocationImpl.set href [as href] (node_modules/jsdom/lib/jsdom/living/window/Location-impl.js:46:10)
      at Location.set href [as href] (node_modules/jsdom/lib/jsdom/living/generated/Location.js:125:37)
          at Reflect.set (<anonymous>)
      at Window.set location [as location] (node_modules/jsdom/lib/jsdom/browser/Window.js:424:15)
      at Object.<anonymous> (src/components/__tests__/GameResult.test.tsx:732:30)

    console.log
      GameResult API Response: {
        status: undefined,
        data: {
          success: true,
          data: {
            gameId: 'test-game-id',
            roomCode: 'TEST123',
            results: [Array],
            gameType: 'TONPUU',
            endReason: 'Êù±4Â±ÄÁµÇ‰∫Ü',
            endedAt: '2023-01-01T12:00:00Z',
            basePoints: 30000,
            sessionId: 'test-session-id',
            sessionCode: 'SES123',
            sessionName: '„ÉÜ„Çπ„Éà„Çª„ÉÉ„Ç∑„Éß„É≥',
            hostPlayerId: 'player1',
            nextGame: [Object]
          }
        }
      }

      at log (src/components/GameResult.tsx:109:15)

    console.log
      Setting result data: {
        gameId: 'test-game-id',
        roomCode: 'TEST123',
        results: [
          {
            playerId: 'player1',
            name: '„ÉÜ„Çπ„Éà„Éó„É¨„Ç§„É§„Éº1',
            finalPoints: 35000,
            rank: 1,
            uma: 3000,
            settlement: 8000
          },
          {
            playerId: 'player2',
            name: '„ÉÜ„Çπ„Éà„Éó„É¨„Ç§„É§„Éº2',
            finalPoints: 28000,
            rank: 2,
            uma: 1000,
            settlement: -2000
          },
          {
            playerId: 'player3',
            name: '„ÉÜ„Çπ„Éà„Éó„É¨„Ç§„É§„Éº3',
            finalPoints: 22000,
            rank: 3,
            uma: -1000,
            settlement: -3000
          },
          {
            playerId: 'player4',
            name: '„ÉÜ„Çπ„Éà„Éó„É¨„Ç§„É§„Éº4',
            finalPoints: 15000,
            rank: 4,
            uma: -3000,
            settlement: -3000
          }
        ],
        gameType: 'TONPUU',
        endReason: 'Êù±4Â±ÄÁµÇ‰∫Ü',
        endedAt: '2023-01-01T12:00:00Z',
        basePoints: 30000,
        sessionId: 'test-session-id',
        sessionCode: 'SES123',
        sessionName: '„ÉÜ„Çπ„Éà„Çª„ÉÉ„Ç∑„Éß„É≥',
        hostPlayerId: 'player1',
        nextGame: { id: 'next-game-id', roomCode: 'NEXT123' }
      }

      at log (src/components/GameResult.tsx:116:17)

    console.error
      Error: Not implemented: navigation (except hash changes)
          at Object.action (src/components/GameResult.tsx:88:29)
          at action (src/components/GameResult.tsx:1085:28)
          at onConfirm (src/components/AlertModal.tsx:39:7)
          at Object.<anonymous> (src/components/__tests__/GameResult.test.tsx:750:8) {
        type: 'not implemented'
      }

      86 |       countdown: 5,
      87 |       action: () => {
    > 88 |         window.location.href = `/room/${code}`
         |                             ^
      89 |       },
      90 |     })
      91 |   }, [])

      at VirtualConsole.<anonymous> (node_modules/@jest/environment-jsdom-abstract/build/index.js:78:23)
      at module.exports (node_modules/jsdom/lib/jsdom/browser/not-implemented.js:12:26)
      at navigateFetch (node_modules/jsdom/lib/jsdom/living/window/navigation.js:77:3)
      at exports.navigate (node_modules/jsdom/lib/jsdom/living/window/navigation.js:55:3)
      at LocationImpl._locationObjectNavigate (node_modules/jsdom/lib/jsdom/living/window/Location-impl.js:30:5)
      at LocationImpl._locationObjectSetterNavigate (node_modules/jsdom/lib/jsdom/living/window/Location-impl.js:24:17)
      at LocationImpl.set href [as href] (node_modules/jsdom/lib/jsdom/living/window/Location-impl.js:46:10)
      at Location.set href [as href] (node_modules/jsdom/lib/jsdom/living/generated/Location.js:125:37)
      at Object.action (src/components/GameResult.tsx:88:29)
      at action (src/components/GameResult.tsx:1085:28)
      at onConfirm (src/components/AlertModal.tsx:39:7)
      at commitHookEffectListMount (node_modules/react-dom/cjs/react-dom.development.js:23189:26)
      at commitPassiveMountOnFiber (node_modules/react-dom/cjs/react-dom.development.js:24970:11)
      at commitPassiveMountEffects_complete (node_modules/react-dom/cjs/react-dom.development.js:24930:9)
      at commitPassiveMountEffects_begin (node_modules/react-dom/cjs/react-dom.development.js:24917:7)
      at commitPassiveMountEffects (node_modules/react-dom/cjs/react-dom.development.js:24905:3)
      at flushPassiveEffectsImpl (node_modules/react-dom/cjs/react-dom.development.js:27078:3)
      at flushPassiveEffects (node_modules/react-dom/cjs/react-dom.development.js:27023:14)
      at node_modules/react-dom/cjs/react-dom.development.js:26808:9
      at flushActQueue (node_modules/react/cjs/react.development.js:2667:24)
      at act (node_modules/react/cjs/react.development.js:2582:11)
      at node_modules/@testing-library/react/dist/act-compat.js:47:25
      at Object.<anonymous> (src/components/__tests__/GameResult.test.tsx:750:8)

    console.error
      Error: Not implemented: navigation (except hash changes)
          at Reflect.set (<anonymous>)
          at Object.<anonymous> (src/components/__tests__/GameResult.test.tsx:732:30)
          at new Promise (<anonymous>) {
        type: 'not implemented'
      }

      730 |     // location.href „ÅÆ„É¢„ÉÉ„ÇØ
      731 |     delete (window as any).location
    > 732 |     ;(window as any).location = { href: "" }
          |                              ^
      733 |   })
      734 |
      735 |   afterEach(() => {

      at VirtualConsole.<anonymous> (node_modules/@jest/environment-jsdom-abstract/build/index.js:78:23)
      at module.exports (node_modules/jsdom/lib/jsdom/browser/not-implemented.js:12:26)
      at navigateFetch (node_modules/jsdom/lib/jsdom/living/window/navigation.js:77:3)
      at exports.navigate (node_modules/jsdom/lib/jsdom/living/window/navigation.js:55:3)
      at LocationImpl._locationObjectNavigate (node_modules/jsdom/lib/jsdom/living/window/Location-impl.js:30:5)
      at LocationImpl._locationObjectSetterNavigate (node_modules/jsdom/lib/jsdom/living/window/Location-impl.js:24:17)
      at LocationImpl.set href [as href] (node_modules/jsdom/lib/jsdom/living/window/Location-impl.js:46:10)
      at Location.set href [as href] (node_modules/jsdom/lib/jsdom/living/generated/Location.js:125:37)
          at Reflect.set (<anonymous>)
      at Window.set location [as location] (node_modules/jsdom/lib/jsdom/browser/Window.js:424:15)
      at Object.<anonymous> (src/components/__tests__/GameResult.test.tsx:732:30)

    console.log
      GameResult API Response: {
        status: undefined,
        data: {
          success: true,
          data: {
            gameId: 'test-game-id',
            roomCode: 'TEST123',
            results: [Array],
            gameType: 'TONPUU',
            endReason: 'Êù±4Â±ÄÁµÇ‰∫Ü',
            endedAt: '2023-01-01T12:00:00Z',
            basePoints: 30000,
            sessionId: 'test-session-id',
            sessionCode: 'SES123',
            sessionName: '„ÉÜ„Çπ„Éà„Çª„ÉÉ„Ç∑„Éß„É≥',
            hostPlayerId: 'player1',
            nextGame: [Object]
          }
        }
      }

      at log (src/components/GameResult.tsx:109:15)

    console.log
      Setting result data: {
        gameId: 'test-game-id',
        roomCode: 'TEST123',
        results: [
          {
            playerId: 'player1',
            name: '„ÉÜ„Çπ„Éà„Éó„É¨„Ç§„É§„Éº1',
            finalPoints: 35000,
            rank: 1,
            uma: 3000,
            settlement: 8000
          },
          {
            playerId: 'player2',
            name: '„ÉÜ„Çπ„Éà„Éó„É¨„Ç§„É§„Éº2',
            finalPoints: 28000,
            rank: 2,
            uma: 1000,
            settlement: -2000
          },
          {
            playerId: 'player3',
            name: '„ÉÜ„Çπ„Éà„Éó„É¨„Ç§„É§„Éº3',
            finalPoints: 22000,
            rank: 3,
            uma: -1000,
            settlement: -3000
          },
          {
            playerId: 'player4',
            name: '„ÉÜ„Çπ„Éà„Éó„É¨„Ç§„É§„Éº4',
            finalPoints: 15000,
            rank: 4,
            uma: -3000,
            settlement: -3000
          }
        ],
        gameType: 'TONPUU',
        endReason: 'Êù±4Â±ÄÁµÇ‰∫Ü',
        endedAt: '2023-01-01T12:00:00Z',
        basePoints: 30000,
        sessionId: 'test-session-id',
        sessionCode: 'SES123',
        sessionName: '„ÉÜ„Çπ„Éà„Çª„ÉÉ„Ç∑„Éß„É≥',
        hostPlayerId: 'player1',
        nextGame: { id: 'next-game-id', roomCode: 'NEXT123' }
      }

      at log (src/components/GameResult.tsx:116:17)

    console.error
      Error: Not implemented: navigation (except hash changes)
          at Object.action (src/components/GameResult.tsx:88:29)
          at action (src/components/GameResult.tsx:1085:28)
          at onConfirm (src/components/AlertModal.tsx:39:7)
          at Object.<anonymous> (src/components/__tests__/GameResult.test.tsx:779:8) {
        type: 'not implemented'
      }

      86 |       countdown: 5,
      87 |       action: () => {
    > 88 |         window.location.href = `/room/${code}`
         |                             ^
      89 |       },
      90 |     })
      91 |   }, [])

      at VirtualConsole.<anonymous> (node_modules/@jest/environment-jsdom-abstract/build/index.js:78:23)
      at module.exports (node_modules/jsdom/lib/jsdom/browser/not-implemented.js:12:26)
      at navigateFetch (node_modules/jsdom/lib/jsdom/living/window/navigation.js:77:3)
      at exports.navigate (node_modules/jsdom/lib/jsdom/living/window/navigation.js:55:3)
      at LocationImpl._locationObjectNavigate (node_modules/jsdom/lib/jsdom/living/window/Location-impl.js:30:5)
      at LocationImpl._locationObjectSetterNavigate (node_modules/jsdom/lib/jsdom/living/window/Location-impl.js:24:17)
      at LocationImpl.set href [as href] (node_modules/jsdom/lib/jsdom/living/window/Location-impl.js:46:10)
      at Location.set href [as href] (node_modules/jsdom/lib/jsdom/living/generated/Location.js:125:37)
      at Object.action (src/components/GameResult.tsx:88:29)
      at action (src/components/GameResult.tsx:1085:28)
      at onConfirm (src/components/AlertModal.tsx:39:7)
      at commitHookEffectListMount (node_modules/react-dom/cjs/react-dom.development.js:23189:26)
      at commitPassiveMountOnFiber (node_modules/react-dom/cjs/react-dom.development.js:24970:11)
      at commitPassiveMountEffects_complete (node_modules/react-dom/cjs/react-dom.development.js:24930:9)
      at commitPassiveMountEffects_begin (node_modules/react-dom/cjs/react-dom.development.js:24917:7)
      at commitPassiveMountEffects (node_modules/react-dom/cjs/react-dom.development.js:24905:3)
      at flushPassiveEffectsImpl (node_modules/react-dom/cjs/react-dom.development.js:27078:3)
      at flushPassiveEffects (node_modules/react-dom/cjs/react-dom.development.js:27023:14)
      at node_modules/react-dom/cjs/react-dom.development.js:26808:9
      at flushActQueue (node_modules/react/cjs/react.development.js:2667:24)
      at act (node_modules/react/cjs/react.development.js:2582:11)
      at node_modules/@testing-library/react/dist/act-compat.js:47:25
      at Object.<anonymous> (src/components/__tests__/GameResult.test.tsx:779:8)

    console.log
      GameResult API Response: { status: undefined, data: { success: false, data: null } }

      at log (src/components/GameResult.tsx:109:15)

    console.error
      fetchGameResult error: Error: ÁµêÊûú„ÅÆÂèñÂæó„Å´Â§±Êïó„Åó„Åæ„Åó„Åü
          at /Users/nyanpass/source/repos/mahjong-point-manager/src/components/GameResult.tsx:123:15

      124 |       }
      125 |     } catch (error) {
    > 126 |       console.error("fetchGameResult error:", error)
          |               ^
      127 |       setError(
      128 |         error instanceof Error ? error.message : "ÁµêÊûú„ÅÆÂèñÂæó„Å´Â§±Êïó„Åó„Åæ„Åó„Åü"
      129 |       )

      at error (src/components/GameResult.tsx:126:15)

    console.log
      GameResult API Response: {
        status: undefined,
        data: {
          success: true,
          data: {
            gameId: 'test-game-id',
            roomCode: 'TEST123',
            results: [Array],
            gameType: 'TONPUU',
            endReason: 'Êù±4Â±ÄÁµÇ‰∫Ü',
            endedAt: '2023-01-01T12:00:00Z',
            basePoints: 30000,
            sessionId: 'test-session-id',
            sessionCode: 'SES123',
            sessionName: '„ÉÜ„Çπ„Éà„Çª„ÉÉ„Ç∑„Éß„É≥',
            hostPlayerId: 'player1'
          }
        }
      }

      at log (src/components/GameResult.tsx:109:15)

    console.log
      Setting result data: {
        gameId: 'test-game-id',
        roomCode: 'TEST123',
        results: [
          {
            playerId: 'player1',
            name: '„ÉÜ„Çπ„Éà„Éó„É¨„Ç§„É§„Éº1',
            finalPoints: 35000,
            rank: 1,
            uma: 3000,
            settlement: 8000
          },
          {
            playerId: 'player2',
            name: '„ÉÜ„Çπ„Éà„Éó„É¨„Ç§„É§„Éº2',
            finalPoints: 28000,
            rank: 2,
            uma: 1000,
            settlement: -2000
          },
          {
            playerId: 'player3',
            name: '„ÉÜ„Çπ„Éà„Éó„É¨„Ç§„É§„Éº3',
            finalPoints: 22000,
            rank: 3,
            uma: -1000,
            settlement: -3000
          },
          {
            playerId: 'player4',
            name: '„ÉÜ„Çπ„Éà„Éó„É¨„Ç§„É§„Éº4',
            finalPoints: 15000,
            rank: 4,
            uma: -3000,
            settlement: -3000
          }
        ],
        gameType: 'TONPUU',
        endReason: 'Êù±4Â±ÄÁµÇ‰∫Ü',
        endedAt: '2023-01-01T12:00:00Z',
        basePoints: 30000,
        sessionId: 'test-session-id',
        sessionCode: 'SES123',
        sessionName: '„ÉÜ„Çπ„Éà„Çª„ÉÉ„Ç∑„Éß„É≥',
        hostPlayerId: 'player1'
      }

      at log (src/components/GameResult.tsx:116:17)

    console.log
      GameResult API Response: {
        status: undefined,
        data: {
          success: true,
          data: {
            gameId: 'test-game-id',
            roomCode: 'TEST123',
            results: [Array],
            gameType: 'TONPUU',
            endReason: 'Êù±4Â±ÄÁµÇ‰∫Ü',
            endedAt: '2023-01-01T12:00:00Z',
            basePoints: 30000,
            sessionId: 'test-session-id',
            sessionCode: 'SES123',
            sessionName: '„ÉÜ„Çπ„Éà„Çª„ÉÉ„Ç∑„Éß„É≥',
            hostPlayerId: 'player1'
          }
        }
      }

      at log (src/components/GameResult.tsx:109:15)

    console.log
      Setting result data: {
        gameId: 'test-game-id',
        roomCode: 'TEST123',
        results: [
          {
            playerId: 'player1',
            name: '„ÉÜ„Çπ„Éà„Éó„É¨„Ç§„É§„Éº1',
            finalPoints: 35000,
            rank: 1,
            uma: 3000,
            settlement: 8000
          },
          {
            playerId: 'player2',
            name: '„ÉÜ„Çπ„Éà„Éó„É¨„Ç§„É§„Éº2',
            finalPoints: 28000,
            rank: 2,
            uma: 1000,
            settlement: -2000
          },
          {
            playerId: 'player3',
            name: '„ÉÜ„Çπ„Éà„Éó„É¨„Ç§„É§„Éº3',
            finalPoints: 22000,
            rank: 3,
            uma: -1000,
            settlement: -3000
          },
          {
            playerId: 'player4',
            name: '„ÉÜ„Çπ„Éà„Éó„É¨„Ç§„É§„Éº4',
            finalPoints: 15000,
            rank: 4,
            uma: -3000,
            settlement: -3000
          }
        ],
        gameType: 'TONPUU',
        endReason: 'Êù±4Â±ÄÁµÇ‰∫Ü',
        endedAt: '2023-01-01T12:00:00Z',
        basePoints: 30000,
        sessionId: 'test-session-id',
        sessionCode: 'SES123',
        sessionName: '„ÉÜ„Çπ„Éà„Çª„ÉÉ„Ç∑„Éß„É≥',
        hostPlayerId: 'player1'
      }

      at log (src/components/GameResult.tsx:116:17)

    console.log
      WebSocket connected, joining room for game result

      at log (src/components/GameResult.tsx:152:15)

    console.log
      User: { playerId: 'player1', name: '„ÉÜ„Çπ„Éà„Éó„É¨„Ç§„É§„Éº1' }

      at log (src/components/GameResult.tsx:153:15)

    console.log
      ResultData: {
        gameId: 'test-game-id',
        roomCode: 'TEST123',
        results: [
          {
            playerId: 'player1',
            name: '„ÉÜ„Çπ„Éà„Éó„É¨„Ç§„É§„Éº1',
            finalPoints: 35000,
            rank: 1,
            uma: 3000,
            settlement: 8000
          },
          {
            playerId: 'player2',
            name: '„ÉÜ„Çπ„Éà„Éó„É¨„Ç§„É§„Éº2',
            finalPoints: 28000,
            rank: 2,
            uma: 1000,
            settlement: -2000
          },
          {
            playerId: 'player3',
            name: '„ÉÜ„Çπ„Éà„Éó„É¨„Ç§„É§„Éº3',
            finalPoints: 22000,
            rank: 3,
            uma: -1000,
            settlement: -3000
          },
          {
            playerId: 'player4',
            name: '„ÉÜ„Çπ„Éà„Éó„É¨„Ç§„É§„Éº4',
            finalPoints: 15000,
            rank: 4,
            uma: -3000,
            settlement: -3000
          }
        ],
        gameType: 'TONPUU',
        endReason: 'Êù±4Â±ÄÁµÇ‰∫Ü',
        endedAt: '2023-01-01T12:00:00Z',
        basePoints: 30000,
        sessionId: 'test-session-id',
        sessionCode: 'SES123',
        sessionName: '„ÉÜ„Çπ„Éà„Çª„ÉÉ„Ç∑„Éß„É≥',
        hostPlayerId: 'player1'
      }

      at log (src/components/GameResult.tsx:154:15)

    console.log
      üîå Attempting to join room: TEST123 with playerId: player1

      at log (src/components/GameResult.tsx:156:17)

    console.log
      üîå join_room event emitted for room TEST123

      at log (src/components/GameResult.tsx:163:17)

PASS src/app/api/room/[roomCode]/seat-order/__tests__/route.test.ts
  ‚óè Console

    console.error
      Seat order update failed: Error: DB Error
          at Object.<anonymous> (/Users/nyanpass/source/repos/mahjong-point-manager/src/app/api/room/[roomCode]/seat-order/__tests__/route.test.ts:456:51)
          at Promise.finally.completed (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/jestAdapterInit.js:1559:28)
          at new Promise (<anonymous>)
          at callAsyncCircusFn (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/jestAdapterInit.js:1499:10)
          at _callCircusTest (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/jestAdapterInit.js:1009:40)
          at processTicksAndRejections (node:internal/process/task_queues:105:5)
          at _runTest (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/jestAdapterInit.js:949:3)
          at _runTestsForDescribeBlock (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/jestAdapterInit.js:839:13)
          at _runTestsForDescribeBlock (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/jestAdapterInit.js:829:11)
          at _runTestsForDescribeBlock (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/jestAdapterInit.js:829:11)
          at run (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/jestAdapterInit.js:757:3)
          at runAndTransformResultsToJestFormat (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/jestAdapterInit.js:1920:21)
          at jestAdapter (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/runner.js:101:19)
          at runTestInternal (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-runner/build/testWorker.js:272:16)
          at runTest (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-runner/build/testWorker.js:340:7)
          at Object.worker (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-runner/build/testWorker.js:494:12)

      122 |       )
      123 |     }
    > 124 |     console.error("Seat order update failed:", error)
          |             ^
      125 |     return NextResponse.json(
      126 |       {
      127 |         success: false,

      at error (src/app/api/room/[roomCode]/seat-order/route.ts:124:13)
      at Object.<anonymous> (src/app/api/room/[roomCode]/seat-order/__tests__/route.test.ts:470:24)

    console.error
      Seat order update failed: Error: Transaction failed
          at Object.<anonymous> (/Users/nyanpass/source/repos/mahjong-point-manager/src/app/api/room/[roomCode]/seat-order/__tests__/route.test.ts:489:49)
          at Promise.finally.completed (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/jestAdapterInit.js:1559:28)
          at new Promise (<anonymous>)
          at callAsyncCircusFn (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/jestAdapterInit.js:1499:10)
          at _callCircusTest (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/jestAdapterInit.js:1009:40)
          at processTicksAndRejections (node:internal/process/task_queues:105:5)
          at _runTest (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/jestAdapterInit.js:949:3)
          at _runTestsForDescribeBlock (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/jestAdapterInit.js:839:13)
          at _runTestsForDescribeBlock (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/jestAdapterInit.js:829:11)
          at _runTestsForDescribeBlock (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/jestAdapterInit.js:829:11)
          at run (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/jestAdapterInit.js:757:3)
          at runAndTransformResultsToJestFormat (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/jestAdapterInit.js:1920:21)
          at jestAdapter (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/runner.js:101:19)
          at runTestInternal (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-runner/build/testWorker.js:272:16)
          at runTest (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-runner/build/testWorker.js:340:7)
          at Object.worker (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-runner/build/testWorker.js:494:12)

      122 |       )
      123 |     }
    > 124 |     console.error("Seat order update failed:", error)
          |             ^
      125 |     return NextResponse.json(
      126 |       {
      127 |         success: false,

      at error (src/app/api/room/[roomCode]/seat-order/route.ts:124:13)
      at Object.<anonymous> (src/app/api/room/[roomCode]/seat-order/__tests__/route.test.ts:506:24)

PASS src/__tests__/api/sessions-privacy.test.ts
PASS src/app/api/room/[roomCode]/__tests__/route.test.ts
  ‚óè Console

    console.error
      Room info retrieval failed: Error: Database connection failed
          at Object.<anonymous> (/Users/nyanpass/source/repos/mahjong-point-manager/src/app/api/room/[roomCode]/__tests__/route.test.ts:218:23)
          at Promise.finally.completed (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/jestAdapterInit.js:1559:28)
          at new Promise (<anonymous>)
          at callAsyncCircusFn (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/jestAdapterInit.js:1499:10)
          at _callCircusTest (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/jestAdapterInit.js:1009:40)
          at processTicksAndRejections (node:internal/process/task_queues:105:5)
          at _runTest (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/jestAdapterInit.js:949:3)
          at _runTestsForDescribeBlock (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/jestAdapterInit.js:839:13)
          at _runTestsForDescribeBlock (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/jestAdapterInit.js:829:11)
          at _runTestsForDescribeBlock (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/jestAdapterInit.js:829:11)
          at run (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/jestAdapterInit.js:757:3)
          at runAndTransformResultsToJestFormat (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/jestAdapterInit.js:1920:21)
          at jestAdapter (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/runner.js:101:19)
          at runTestInternal (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-runner/build/testWorker.js:272:16)
          at runTest (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-runner/build/testWorker.js:340:7)
          at Object.worker (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-runner/build/testWorker.js:494:12)

      70 |     })
      71 |   } catch (error) {
    > 72 |     console.error("Room info retrieval failed:", error)
         |             ^
      73 |     return NextResponse.json(
      74 |       {
      75 |         success: false,

      at error (src/app/api/room/[roomCode]/route.ts:72:13)
      at Object.<anonymous> (src/app/api/room/[roomCode]/__tests__/route.test.ts:225:24)

    console.error
      Room info retrieval failed: Unknown error

      70 |     })
      71 |   } catch (error) {
    > 72 |     console.error("Room info retrieval failed:", error)
         |             ^
      73 |     return NextResponse.json(
      74 |       {
      75 |         success: false,

      at error (src/app/api/room/[roomCode]/route.ts:72:13)
      at Object.<anonymous> (src/app/api/room/[roomCode]/__tests__/route.test.ts:243:24)

PASS src/contexts/__tests__/AuthContext.test.tsx
  ‚óè Console

    console.log
      üîç Browser info: { cookieSupported: true, isSafari: false, isMobile: false }

      at log (src/contexts/AuthContext.tsx:50:15)

    console.log
      üîç Fallback session: null

      at log (src/contexts/AuthContext.tsx:54:15)

    console.log
      üîç Auth response: {}

      at log (src/contexts/AuthContext.tsx:63:17)

    console.log
      ‚úÖ Login successful: {
        success: true,
        data: { playerId: 'p1', name: 'A', deviceId: 'd1', sessionToken: 't' }
      }

      at Object.log [as login] (src/contexts/AuthContext.tsx:130:17)

    console.log
      ‚úÖ Logout successful

      at Object.log [as logout] (src/contexts/AuthContext.tsx:178:15)

    console.log
      üîç Browser info: { cookieSupported: true, isSafari: false, isMobile: false }

      at log (src/contexts/AuthContext.tsx:50:15)

    console.log
      üîç Fallback session: null

      at log (src/contexts/AuthContext.tsx:54:15)

    console.log
      üîç Browser info: { cookieSupported: true, isSafari: false, isMobile: false }

      at log (src/contexts/AuthContext.tsx:50:15)

    console.log
      üîç Fallback session: null

      at log (src/contexts/AuthContext.tsx:54:15)

    console.error
      Session check failed: Error: bad
          at Object.<anonymous> (/Users/nyanpass/source/repos/mahjong-point-manager/src/contexts/__tests__/AuthContext.test.tsx:67:59)
          at Promise.finally.completed (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/jestAdapterInit.js:1559:28)
          at new Promise (<anonymous>)
          at callAsyncCircusFn (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/jestAdapterInit.js:1499:10)
          at _callCircusTest (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/jestAdapterInit.js:1009:40)
          at _runTest (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/jestAdapterInit.js:949:3)
          at _runTestsForDescribeBlock (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/jestAdapterInit.js:839:13)
          at _runTestsForDescribeBlock (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/jestAdapterInit.js:829:11)
          at run (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/jestAdapterInit.js:757:3)
          at runAndTransformResultsToJestFormat (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/jestAdapterInit.js:1920:21)
          at jestAdapter (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/runner.js:101:19)
          at runTestInternal (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-runner/build/testWorker.js:272:16)
          at runTest (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-runner/build/testWorker.js:340:7)
          at Object.worker (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-runner/build/testWorker.js:494:12)

      85 |       }
      86 |     } catch (error) {
    > 87 |       console.error("Session check failed:", error)
         |               ^
      88 |       AuthFallback.clearSession()
      89 |     } finally {
      90 |       setIsLoading(false)

      at error (src/contexts/AuthContext.tsx:87:15)

    console.log
      üîç Auth response: {}

      at log (src/contexts/AuthContext.tsx:63:17)

PASS src/app/api/solo/[gameId]/ryukyoku/__tests__/route.test.ts
PASS src/components/common/__tests__/BaseScoreInputForm.test.tsx
  ‚óè Console

    console.error
      Score submission failed: Error: ÈÄÅ‰ø°„Ç®„É©„Éº
          at Object.<anonymous> (/Users/nyanpass/source/repos/mahjong-point-manager/src/components/common/__tests__/BaseScoreInputForm.test.tsx:470:38)
          at Promise.finally.completed (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/jestAdapterInit.js:1559:28)
          at new Promise (<anonymous>)
          at callAsyncCircusFn (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/jestAdapterInit.js:1499:10)
          at _callCircusTest (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/jestAdapterInit.js:1009:40)
          at _runTest (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/jestAdapterInit.js:949:3)
          at _runTestsForDescribeBlock (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/jestAdapterInit.js:839:13)
          at _runTestsForDescribeBlock (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/jestAdapterInit.js:829:11)
          at _runTestsForDescribeBlock (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/jestAdapterInit.js:829:11)
          at run (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/jestAdapterInit.js:757:3)
          at runAndTransformResultsToJestFormat (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/jestAdapterInit.js:1920:21)
          at jestAdapter (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/runner.js:101:19)
          at runTestInternal (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-runner/build/testWorker.js:272:16)
          at runTest (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-runner/build/testWorker.js:340:7)
          at Object.worker (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-runner/build/testWorker.js:494:12)

      224 |       await onSubmit(scoreData)
      225 |     } catch (error) {
    > 226 |       console.error("Score submission failed:", error)
          |               ^
      227 |       setValidationErrors({
      228 |         submit:
      229 |           error instanceof Error ? error.message : "ÁÇπÊï∞Ë®àÁÆó„Å´Â§±Êïó„Åó„Åæ„Åó„Åü",

      at error (src/components/common/BaseScoreInputForm.tsx:226:15)

    console.error
      Score submission failed: Error: ÈÄÅ‰ø°„Ç®„É©„Éº
          at Object.<anonymous> (/Users/nyanpass/source/repos/mahjong-point-manager/src/components/common/__tests__/BaseScoreInputForm.test.tsx:470:38)
          at Promise.finally.completed (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/jestAdapterInit.js:1559:28)
          at new Promise (<anonymous>)
          at callAsyncCircusFn (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/jestAdapterInit.js:1499:10)
          at _callCircusTest (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/jestAdapterInit.js:1009:40)
          at _runTest (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/jestAdapterInit.js:949:3)
          at _runTestsForDescribeBlock (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/jestAdapterInit.js:839:13)
          at _runTestsForDescribeBlock (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/jestAdapterInit.js:829:11)
          at _runTestsForDescribeBlock (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/jestAdapterInit.js:829:11)
          at run (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/jestAdapterInit.js:757:3)
          at runAndTransformResultsToJestFormat (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/jestAdapterInit.js:1920:21)
          at jestAdapter (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/runner.js:101:19)
          at runTestInternal (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-runner/build/testWorker.js:272:16)
          at runTest (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-runner/build/testWorker.js:340:7)
          at Object.worker (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-runner/build/testWorker.js:494:12)

      224 |       await onSubmit(scoreData)
      225 |     } catch (error) {
    > 226 |       console.error("Score submission failed:", error)
          |               ^
      227 |       setValidationErrors({
      228 |         submit:
      229 |           error instanceof Error ? error.message : "ÁÇπÊï∞Ë®àÁÆó„Å´Â§±Êïó„Åó„Åæ„Åó„Åü",

      at error (src/components/common/BaseScoreInputForm.tsx:226:15)

    console.error
      Score submission failed: ‰∏çÊòé„Å™„Ç®„É©„Éº

      224 |       await onSubmit(scoreData)
      225 |     } catch (error) {
    > 226 |       console.error("Score submission failed:", error)
          |               ^
      227 |       setValidationErrors({
      228 |         submit:
      229 |           error instanceof Error ? error.message : "ÁÇπÊï∞Ë®àÁÆó„Å´Â§±Êïó„Åó„Åæ„Åó„Åü",

      at error (src/components/common/BaseScoreInputForm.tsx:226:15)

    console.error
      Score submission failed: ‰∏çÊòé„Å™„Ç®„É©„Éº

      224 |       await onSubmit(scoreData)
      225 |     } catch (error) {
    > 226 |       console.error("Score submission failed:", error)
          |               ^
      227 |       setValidationErrors({
      228 |         submit:
      229 |           error instanceof Error ? error.message : "ÁÇπÊï∞Ë®àÁÆó„Å´Â§±Êïó„Åó„Åæ„Åó„Åü",

      at error (src/components/common/BaseScoreInputForm.tsx:226:15)

    console.error
      Score submission failed: ‰∏çÊòé„Å™„Ç®„É©„Éº

      224 |       await onSubmit(scoreData)
      225 |     } catch (error) {
    > 226 |       console.error("Score submission failed:", error)
          |               ^
      227 |       setValidationErrors({
      228 |         submit:
      229 |           error instanceof Error ? error.message : "ÁÇπÊï∞Ë®àÁÆó„Å´Â§±Êïó„Åó„Åæ„Åó„Åü",

      at error (src/components/common/BaseScoreInputForm.tsx:226:15)

    console.error
      Score submission failed: ‰∏çÊòé„Å™„Ç®„É©„Éº

      224 |       await onSubmit(scoreData)
      225 |     } catch (error) {
    > 226 |       console.error("Score submission failed:", error)
          |               ^
      227 |       setValidationErrors({
      228 |         submit:
      229 |           error instanceof Error ? error.message : "ÁÇπÊï∞Ë®àÁÆó„Å´Â§±Êïó„Åó„Åæ„Åó„Åü",

      at error (src/components/common/BaseScoreInputForm.tsx:226:15)

    console.error
      Score submission failed: ‰∏çÊòé„Å™„Ç®„É©„Éº

      224 |       await onSubmit(scoreData)
      225 |     } catch (error) {
    > 226 |       console.error("Score submission failed:", error)
          |               ^
      227 |       setValidationErrors({
      228 |         submit:
      229 |           error instanceof Error ? error.message : "ÁÇπÊï∞Ë®àÁÆó„Å´Â§±Êïó„Åó„Åæ„Åó„Åü",

      at error (src/components/common/BaseScoreInputForm.tsx:226:15)

    console.error
      Preview fetch failed Error: API Error
          at Object.<anonymous> (/Users/nyanpass/source/repos/mahjong-point-manager/src/components/common/__tests__/BaseScoreInputForm.test.tsx:573:54)
          at Promise.finally.completed (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/jestAdapterInit.js:1559:28)
          at new Promise (<anonymous>)
          at callAsyncCircusFn (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/jestAdapterInit.js:1499:10)
          at _callCircusTest (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/jestAdapterInit.js:1009:40)
          at _runTest (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/jestAdapterInit.js:949:3)
          at _runTestsForDescribeBlock (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/jestAdapterInit.js:839:13)
          at _runTestsForDescribeBlock (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/jestAdapterInit.js:829:11)
          at _runTestsForDescribeBlock (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/jestAdapterInit.js:829:11)
          at run (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/jestAdapterInit.js:757:3)
          at runAndTransformResultsToJestFormat (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/jestAdapterInit.js:1920:21)
          at jestAdapter (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/runner.js:101:19)
          at runTestInternal (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-runner/build/testWorker.js:272:16)
          at runTest (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-runner/build/testWorker.js:340:7)
          at Object.worker (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-runner/build/testWorker.js:494:12)

      91 |       setScorePreview(result)
      92 |     } catch (e) {
    > 93 |       console.error("Preview fetch failed", e)
         |               ^
      94 |       setScorePreview(null)
      95 |     }
      96 |   }, [

      at error (src/components/common/BaseScoreInputForm.tsx:93:15)

PASS src/app/__tests__/layout.test.tsx
  ‚óè Console

    console.error
      Warning: validateDOMNesting(...): <html> cannot appear as a child of <div>.
          at html
          at children (/Users/nyanpass/source/repos/mahjong-point-manager/src/app/layout.tsx:12:3)

      35 |     const testChildren = <div data-testid="test-content">Test Content</div>
      36 |
    > 37 |     render(<RootLayout>{testChildren}</RootLayout>)
         |           ^
      38 |
      39 |     // Â≠êË¶ÅÁ¥†„ÅåË°®Á§∫„Åï„Çå„Çã„Åì„Å®„ÇíÁ¢∫Ë™ç
      40 |     expect(screen.getByTestId("test-content")).toBeInTheDocument()

      at printWarning (node_modules/react-dom/cjs/react-dom.development.js:86:30)
      at error (node_modules/react-dom/cjs/react-dom.development.js:60:7)
      at validateDOMNesting (node_modules/react-dom/cjs/react-dom.development.js:10847:7)
      at createInstance (node_modules/react-dom/cjs/react-dom.development.js:10930:5)
      at completeWork (node_modules/react-dom/cjs/react-dom.development.js:22226:28)
      at completeUnitOfWork (node_modules/react-dom/cjs/react-dom.development.js:26632:16)
      at performUnitOfWork (node_modules/react-dom/cjs/react-dom.development.js:26607:5)
      at workLoopSync (node_modules/react-dom/cjs/react-dom.development.js:26505:5)
      at renderRootSync (node_modules/react-dom/cjs/react-dom.development.js:26473:7)
      at performConcurrentWorkOnRoot (node_modules/react-dom/cjs/react-dom.development.js:25777:74)
      at flushActQueue (node_modules/react/cjs/react.development.js:2667:24)
      at act (node_modules/react/cjs/react.development.js:2582:11)
      at node_modules/@testing-library/react/dist/act-compat.js:47:25
      at renderRoot (node_modules/@testing-library/react/dist/pure.js:190:26)
      at render (node_modules/@testing-library/react/dist/pure.js:292:10)
      at Object.<anonymous> (src/app/__tests__/layout.test.tsx:37:11)

PASS src/lib/__tests__/vote-globals.test.ts
PASS src/app/api/game/[gameId]/vote-session/__tests__/route.test.ts
  ‚óè Console

    console.log
      üó≥Ô∏è Vote API: Processing vote for game g1: { vote: 'continue' }

      at log (src/app/api/game/[gameId]/vote-session/route.ts:30:13)

    console.log
      üó≥Ô∏è Vote API: Processing vote for game g1: { vote: 'continue' }

      at log (src/app/api/game/[gameId]/vote-session/route.ts:30:13)

    console.log
      üó≥Ô∏è Vote API: Processing vote for game g1: { vote: 'continue' }

      at log (src/app/api/game/[gameId]/vote-session/route.ts:30:13)

    console.log
      üó≥Ô∏è Vote API: Processing vote for game g1: { vote: 'continue' }

      at log (src/app/api/game/[gameId]/vote-session/route.ts:30:13)

    console.log
      üó≥Ô∏è Vote recorded: TestPlayer voted continue

      at log (src/app/api/game/[gameId]/vote-session/route.ts:76:13)

    console.log
      üó≥Ô∏è Current votes for game g1: { p1: 'continue' }

      at log (src/app/api/game/[gameId]/vote-session/route.ts:77:13)

    console.log
      üó≥Ô∏è Vote analysis result: {
        action: 'wait',
        message: '',
        details: {
          continueVotes: 0,
          endVotes: 0,
          pauseVotes: 0,
          totalPlayers: 4,
          votedPlayers: 1
        }
      }

      at log (src/app/api/game/[gameId]/vote-session/route.ts:85:13)

    console.log
      üîå Vote API: Found WebSocket instance in process

      at log (src/app/api/game/[gameId]/vote-session/route.ts:90:15)

    console.log
      üîå Broadcasted vote update to room ROOM1

      at log (src/app/api/game/[gameId]/vote-session/route.ts:98:15)

    console.log
      üó≥Ô∏è Vote API: Processing vote for game g1: { vote: 'end' }

      at log (src/app/api/game/[gameId]/vote-session/route.ts:30:13)

    console.log
      üó≥Ô∏è Vote recorded: TestPlayer voted end

      at log (src/app/api/game/[gameId]/vote-session/route.ts:76:13)

    console.log
      üó≥Ô∏è Current votes for game g1: { p1: 'end' }

      at log (src/app/api/game/[gameId]/vote-session/route.ts:77:13)

    console.log
      üó≥Ô∏è Vote analysis result: {
        action: 'wait',
        message: '',
        details: {
          continueVotes: 0,
          endVotes: 0,
          pauseVotes: 0,
          totalPlayers: 4,
          votedPlayers: 1
        }
      }

      at log (src/app/api/game/[gameId]/vote-session/route.ts:85:13)

    console.log
      üîå Vote API: Found WebSocket instance in process

      at log (src/app/api/game/[gameId]/vote-session/route.ts:90:15)

    console.log
      üîå Broadcasted vote update to room ROOM1

      at log (src/app/api/game/[gameId]/vote-session/route.ts:98:15)

    console.log
      üó≥Ô∏è Vote API: Processing vote for game g1: { vote: 'pause' }

      at log (src/app/api/game/[gameId]/vote-session/route.ts:30:13)

    console.log
      üó≥Ô∏è Vote recorded: TestPlayer voted pause

      at log (src/app/api/game/[gameId]/vote-session/route.ts:76:13)

    console.log
      üó≥Ô∏è Current votes for game g1: { p1: 'pause' }

      at log (src/app/api/game/[gameId]/vote-session/route.ts:77:13)

    console.log
      üó≥Ô∏è Vote analysis result: {
        action: 'wait',
        message: '',
        details: {
          continueVotes: 0,
          endVotes: 0,
          pauseVotes: 0,
          totalPlayers: 4,
          votedPlayers: 1
        }
      }

      at log (src/app/api/game/[gameId]/vote-session/route.ts:85:13)

    console.log
      üîå Vote API: Found WebSocket instance in process

      at log (src/app/api/game/[gameId]/vote-session/route.ts:90:15)

    console.log
      üîå Broadcasted vote update to room ROOM1

      at log (src/app/api/game/[gameId]/vote-session/route.ts:98:15)

    console.log
      üó≥Ô∏è Vote API: Processing vote for game g1: { vote: 'end' }

      at log (src/app/api/game/[gameId]/vote-session/route.ts:30:13)

    console.log
      üó≥Ô∏è Vote recorded: TestPlayer voted end

      at log (src/app/api/game/[gameId]/vote-session/route.ts:76:13)

    console.log
      üó≥Ô∏è Current votes for game g1: { p1: 'end' }

      at log (src/app/api/game/[gameId]/vote-session/route.ts:77:13)

    console.log
      üó≥Ô∏è Vote analysis result: {
        action: 'end',
        message: 'All players voted to end',
        details: {
          continueVotes: 0,
          endVotes: 4,
          pauseVotes: 0,
          totalPlayers: 4,
          votedPlayers: 4
        }
      }

      at log (src/app/api/game/[gameId]/vote-session/route.ts:85:13)

    console.log
      üîå Vote API: Found WebSocket instance in process

      at log (src/app/api/game/[gameId]/vote-session/route.ts:90:15)

    console.log
      üîå Broadcasted vote update to room ROOM1

      at log (src/app/api/game/[gameId]/vote-session/route.ts:98:15)

    console.log
      üèÅ All players voted to end session, forcing end...

      at log (src/app/api/game/[gameId]/vote-session/route.ts:106:17)

    console.log
      üèÅ Session ended by consensus

      at log (src/app/api/game/[gameId]/vote-session/route.ts:116:19)

    console.log
      üó≥Ô∏è Vote API: Processing vote for game g1: { vote: 'end' }

      at log (src/app/api/game/[gameId]/vote-session/route.ts:30:13)

    console.log
      üó≥Ô∏è Vote recorded: TestPlayer voted end

      at log (src/app/api/game/[gameId]/vote-session/route.ts:76:13)

    console.log
      üó≥Ô∏è Current votes for game g1: { p1: 'end' }

      at log (src/app/api/game/[gameId]/vote-session/route.ts:77:13)

    console.log
      üó≥Ô∏è Vote analysis result: {
        action: 'end',
        message: 'All players voted to end',
        details: {
          continueVotes: 0,
          endVotes: 4,
          pauseVotes: 0,
          totalPlayers: 4,
          votedPlayers: 4
        }
      }

      at log (src/app/api/game/[gameId]/vote-session/route.ts:85:13)

    console.log
      üîå Vote API: Found WebSocket instance in process

      at log (src/app/api/game/[gameId]/vote-session/route.ts:90:15)

    console.log
      üîå Broadcasted vote update to room ROOM1

      at log (src/app/api/game/[gameId]/vote-session/route.ts:98:15)

    console.log
      üèÅ All players voted to end session, forcing end...

      at log (src/app/api/game/[gameId]/vote-session/route.ts:106:17)

    console.error
      Failed to end session: Error: End game failed
          at Object.<anonymous> (/Users/nyanpass/source/repos/mahjong-point-manager/src/app/api/game/[gameId]/vote-session/__tests__/route.test.ts:235:42)
          at Promise.finally.completed (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/jestAdapterInit.js:1559:28)
          at new Promise (<anonymous>)
          at callAsyncCircusFn (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/jestAdapterInit.js:1499:10)
          at _callCircusTest (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/jestAdapterInit.js:1009:40)
          at processTicksAndRejections (node:internal/process/task_queues:105:5)
          at _runTest (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/jestAdapterInit.js:949:3)
          at _runTestsForDescribeBlock (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/jestAdapterInit.js:839:13)
          at _runTestsForDescribeBlock (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/jestAdapterInit.js:829:11)
          at _runTestsForDescribeBlock (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/jestAdapterInit.js:829:11)
          at run (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/jestAdapterInit.js:757:3)
          at runAndTransformResultsToJestFormat (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/jestAdapterInit.js:1920:21)
          at jestAdapter (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/runner.js:101:19)
          at runTestInternal (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-runner/build/testWorker.js:272:16)
          at runTest (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-runner/build/testWorker.js:340:7)
          at Object.worker (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-runner/build/testWorker.js:494:12)

      124 |           }
      125 |         } catch (endError) {
    > 126 |           console.error("Failed to end session:", endError)
          |                   ^
      127 |           // „Ç®„É©„Éº„ÅåÁô∫Áîü„Åó„Å¶„ÇÇ„É¨„Çπ„Éù„É≥„Çπ„ÅØÊäïÁ•®ÊàêÂäü„Å®„Åó„Å¶Ëøî„Åô
      128 |         }
      129 |       } else if (

      at error (src/app/api/game/[gameId]/vote-session/route.ts:126:19)
      at Object.<anonymous> (src/app/api/game/[gameId]/vote-session/__tests__/route.test.ts:241:19)

    console.log
      üó≥Ô∏è Vote API: Processing vote for game g1: { vote: 'continue' }

      at log (src/app/api/game/[gameId]/vote-session/route.ts:30:13)

    console.log
      üó≥Ô∏è Vote recorded: TestPlayer voted continue

      at log (src/app/api/game/[gameId]/vote-session/route.ts:76:13)

    console.log
      üó≥Ô∏è Current votes for game g1: { p1: 'continue' }

      at log (src/app/api/game/[gameId]/vote-session/route.ts:77:13)

    console.log
      üó≥Ô∏è Vote analysis result: {
        action: 'continue',
        message: 'All players voted to continue',
        details: {
          continueVotes: 4,
          endVotes: 0,
          pauseVotes: 0,
          totalPlayers: 4,
          votedPlayers: 4
        }
      }

      at log (src/app/api/game/[gameId]/vote-session/route.ts:85:13)

    console.log
      üîå Vote API: Found WebSocket instance in process

      at log (src/app/api/game/[gameId]/vote-session/route.ts:90:15)

    console.log
      üîå Broadcasted vote update to room ROOM1

      at log (src/app/api/game/[gameId]/vote-session/route.ts:98:15)

    console.log
      üîÑ Continue process triggered by votes

      at log (src/app/api/game/[gameId]/vote-session/route.ts:134:17)

    console.log
      üîÑ === CALLING REMATCH SERVICE DIRECTLY ===

      at log (src/app/api/game/[gameId]/vote-session/route.ts:141:19)

    console.log
      üîÑ Environment: test

      at log (src/app/api/game/[gameId]/vote-session/route.ts:142:19)

    console.log
      üîÑ GameId: g1

      at log (src/app/api/game/[gameId]/vote-session/route.ts:143:19)

    console.log
      üîÑ Service call data: { continueSession: true }

      at log (src/app/api/game/[gameId]/vote-session/route.ts:144:19)

    console.log
      üîÑ === REMATCH SERVICE RESPONSE ===

      at log (src/app/api/game/[gameId]/vote-session/route.ts:150:19)

    console.log
      üîÑ Service duration: 0ms

      at log (src/app/api/game/[gameId]/vote-session/route.ts:151:19)

    console.log
      üîÑ Service result: {
        "success": true,
        "data": {
          "roomCode": "NEWROOM",
          "gameId": "newGame",
          "sessionId": "newSession"
        }
      }

      at log (src/app/api/game/[gameId]/vote-session/route.ts:152:19)

    console.log
      üîÑ Successfully created new room NEWROOM for continuation via direct service call

      at log (src/app/api/game/[gameId]/vote-session/route.ts:160:21)

    console.log
      üó≥Ô∏è Vote API: Processing vote for game g1: { vote: 'continue' }

      at log (src/app/api/game/[gameId]/vote-session/route.ts:30:13)

    console.log
      üó≥Ô∏è Vote recorded: TestPlayer voted continue

      at log (src/app/api/game/[gameId]/vote-session/route.ts:76:13)

    console.log
      üó≥Ô∏è Current votes for game g1: { p1: 'continue' }

      at log (src/app/api/game/[gameId]/vote-session/route.ts:77:13)

    console.log
      üó≥Ô∏è Vote analysis result: {
        action: 'continue',
        message: 'All players voted to continue',
        details: {
          continueVotes: 4,
          endVotes: 0,
          pauseVotes: 0,
          totalPlayers: 4,
          votedPlayers: 4
        }
      }

      at log (src/app/api/game/[gameId]/vote-session/route.ts:85:13)

    console.log
      üîå Vote API: Found WebSocket instance in process

      at log (src/app/api/game/[gameId]/vote-session/route.ts:90:15)

    console.log
      üîå Broadcasted vote update to room ROOM1

      at log (src/app/api/game/[gameId]/vote-session/route.ts:98:15)

    console.log
      üîÑ Continue process triggered by votes

      at log (src/app/api/game/[gameId]/vote-session/route.ts:134:17)

    console.log
      üîÑ === CALLING REMATCH SERVICE DIRECTLY ===

      at log (src/app/api/game/[gameId]/vote-session/route.ts:141:19)

    console.log
      üîÑ Environment: test

      at log (src/app/api/game/[gameId]/vote-session/route.ts:142:19)

    console.log
      üîÑ GameId: g1

      at log (src/app/api/game/[gameId]/vote-session/route.ts:143:19)

    console.log
      üîÑ Service call data: { continueSession: true }

      at log (src/app/api/game/[gameId]/vote-session/route.ts:144:19)

    console.log
      üîÑ === REMATCH SERVICE RESPONSE ===

      at log (src/app/api/game/[gameId]/vote-session/route.ts:150:19)

    console.log
      üîÑ Service duration: 0ms

      at log (src/app/api/game/[gameId]/vote-session/route.ts:151:19)

    console.log
      üîÑ Service result: {
        "success": false,
        "error": {
          "message": "Rematch failed",
          "details": "Database error"
        }
      }

      at log (src/app/api/game/[gameId]/vote-session/route.ts:152:19)

    console.error
      üîÑ === REMATCH SERVICE ERROR === Rematch failed

      162 |             )
      163 |           } else {
    > 164 |             console.error(
          |                     ^
      165 |               "üîÑ === REMATCH SERVICE ERROR ===",
      166 |               result.error.message
      167 |             )

      at error (src/app/api/game/[gameId]/vote-session/route.ts:164:21)
      at Object.<anonymous> (src/app/api/game/[gameId]/vote-session/__tests__/route.test.ts:309:7)

    console.log
      üó≥Ô∏è Vote API: Processing vote for game g1: { vote: 'continue' }

      at log (src/app/api/game/[gameId]/vote-session/route.ts:30:13)

    console.log
      üó≥Ô∏è Vote recorded: TestPlayer voted continue

      at log (src/app/api/game/[gameId]/vote-session/route.ts:76:13)

    console.log
      üó≥Ô∏è Current votes for game g1: { p1: 'continue' }

      at log (src/app/api/game/[gameId]/vote-session/route.ts:77:13)

    console.log
      üó≥Ô∏è Vote analysis result: {
        action: 'continue',
        message: 'All players voted to continue',
        details: {
          continueVotes: 4,
          endVotes: 0,
          pauseVotes: 0,
          totalPlayers: 4,
          votedPlayers: 4
        }
      }

      at log (src/app/api/game/[gameId]/vote-session/route.ts:85:13)

    console.log
      üîå Vote API: Found WebSocket instance in process

      at log (src/app/api/game/[gameId]/vote-session/route.ts:90:15)

    console.log
      üîå Broadcasted vote update to room ROOM1

      at log (src/app/api/game/[gameId]/vote-session/route.ts:98:15)

    console.log
      üîÑ Continue process triggered by votes

      at log (src/app/api/game/[gameId]/vote-session/route.ts:134:17)

    console.log
      üîÑ === CALLING REMATCH SERVICE DIRECTLY ===

      at log (src/app/api/game/[gameId]/vote-session/route.ts:141:19)

    console.log
      üîÑ Environment: test

      at log (src/app/api/game/[gameId]/vote-session/route.ts:142:19)

    console.log
      üîÑ GameId: g1

      at log (src/app/api/game/[gameId]/vote-session/route.ts:143:19)

    console.log
      üîÑ Service call data: { continueSession: true }

      at log (src/app/api/game/[gameId]/vote-session/route.ts:144:19)

    console.error
      üîÑ Error creating new room: Error [AbortError]: Request timeout
          at Object.<anonymous> (/Users/nyanpass/source/repos/mahjong-point-manager/src/app/api/game/[gameId]/vote-session/__tests__/route.test.ts:320:26)
          at Promise.finally.completed (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/jestAdapterInit.js:1559:28)
          at new Promise (<anonymous>)
          at callAsyncCircusFn (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/jestAdapterInit.js:1499:10)
          at _callCircusTest (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/jestAdapterInit.js:1009:40)
          at processTicksAndRejections (node:internal/process/task_queues:105:5)
          at _runTest (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/jestAdapterInit.js:949:3)
          at _runTestsForDescribeBlock (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/jestAdapterInit.js:839:13)
          at _runTestsForDescribeBlock (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/jestAdapterInit.js:829:11)
          at _runTestsForDescribeBlock (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/jestAdapterInit.js:829:11)
          at run (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/jestAdapterInit.js:757:3)
          at runAndTransformResultsToJestFormat (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/jestAdapterInit.js:1920:21)
          at jestAdapter (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/runner.js:101:19)
          at runTestInternal (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-runner/build/testWorker.js:272:16)
          at runTest (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-runner/build/testWorker.js:340:7)
          at Object.worker (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-runner/build/testWorker.js:494:12)

      172 |           }
      173 |         } catch (err) {
    > 174 |           console.error("üîÑ Error creating new room:", err)
          |                   ^
      175 |
      176 |           let errorMessage = "Êñ∞„Åó„ÅÑ„É´„Éº„É†‰ΩúÊàê„Å´Â§±Êïó„Åó„Åæ„Åó„Åü"
      177 |           let errorDetails = "‰∏çÊòé„Å™„Ç®„É©„Éº"

      at error (src/app/api/game/[gameId]/vote-session/route.ts:174:19)
      at Object.<anonymous> (src/app/api/game/[gameId]/vote-session/__tests__/route.test.ts:328:7)

    console.log
      üó≥Ô∏è Vote API: Processing vote for game g1: { vote: 'continue' }

      at log (src/app/api/game/[gameId]/vote-session/route.ts:30:13)

    console.log
      üó≥Ô∏è Vote recorded: TestPlayer voted continue

      at log (src/app/api/game/[gameId]/vote-session/route.ts:76:13)

    console.log
      üó≥Ô∏è Current votes for game g1: { p1: 'continue' }

      at log (src/app/api/game/[gameId]/vote-session/route.ts:77:13)

    console.log
      üó≥Ô∏è Vote analysis result: {
        action: 'continue',
        message: 'All players voted to continue',
        details: {
          continueVotes: 4,
          endVotes: 0,
          pauseVotes: 0,
          totalPlayers: 4,
          votedPlayers: 4
        }
      }

      at log (src/app/api/game/[gameId]/vote-session/route.ts:85:13)

    console.log
      üîå Vote API: Found WebSocket instance in process

      at log (src/app/api/game/[gameId]/vote-session/route.ts:90:15)

    console.log
      üîå Broadcasted vote update to room ROOM1

      at log (src/app/api/game/[gameId]/vote-session/route.ts:98:15)

    console.log
      üîÑ Continue process triggered by votes

      at log (src/app/api/game/[gameId]/vote-session/route.ts:134:17)

    console.log
      üîÑ === CALLING REMATCH SERVICE DIRECTLY ===

      at log (src/app/api/game/[gameId]/vote-session/route.ts:141:19)

    console.log
      üîÑ Environment: test

      at log (src/app/api/game/[gameId]/vote-session/route.ts:142:19)

    console.log
      üîÑ GameId: g1

      at log (src/app/api/game/[gameId]/vote-session/route.ts:143:19)

    console.log
      üîÑ Service call data: { continueSession: true }

      at log (src/app/api/game/[gameId]/vote-session/route.ts:144:19)

    console.error
      üîÑ Error creating new room: Error: Generic error
          at Object.<anonymous> (/Users/nyanpass/source/repos/mahjong-point-manager/src/app/api/game/[gameId]/vote-session/__tests__/route.test.ts:339:43)
          at Promise.finally.completed (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/jestAdapterInit.js:1559:28)
          at new Promise (<anonymous>)
          at callAsyncCircusFn (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/jestAdapterInit.js:1499:10)
          at _callCircusTest (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/jestAdapterInit.js:1009:40)
          at processTicksAndRejections (node:internal/process/task_queues:105:5)
          at _runTest (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/jestAdapterInit.js:949:3)
          at _runTestsForDescribeBlock (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/jestAdapterInit.js:839:13)
          at _runTestsForDescribeBlock (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/jestAdapterInit.js:829:11)
          at _runTestsForDescribeBlock (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/jestAdapterInit.js:829:11)
          at run (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/jestAdapterInit.js:757:3)
          at runAndTransformResultsToJestFormat (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/jestAdapterInit.js:1920:21)
          at jestAdapter (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/runner.js:101:19)
          at runTestInternal (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-runner/build/testWorker.js:272:16)
          at runTest (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-runner/build/testWorker.js:340:7)
          at Object.worker (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-runner/build/testWorker.js:494:12)

      172 |           }
      173 |         } catch (err) {
    > 174 |           console.error("üîÑ Error creating new room:", err)
          |                   ^
      175 |
      176 |           let errorMessage = "Êñ∞„Åó„ÅÑ„É´„Éº„É†‰ΩúÊàê„Å´Â§±Êïó„Åó„Åæ„Åó„Åü"
      177 |           let errorDetails = "‰∏çÊòé„Å™„Ç®„É©„Éº"

      at error (src/app/api/game/[gameId]/vote-session/route.ts:174:19)
      at Object.<anonymous> (src/app/api/game/[gameId]/vote-session/__tests__/route.test.ts:345:7)

    console.log
      üó≥Ô∏è Vote API: Processing vote for game g1: { vote: 'pause' }

      at log (src/app/api/game/[gameId]/vote-session/route.ts:30:13)

    console.log
      üó≥Ô∏è Vote recorded: TestPlayer voted pause

      at log (src/app/api/game/[gameId]/vote-session/route.ts:76:13)

    console.log
      üó≥Ô∏è Current votes for game g1: { p1: 'pause' }

      at log (src/app/api/game/[gameId]/vote-session/route.ts:77:13)

    console.log
      üó≥Ô∏è Vote analysis result: {
        action: 'wait',
        message: 'All players voted to pause',
        details: {
          continueVotes: 0,
          endVotes: 0,
          pauseVotes: 4,
          totalPlayers: 4,
          votedPlayers: 4
        }
      }

      at log (src/app/api/game/[gameId]/vote-session/route.ts:85:13)

    console.log
      üîå Vote API: Found WebSocket instance in process

      at log (src/app/api/game/[gameId]/vote-session/route.ts:90:15)

    console.log
      üîå Broadcasted vote update to room ROOM1

      at log (src/app/api/game/[gameId]/vote-session/route.ts:98:15)

    console.log
      ‚è∏Ô∏è All players voted pause, resetting votes...

      at log (src/app/api/game/[gameId]/vote-session/route.ts:207:19)

    console.log
      üó≥Ô∏è Vote API: Processing vote for game g1: { vote: 'continue' }

      at log (src/app/api/game/[gameId]/vote-session/route.ts:30:13)

    console.log
      üó≥Ô∏è Vote recorded: TestPlayer voted continue

      at log (src/app/api/game/[gameId]/vote-session/route.ts:76:13)

    console.log
      üó≥Ô∏è Current votes for game g1: { p1: 'continue' }

      at log (src/app/api/game/[gameId]/vote-session/route.ts:77:13)

    console.log
      üó≥Ô∏è Vote analysis result: {
        action: 'wait',
        message: '',
        details: {
          continueVotes: 0,
          endVotes: 0,
          pauseVotes: 0,
          totalPlayers: 4,
          votedPlayers: 1
        }
      }

      at log (src/app/api/game/[gameId]/vote-session/route.ts:85:13)

    console.log
      üó≥Ô∏è Vote API: Processing vote for game g1: { vote: 'continue' }

      at log (src/app/api/game/[gameId]/vote-session/route.ts:30:13)

    console.error
      Vote session failed: Error: Database error
          at Object.<anonymous> (/Users/nyanpass/source/repos/mahjong-point-manager/src/app/api/game/[gameId]/vote-session/__tests__/route.test.ts:415:41)
          at Promise.finally.completed (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/jestAdapterInit.js:1559:28)
          at new Promise (<anonymous>)
          at callAsyncCircusFn (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/jestAdapterInit.js:1499:10)
          at _callCircusTest (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/jestAdapterInit.js:1009:40)
          at processTicksAndRejections (node:internal/process/task_queues:105:5)
          at _runTest (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/jestAdapterInit.js:949:3)
          at _runTestsForDescribeBlock (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/jestAdapterInit.js:839:13)
          at _runTestsForDescribeBlock (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/jestAdapterInit.js:829:11)
          at _runTestsForDescribeBlock (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/jestAdapterInit.js:829:11)
          at run (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/jestAdapterInit.js:757:3)
          at runAndTransformResultsToJestFormat (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/jestAdapterInit.js:1920:21)
          at jestAdapter (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/runner.js:101:19)
          at runTestInternal (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-runner/build/testWorker.js:272:16)
          at runTest (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-runner/build/testWorker.js:340:7)
          at Object.worker (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-runner/build/testWorker.js:494:12)

      257 |     }
      258 |
    > 259 |     console.error("Vote session failed:", error)
          |             ^
      260 |     return NextResponse.json(
      261 |       {
      262 |         success: false,

      at error (src/app/api/game/[gameId]/vote-session/route.ts:259:13)
      at Object.<anonymous> (src/app/api/game/[gameId]/vote-session/__tests__/route.test.ts:421:19)

    console.log
      üó≥Ô∏è Vote API: Processing vote for game g1: { vote: 'continue' }

      at log (src/app/api/game/[gameId]/vote-session/route.ts:30:13)

    console.error
      Vote session failed: Unknown error

      257 |     }
      258 |
    > 259 |     console.error("Vote session failed:", error)
          |             ^
      260 |     return NextResponse.json(
      261 |       {
      262 |         success: false,

      at error (src/app/api/game/[gameId]/vote-session/route.ts:259:13)
      at Object.<anonymous> (src/app/api/game/[gameId]/vote-session/__tests__/route.test.ts:438:19)

    console.log
      üó≥Ô∏è Cancel vote for player TestPlayer in game g1

      at log (src/app/api/game/[gameId]/vote-session/route.ts:284:13)

    console.log
      üîå Broadcasted vote cancellation to room ROOM1

      at log (src/app/api/game/[gameId]/vote-session/route.ts:315:17)

    console.log
      üó≥Ô∏è Cancel vote for player TestPlayer in game g1

      at log (src/app/api/game/[gameId]/vote-session/route.ts:284:13)

    console.log
      üîå Broadcasted vote cancellation to room ROOM1

      at log (src/app/api/game/[gameId]/vote-session/route.ts:315:17)

    console.log
      üó≥Ô∏è Cancel vote for player TestPlayer in game g1

      at log (src/app/api/game/[gameId]/vote-session/route.ts:284:13)

    console.log
      üîå Broadcasted vote cancellation to room ROOM1

      at log (src/app/api/game/[gameId]/vote-session/route.ts:315:17)

    console.log
      üó≥Ô∏è Cancel vote for player TestPlayer in game g1

      at log (src/app/api/game/[gameId]/vote-session/route.ts:284:13)

    console.log
      üîå Broadcasted vote cancellation to room ROOM1

      at log (src/app/api/game/[gameId]/vote-session/route.ts:315:17)

    console.log
      üó≥Ô∏è Cancel vote for player TestPlayer in game g1

      at log (src/app/api/game/[gameId]/vote-session/route.ts:284:13)

    console.log
      üó≥Ô∏è Cancel vote for player TestPlayer in game g1

      at log (src/app/api/game/[gameId]/vote-session/route.ts:284:13)

    console.error
      Cancel vote failed: Error: Auth failed
          at Object.<anonymous> (/Users/nyanpass/source/repos/mahjong-point-manager/src/app/api/game/[gameId]/vote-session/__tests__/route.test.ts:564:34)
          at Promise.finally.completed (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/jestAdapterInit.js:1559:28)
          at new Promise (<anonymous>)
          at callAsyncCircusFn (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/jestAdapterInit.js:1499:10)
          at _callCircusTest (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/jestAdapterInit.js:1009:40)
          at processTicksAndRejections (node:internal/process/task_queues:105:5)
          at _runTest (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/jestAdapterInit.js:949:3)
          at _runTestsForDescribeBlock (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/jestAdapterInit.js:839:13)
          at _runTestsForDescribeBlock (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/jestAdapterInit.js:829:11)
          at _runTestsForDescribeBlock (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/jestAdapterInit.js:829:11)
          at run (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/jestAdapterInit.js:757:3)
          at runAndTransformResultsToJestFormat (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/jestAdapterInit.js:1920:21)
          at jestAdapter (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/runner.js:101:19)
          at runTestInternal (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-runner/build/testWorker.js:272:16)
          at runTest (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-runner/build/testWorker.js:340:7)
          at Object.worker (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-runner/build/testWorker.js:494:12)

      327 |     })
      328 |   } catch (error) {
    > 329 |     console.error("Cancel vote failed:", error)
          |             ^
      330 |     return NextResponse.json(
      331 |       {
      332 |         success: false,

      at error (src/app/api/game/[gameId]/vote-session/route.ts:329:13)
      at Object.<anonymous> (src/app/api/game/[gameId]/vote-session/__tests__/route.test.ts:567:19)

    console.log
      üó≥Ô∏è Cancel vote for player TestPlayer in game g1

      at log (src/app/api/game/[gameId]/vote-session/route.ts:284:13)

    console.error
      Cancel vote failed: Error: Database error
          at Object.<anonymous> (/Users/nyanpass/source/repos/mahjong-point-manager/src/app/api/game/[gameId]/vote-session/__tests__/route.test.ts:577:41)
          at Promise.finally.completed (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/jestAdapterInit.js:1559:28)
          at new Promise (<anonymous>)
          at callAsyncCircusFn (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/jestAdapterInit.js:1499:10)
          at _callCircusTest (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/jestAdapterInit.js:1009:40)
          at processTicksAndRejections (node:internal/process/task_queues:105:5)
          at _runTest (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/jestAdapterInit.js:949:3)
          at _runTestsForDescribeBlock (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/jestAdapterInit.js:839:13)
          at _runTestsForDescribeBlock (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/jestAdapterInit.js:829:11)
          at _runTestsForDescribeBlock (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/jestAdapterInit.js:829:11)
          at run (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/jestAdapterInit.js:757:3)
          at runAndTransformResultsToJestFormat (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/jestAdapterInit.js:1920:21)
          at jestAdapter (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/runner.js:101:19)
          at runTestInternal (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-runner/build/testWorker.js:272:16)
          at runTest (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-runner/build/testWorker.js:340:7)
          at Object.worker (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-runner/build/testWorker.js:494:12)

      327 |     })
      328 |   } catch (error) {
    > 329 |     console.error("Cancel vote failed:", error)
          |             ^
      330 |     return NextResponse.json(
      331 |       {
      332 |         success: false,

      at error (src/app/api/game/[gameId]/vote-session/route.ts:329:13)
      at Object.<anonymous> (src/app/api/game/[gameId]/vote-session/__tests__/route.test.ts:580:19)

PASS src/components/__tests__/GameInfo.test.tsx
PASS src/app/api/game/[gameId]/result/__tests__/route.test.ts
  ‚óè Console

    console.log
      Fetching unified game result for gameId: test-game-id

      at log (src/app/api/game/[gameId]/result/route.ts:43:13)

    console.log
      Processing as multiplayer game result

      at log (src/app/api/game/[gameId]/result/route.ts:64:15)

    console.log
      Unified game result query: {
        gameId: 'test-game-id',
        game: {
          id: 'test-game-id',
          status: 'FINISHED',
          players: [ [Object], [Object], [Object], [Object] ]
        }
      }

      at log (src/app/api/game/[gameId]/result/route.ts:107:11)

    console.log
      Processed multiplayer results: [
        {
          playerId: 'player1',
          name: 'Player 1',
          finalPoints: 32000,
          rank: 1,
          uma: 20,
          settlement: 7000
        },
        {
          playerId: 'player2',
          name: 'Player 2',
          finalPoints: 28000,
          rank: 2,
          uma: 10,
          settlement: 3000
        },
        {
          playerId: 'player3',
          name: 'Player 3',
          finalPoints: 22000,
          rank: 3,
          uma: -10,
          settlement: -3000
        },
        {
          playerId: 'player4',
          name: 'Player 4',
          finalPoints: 18000,
          rank: 4,
          uma: -20,
          settlement: -7000
        }
      ]

      at log (src/app/api/game/[gameId]/result/route.ts:189:11)

    console.log
      Fetching unified game result for gameId: test-game-id

      at log (src/app/api/game/[gameId]/result/route.ts:43:13)

    console.log
      Processing as multiplayer game result

      at log (src/app/api/game/[gameId]/result/route.ts:64:15)

    console.log
      Unified game result query: {
        gameId: 'test-game-id',
        game: {
          id: 'test-game-id',
          status: 'FINISHED',
          players: [ [Object], [Object], [Object], [Object] ]
        }
      }

      at log (src/app/api/game/[gameId]/result/route.ts:107:11)

    console.log
      Processed multiplayer results: [
        {
          playerId: 'player1',
          name: 'Player 1',
          finalPoints: 32000,
          rank: 1,
          uma: 20,
          settlement: 7000
        },
        {
          playerId: 'player2',
          name: 'Player 2',
          finalPoints: 28000,
          rank: 2,
          uma: 10,
          settlement: 3000
        },
        {
          playerId: 'player3',
          name: 'Player 3',
          finalPoints: 22000,
          rank: 3,
          uma: -10,
          settlement: -3000
        },
        {
          playerId: 'player4',
          name: 'Player 4',
          finalPoints: 18000,
          rank: 4,
          uma: -20,
          settlement: -7000
        }
      ]

      at log (src/app/api/game/[gameId]/result/route.ts:189:11)

    console.log
      Fetching unified game result for gameId: test-game-id

      at log (src/app/api/game/[gameId]/result/route.ts:43:13)

    console.log
      Processing as multiplayer game result

      at log (src/app/api/game/[gameId]/result/route.ts:64:15)

    console.log
      Unified game result query: {
        gameId: 'test-game-id',
        game: {
          id: 'test-game-id',
          status: 'FINISHED',
          players: [ [Object], [Object], [Object], [Object] ]
        }
      }

      at log (src/app/api/game/[gameId]/result/route.ts:107:11)

    console.log
      Processed multiplayer results: [
        {
          playerId: 'player1',
          name: 'Player 1',
          finalPoints: 32000,
          rank: 1,
          uma: 0,
          settlement: 7000
        },
        {
          playerId: 'player2',
          name: 'Player 2',
          finalPoints: 28000,
          rank: 2,
          uma: 0,
          settlement: 3000
        },
        {
          playerId: 'player3',
          name: 'Player 3',
          finalPoints: 22000,
          rank: 3,
          uma: 0,
          settlement: -3000
        },
        {
          playerId: 'player4',
          name: 'Player 4',
          finalPoints: 18000,
          rank: 4,
          uma: 0,
          settlement: -7000
        }
      ]

      at log (src/app/api/game/[gameId]/result/route.ts:189:11)

    console.log
      Fetching unified game result for gameId: test-game-id

      at log (src/app/api/game/[gameId]/result/route.ts:43:13)

    console.log
      Processing as multiplayer game result

      at log (src/app/api/game/[gameId]/result/route.ts:64:15)

    console.log
      Fetching unified game result for gameId: test-game-id

      at log (src/app/api/game/[gameId]/result/route.ts:43:13)

    console.log
      Processing as multiplayer game result

      at log (src/app/api/game/[gameId]/result/route.ts:64:15)

    console.log
      Unified game result query: {
        gameId: 'test-game-id',
        game: {
          id: 'test-game-id',
          status: 'FINISHED',
          players: [ [Object], [Object], [Object], [Object] ]
        }
      }

      at log (src/app/api/game/[gameId]/result/route.ts:107:11)

    console.log
      Processed multiplayer results: [
        {
          playerId: 'player1',
          name: 'Player 1',
          finalPoints: 32000,
          rank: 1,
          uma: 20,
          settlement: 7000
        },
        {
          playerId: 'player2',
          name: 'Player 2',
          finalPoints: 28000,
          rank: 2,
          uma: 10,
          settlement: 3000
        },
        {
          playerId: 'player3',
          name: 'Player 3',
          finalPoints: 22000,
          rank: 3,
          uma: -10,
          settlement: -3000
        },
        {
          playerId: 'player4',
          name: 'Player 4',
          finalPoints: 18000,
          rank: 4,
          uma: -20,
          settlement: -7000
        }
      ]

      at log (src/app/api/game/[gameId]/result/route.ts:189:11)

    console.log
      Fetching unified game result for gameId: test-solo-game-id

      at log (src/app/api/game/[gameId]/result/route.ts:43:13)

    console.log
      Processing as solo game result (using multiplayer logic)

      at log (src/app/api/game/[gameId]/result/route.ts:79:15)

    console.log
      Unified game result query: {
        gameId: 'test-solo-game-id',
        game: {
          id: 'test-solo-game-id',
          status: 'FINISHED',
          players: [ [Object], [Object], [Object], [Object] ]
        }
      }

      at log (src/app/api/game/[gameId]/result/route.ts:107:11)

    console.log
      Processed multiplayer results: [
        {
          playerId: '0',
          name: 'Player 1',
          finalPoints: 30000,
          rank: 1,
          uma: 15,
          settlement: 5000
        },
        {
          playerId: '1',
          name: 'Player 2',
          finalPoints: 25000,
          rank: 2,
          uma: 5,
          settlement: 0
        },
        {
          playerId: '2',
          name: 'Player 3',
          finalPoints: 23000,
          rank: 3,
          uma: -5,
          settlement: -2000
        },
        {
          playerId: '3',
          name: 'Player 4',
          finalPoints: 22000,
          rank: 4,
          uma: -15,
          settlement: -3000
        }
      ]

      at log (src/app/api/game/[gameId]/result/route.ts:189:11)

    console.log
      Fetching unified game result for gameId: test-solo-game-id

      at log (src/app/api/game/[gameId]/result/route.ts:43:13)

    console.log
      Processing as solo game result (using multiplayer logic)

      at log (src/app/api/game/[gameId]/result/route.ts:79:15)

    console.log
      Unified game result query: {
        gameId: 'test-solo-game-id',
        game: {
          id: 'test-solo-game-id',
          status: 'FINISHED',
          players: [ [Object], [Object], [Object], [Object] ]
        }
      }

      at log (src/app/api/game/[gameId]/result/route.ts:107:11)

    console.log
      Processed multiplayer results: [
        {
          playerId: '0',
          name: 'Player 1',
          finalPoints: 30000,
          rank: 1,
          uma: 0,
          settlement: 5000
        },
        {
          playerId: '1',
          name: 'Player 2',
          finalPoints: 25000,
          rank: 2,
          uma: 0,
          settlement: 0
        },
        {
          playerId: '2',
          name: 'Player 3',
          finalPoints: 23000,
          rank: 3,
          uma: 0,
          settlement: -2000
        },
        {
          playerId: '3',
          name: 'Player 4',
          finalPoints: 22000,
          rank: 4,
          uma: 0,
          settlement: -3000
        }
      ]

      at log (src/app/api/game/[gameId]/result/route.ts:189:11)

    console.log
      Fetching unified game result for gameId: test-solo-game-id

      at log (src/app/api/game/[gameId]/result/route.ts:43:13)

    console.log
      Processing as solo game result (using multiplayer logic)

      at log (src/app/api/game/[gameId]/result/route.ts:79:15)

    console.log
      Fetching unified game result for gameId: test-solo-game-id

      at log (src/app/api/game/[gameId]/result/route.ts:43:13)

    console.log
      Processing as solo game result (using multiplayer logic)

      at log (src/app/api/game/[gameId]/result/route.ts:79:15)

    console.log
      Unified game result query: {
        gameId: 'test-solo-game-id',
        game: {
          id: 'test-solo-game-id',
          status: 'FINISHED',
          players: [ [Object], [Object], [Object], [Object] ]
        }
      }

      at log (src/app/api/game/[gameId]/result/route.ts:107:11)

    console.log
      Processed multiplayer results: [
        {
          playerId: '0',
          name: 'Player 1',
          finalPoints: 30000,
          rank: 1,
          uma: 15,
          settlement: 5000
        },
        {
          playerId: '1',
          name: 'Player 2',
          finalPoints: 25000,
          rank: 2,
          uma: 5,
          settlement: 0
        },
        {
          playerId: '2',
          name: 'Player 3',
          finalPoints: 23000,
          rank: 3,
          uma: -5,
          settlement: -2000
        },
        {
          playerId: '3',
          name: 'Player 4',
          finalPoints: 22000,
          rank: 4,
          uma: -15,
          settlement: -3000
        }
      ]

      at log (src/app/api/game/[gameId]/result/route.ts:189:11)

    console.log
      Fetching unified game result for gameId: nonexistent-game

      at log (src/app/api/game/[gameId]/result/route.ts:43:13)

    console.log
      Fetching unified game result for gameId: test-game-id

      at log (src/app/api/game/[gameId]/result/route.ts:43:13)

    console.log
      Processing as multiplayer game result

      at log (src/app/api/game/[gameId]/result/route.ts:64:15)

    console.log
      Unified game result query: {
        gameId: 'test-game-id',
        game: { id: 'test-game-id', status: 'FINISHED', players: [] }
      }

      at log (src/app/api/game/[gameId]/result/route.ts:107:11)

    console.log
      Processed multiplayer results: []

      at log (src/app/api/game/[gameId]/result/route.ts:189:11)

    console.log
      Fetching unified game result for gameId: test-game-id

      at log (src/app/api/game/[gameId]/result/route.ts:43:13)

    console.log
      Processing as multiplayer game result

      at log (src/app/api/game/[gameId]/result/route.ts:64:15)

    console.log
      Unified game result query: {
        gameId: 'test-game-id',
        game: { id: 'test-game-id', status: 'FINISHED', players: [] }
      }

      at log (src/app/api/game/[gameId]/result/route.ts:107:11)

    console.log
      Processed multiplayer results: []

      at log (src/app/api/game/[gameId]/result/route.ts:189:11)

    console.log
      Fetching unified game result for gameId: test-game-id

      at log (src/app/api/game/[gameId]/result/route.ts:43:13)

    console.log
      Processing as multiplayer game result

      at log (src/app/api/game/[gameId]/result/route.ts:64:15)

    console.log
      Unified game result query: {
        gameId: 'test-game-id',
        game: { id: 'test-game-id', status: 'FINISHED', players: [] }
      }

      at log (src/app/api/game/[gameId]/result/route.ts:107:11)

    console.log
      Processed multiplayer results: []

      at log (src/app/api/game/[gameId]/result/route.ts:189:11)

    console.log
      Fetching unified game result for gameId: test-game-id

      at log (src/app/api/game/[gameId]/result/route.ts:43:13)

    console.log
      Processing as multiplayer game result

      at log (src/app/api/game/[gameId]/result/route.ts:64:15)

    console.log
      Unified game result query: {
        gameId: 'test-game-id',
        game: { id: 'test-game-id', status: 'FINISHED', players: [] }
      }

      at log (src/app/api/game/[gameId]/result/route.ts:107:11)

    console.log
      Processed multiplayer results: []

      at log (src/app/api/game/[gameId]/result/route.ts:189:11)

    console.log
      Fetching unified game result for gameId: test-game-id

      at log (src/app/api/game/[gameId]/result/route.ts:43:13)

    console.log
      Processing as multiplayer game result

      at log (src/app/api/game/[gameId]/result/route.ts:64:15)

    console.log
      Unified game result query: {
        gameId: 'test-game-id',
        game: {
          id: 'test-game-id',
          status: 'FINISHED',
          players: [ [Object], [Object] ]
        }
      }

      at log (src/app/api/game/[gameId]/result/route.ts:107:11)

    console.log
      Processed multiplayer results: [
        {
          playerId: 'player1',
          name: 'Player 1',
          finalPoints: 25000,
          rank: 1,
          uma: 0,
          settlement: 0
        },
        {
          playerId: 'player2',
          name: 'Player 2',
          finalPoints: 25000,
          rank: 2,
          uma: 0,
          settlement: 0
        }
      ]

      at log (src/app/api/game/[gameId]/result/route.ts:189:11)

    console.log
      Fetching unified game result for gameId: test-game-id

      at log (src/app/api/game/[gameId]/result/route.ts:43:13)

    console.log
      Processing as multiplayer game result

      at log (src/app/api/game/[gameId]/result/route.ts:64:15)

    console.log
      Unified game result query: {
        gameId: 'test-game-id',
        game: { id: 'test-game-id', status: 'FINISHED', players: [] }
      }

      at log (src/app/api/game/[gameId]/result/route.ts:107:11)

    console.log
      Processed multiplayer results: []

      at log (src/app/api/game/[gameId]/result/route.ts:189:11)

PASS src/components/ui/__tests__/button.test.tsx
PASS src/components/__tests__/GameEndScreen.test.tsx
PASS src/app/api/auth/player/__tests__/route.test.ts
PASS src/app/api/room/[roomCode]/rejoin/__tests__/route.test.ts
  ‚óè Console

    console.log
      Found existing participant: {
        id: 'participant-1',
        playerId: 'old-player-id',
        position: 0,
        currentPoints: 25000,
        isReach: false,
        player: { name: '„ÉÜ„Çπ„Éà„Éó„É¨„Ç§„É§„Éº' }
      }

      at log (src/app/api/room/[roomCode]/rejoin/route.ts:82:15)

    console.log
      Current player ID: current-player-id

      at log (src/app/api/room/[roomCode]/rejoin/route.ts:83:15)

    console.log
      Existing player ID: old-player-id

      at log (src/app/api/room/[roomCode]/rejoin/route.ts:84:15)

    console.log
      Deleted old player record: old-player-id

      at log (src/app/api/room/[roomCode]/rejoin/route.ts:106:19)

    console.log
      Found existing participant: {
        id: 'participant-1',
        playerId: 'old-host-id',
        position: 0,
        currentPoints: 25000,
        isReach: false,
        player: { name: '„Éõ„Çπ„Éà„Éó„É¨„Ç§„É§„Éº' }
      }

      at log (src/app/api/room/[roomCode]/rejoin/route.ts:82:15)

    console.log
      Current player ID: current-player-id

      at log (src/app/api/room/[roomCode]/rejoin/route.ts:83:15)

    console.log
      Existing player ID: old-host-id

      at log (src/app/api/room/[roomCode]/rejoin/route.ts:84:15)

    console.log
      Deleted old player record: old-host-id

      at log (src/app/api/room/[roomCode]/rejoin/route.ts:106:19)

    console.log
      Found existing participant: {
        id: 'participant-1',
        playerId: 'old-player-id',
        position: 0,
        currentPoints: 25000,
        isReach: false,
        player: { name: '„ÉÜ„Çπ„Éà„Éó„É¨„Ç§„É§„Éº' }
      }

      at log (src/app/api/room/[roomCode]/rejoin/route.ts:82:15)

    console.log
      Current player ID: current-player-id

      at log (src/app/api/room/[roomCode]/rejoin/route.ts:83:15)

    console.log
      Existing player ID: old-player-id

      at log (src/app/api/room/[roomCode]/rejoin/route.ts:84:15)

    console.log
      Deleted old player record: old-player-id

      at log (src/app/api/room/[roomCode]/rejoin/route.ts:106:19)

    console.log
      Found existing participant: {
        id: 'participant-1',
        playerId: 'old-player-id',
        position: 0,
        currentPoints: 25000,
        isReach: false,
        player: { name: '„ÉÜ„Çπ„Éà„Éó„É¨„Ç§„É§„Éº' }
      }

      at log (src/app/api/room/[roomCode]/rejoin/route.ts:82:15)

    console.log
      Current player ID: current-player-id

      at log (src/app/api/room/[roomCode]/rejoin/route.ts:83:15)

    console.log
      Existing player ID: old-player-id

      at log (src/app/api/room/[roomCode]/rejoin/route.ts:84:15)

    console.log
      Deleted old player record: old-player-id

      at log (src/app/api/room/[roomCode]/rejoin/route.ts:106:19)

    console.log
      Found existing participant: {
        id: 'participant-1',
        playerId: 'old-player-id',
        position: 0,
        currentPoints: 25000,
        isReach: false,
        player: { name: '„ÉÜ„Çπ„Éà„Éó„É¨„Ç§„É§„Éº' }
      }

      at log (src/app/api/room/[roomCode]/rejoin/route.ts:82:15)

    console.log
      Current player ID: current-player-id

      at log (src/app/api/room/[roomCode]/rejoin/route.ts:83:15)

    console.log
      Existing player ID: old-player-id

      at log (src/app/api/room/[roomCode]/rejoin/route.ts:84:15)

    console.log
      Deleted old player record: old-player-id

      at log (src/app/api/room/[roomCode]/rejoin/route.ts:106:19)

    console.error
      Room rejoin failed: Error: DB Error
          at Object.<anonymous> (/Users/nyanpass/source/repos/mahjong-point-manager/src/app/api/room/[roomCode]/rejoin/__tests__/route.test.ts:443:51)
          at Promise.finally.completed (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/jestAdapterInit.js:1559:28)
          at new Promise (<anonymous>)
          at callAsyncCircusFn (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/jestAdapterInit.js:1499:10)
          at _callCircusTest (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/jestAdapterInit.js:1009:40)
          at processTicksAndRejections (node:internal/process/task_queues:105:5)
          at _runTest (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/jestAdapterInit.js:949:3)
          at _runTestsForDescribeBlock (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/jestAdapterInit.js:839:13)
          at _runTestsForDescribeBlock (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/jestAdapterInit.js:829:11)
          at _runTestsForDescribeBlock (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/jestAdapterInit.js:829:11)
          at run (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/jestAdapterInit.js:757:3)
          at runAndTransformResultsToJestFormat (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/jestAdapterInit.js:1920:21)
          at jestAdapter (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/runner.js:101:19)
          at runTestInternal (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-runner/build/testWorker.js:272:16)
          at runTest (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-runner/build/testWorker.js:340:7)
          at Object.worker (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-runner/build/testWorker.js:494:12)

      201 |     }
      202 |
    > 203 |     console.error("Room rejoin failed:", error)
          |             ^
      204 |     return NextResponse.json(
      205 |       {
      206 |         success: false,

      at error (src/app/api/room/[roomCode]/rejoin/route.ts:203:13)
      at Object.<anonymous> (src/app/api/room/[roomCode]/rejoin/__tests__/route.test.ts:454:24)

    console.log
      Found existing participant: {
        id: 'participant-1',
        playerId: 'current-player-id',
        position: 0,
        currentPoints: 25000,
        isReach: false,
        player: { name: '„ÉÜ„Çπ„Éà„Éó„É¨„Ç§„É§„Éº' }
      }

      at log (src/app/api/room/[roomCode]/rejoin/route.ts:82:15)

    console.log
      Current player ID: current-player-id

      at log (src/app/api/room/[roomCode]/rejoin/route.ts:83:15)

    console.log
      Existing player ID: current-player-id

      at log (src/app/api/room/[roomCode]/rejoin/route.ts:84:15)

    console.log
      Found existing participant: {
        id: 'participant-1',
        playerId: 'old-player-id',
        position: 0,
        currentPoints: 25000,
        isReach: false,
        player: { name: '„ÉÜ„Çπ„Éà„Éó„É¨„Ç§„É§„Éº' }
      }

      at log (src/app/api/room/[roomCode]/rejoin/route.ts:82:15)

    console.log
      Current player ID: current-player-id

      at log (src/app/api/room/[roomCode]/rejoin/route.ts:83:15)

    console.log
      Existing player ID: old-player-id

      at log (src/app/api/room/[roomCode]/rejoin/route.ts:84:15)

    console.log
      Could not delete old player record (may be referenced elsewhere): Error: Cannot delete
          at Object.<anonymous> (/Users/nyanpass/source/repos/mahjong-point-manager/src/app/api/room/[roomCode]/rejoin/__tests__/route.test.ts:506:50)
          at Promise.finally.completed (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/jestAdapterInit.js:1559:28)
          at new Promise (<anonymous>)
          at callAsyncCircusFn (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/jestAdapterInit.js:1499:10)
          at _callCircusTest (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/jestAdapterInit.js:1009:40)
          at processTicksAndRejections (node:internal/process/task_queues:105:5)
          at _runTest (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/jestAdapterInit.js:949:3)
          at _runTestsForDescribeBlock (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/jestAdapterInit.js:839:13)
          at _runTestsForDescribeBlock (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/jestAdapterInit.js:829:11)
          at _runTestsForDescribeBlock (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/jestAdapterInit.js:829:11)
          at run (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/jestAdapterInit.js:757:3)
          at runAndTransformResultsToJestFormat (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/jestAdapterInit.js:1920:21)
          at jestAdapter (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/runner.js:101:19)
          at runTestInternal (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-runner/build/testWorker.js:272:16)
          at runTest (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-runner/build/testWorker.js:340:7)
          at Object.worker (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-runner/build/testWorker.js:494:12)

      at log (src/app/api/room/[roomCode]/rejoin/route.ts:111:19)

    console.log
      Found existing participant: {
        id: 'participant-1',
        playerId: 'old-player-id',
        position: 0,
        currentPoints: 25000,
        isReach: false,
        player: { name: '„ÉÜ„Çπ„Éà„Éó„É¨„Ç§„É§„Éº' }
      }

      at log (src/app/api/room/[roomCode]/rejoin/route.ts:82:15)

    console.log
      Current player ID: current-player-id

      at log (src/app/api/room/[roomCode]/rejoin/route.ts:83:15)

    console.log
      Existing player ID: old-player-id

      at log (src/app/api/room/[roomCode]/rejoin/route.ts:84:15)

    console.log
      Could not delete old player record (may be referenced elsewhere): Error: Cannot delete
          at Object.<anonymous> (/Users/nyanpass/source/repos/mahjong-point-manager/src/app/api/room/[roomCode]/rejoin/__tests__/route.test.ts:506:50)
          at Promise.finally.completed (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/jestAdapterInit.js:1559:28)
          at new Promise (<anonymous>)
          at callAsyncCircusFn (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/jestAdapterInit.js:1499:10)
          at _callCircusTest (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/jestAdapterInit.js:1009:40)
          at processTicksAndRejections (node:internal/process/task_queues:105:5)
          at _runTest (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/jestAdapterInit.js:949:3)
          at _runTestsForDescribeBlock (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/jestAdapterInit.js:839:13)
          at _runTestsForDescribeBlock (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/jestAdapterInit.js:829:11)
          at _runTestsForDescribeBlock (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/jestAdapterInit.js:829:11)
          at run (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/jestAdapterInit.js:757:3)
          at runAndTransformResultsToJestFormat (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/jestAdapterInit.js:1920:21)
          at jestAdapter (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/runner.js:101:19)
          at runTestInternal (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-runner/build/testWorker.js:272:16)
          at runTest (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-runner/build/testWorker.js:340:7)
          at Object.worker (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-runner/build/testWorker.js:494:12)

      at log (src/app/api/room/[roomCode]/rejoin/route.ts:111:19)

PASS src/components/__tests__/SessionHistoryModal.test.tsx
PASS src/components/__tests__/ScoreInputForm.test.tsx
  ‚óè Console

    console.error
      Warning: An update to ScoreInputForm inside a test was not wrapped in act(...).
      
      When testing, code that causes React state updates should be wrapped into act(...):
      
      act(() => {
        /* fire events that update state */
      });
      /* assert on the output */
      
      This ensures that you're testing the behavior the user would see in the browser. Learn more at https://reactjs.org/link/wrap-tests-with-act
          at gameState (/Users/nyanpass/source/repos/mahjong-point-manager/src/components/ScoreInputForm.tsx:43:3)
          at MantineThemeProvider (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/@mantine/core/src/core/MantineProvider/MantineThemeProvider/MantineThemeProvider.tsx:33:3)
          at MantineProvider (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/@mantine/core/src/core/MantineProvider/MantineProvider.tsx:65:3)

      87 |       if (response.ok) {
      88 |         const data = await response.json()
    > 89 |         setScorePreview(data.data.result)
         |         ^
      90 |       }
      91 |     } catch (e) {
      92 |       console.error("Preview fetch failed", e)

      at printWarning (node_modules/react-dom/cjs/react-dom.development.js:86:30)
      at error (node_modules/react-dom/cjs/react-dom.development.js:60:7)
      at warnIfUpdatesNotWrappedWithActDEV (node_modules/react-dom/cjs/react-dom.development.js:27628:9)
      at scheduleUpdateOnFiber (node_modules/react-dom/cjs/react-dom.development.js:25547:5)
      at dispatchSetState (node_modules/react-dom/cjs/react-dom.development.js:16708:7)
      at setScorePreview (src/components/ScoreInputForm.tsx:89:9)

PASS src/app/api/game/[gameId]/riichi/__tests__/route.test.ts
  ‚óè Console

    console.log
      Processing unified riichi declaration for gameId: test-game-id

      at log (src/app/api/game/[gameId]/riichi/route.ts:73:13)

    console.log
      Processing as multiplayer riichi

      at log (src/app/api/game/[gameId]/riichi/route.ts:81:15)

    console.log
      üîå API: Found WebSocket instance in process

      at log (src/app/api/game/[gameId]/riichi/route.ts:46:13)

    console.log
      üîå Server: Emitting riichi_declared to room TEST123

      at log (src/app/api/game/[gameId]/riichi/route.ts:133:13)

    console.log
      üîå Server: riichi_declared event sent

      at log (src/app/api/game/[gameId]/riichi/route.ts:138:13)

    console.log
      Processing unified riichi declaration for gameId: test-game-id

      at log (src/app/api/game/[gameId]/riichi/route.ts:73:13)

    console.log
      Processing as multiplayer riichi

      at log (src/app/api/game/[gameId]/riichi/route.ts:81:15)

    console.log
      üîå API: Found WebSocket instance in process

      at log (src/app/api/game/[gameId]/riichi/route.ts:46:13)

    console.log
      üîå Server: Emitting riichi_declared to room TEST123

      at log (src/app/api/game/[gameId]/riichi/route.ts:133:13)

    console.log
      üîå Server: riichi_declared event sent

      at log (src/app/api/game/[gameId]/riichi/route.ts:138:13)

    console.log
      Processing unified riichi declaration for gameId: test-game-id

      at log (src/app/api/game/[gameId]/riichi/route.ts:73:13)

    console.log
      Processing as multiplayer riichi

      at log (src/app/api/game/[gameId]/riichi/route.ts:81:15)

    console.log
      Processing unified riichi declaration for gameId: test-solo-game-id

      at log (src/app/api/game/[gameId]/riichi/route.ts:73:13)

    console.log
      Processing as solo riichi

      at log (src/app/api/game/[gameId]/riichi/route.ts:92:15)

    console.log
      Processing unified riichi declaration for gameId: test-solo-game-id

      at log (src/app/api/game/[gameId]/riichi/route.ts:73:13)

    console.log
      Processing as solo riichi

      at log (src/app/api/game/[gameId]/riichi/route.ts:92:15)

    console.log
      Processing unified riichi declaration for gameId: test-solo-game-id

      at log (src/app/api/game/[gameId]/riichi/route.ts:73:13)

    console.log
      Processing as solo riichi

      at log (src/app/api/game/[gameId]/riichi/route.ts:92:15)

    console.log
      Processing unified riichi declaration for gameId: test-solo-game-id

      at log (src/app/api/game/[gameId]/riichi/route.ts:73:13)

    console.log
      Processing as solo riichi

      at log (src/app/api/game/[gameId]/riichi/route.ts:92:15)

    console.log
      Processing unified riichi declaration for gameId: test-solo-game-id

      at log (src/app/api/game/[gameId]/riichi/route.ts:73:13)

    console.log
      Processing as solo riichi

      at log (src/app/api/game/[gameId]/riichi/route.ts:92:15)

    console.log
      Processing unified riichi declaration for gameId: test-solo-game-id

      at log (src/app/api/game/[gameId]/riichi/route.ts:73:13)

    console.log
      Processing as solo riichi

      at log (src/app/api/game/[gameId]/riichi/route.ts:92:15)

    console.log
      Processing unified riichi declaration for gameId: test-solo-game-id

      at log (src/app/api/game/[gameId]/riichi/route.ts:73:13)

    console.log
      Processing as solo riichi

      at log (src/app/api/game/[gameId]/riichi/route.ts:92:15)

    console.log
      Processing unified riichi declaration for gameId: test-solo-game-id

      at log (src/app/api/game/[gameId]/riichi/route.ts:73:13)

    console.log
      Processing as solo riichi

      at log (src/app/api/game/[gameId]/riichi/route.ts:92:15)

    console.log
      Processing unified riichi declaration for gameId: nonexistent-game

      at log (src/app/api/game/[gameId]/riichi/route.ts:73:13)

PASS src/app/api/players/__tests__/route.test.ts
  ‚óè Console

    console.error
      Failed to fetch players: Error: DB connection failed
          at Object.<anonymous> (/Users/nyanpass/source/repos/mahjong-point-manager/src/app/api/players/__tests__/route.test.ts:76:9)
          at Promise.finally.completed (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/jestAdapterInit.js:1559:28)
          at new Promise (<anonymous>)
          at callAsyncCircusFn (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/jestAdapterInit.js:1499:10)
          at _callCircusTest (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/jestAdapterInit.js:1009:40)
          at processTicksAndRejections (node:internal/process/task_queues:105:5)
          at _runTest (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/jestAdapterInit.js:949:3)
          at _runTestsForDescribeBlock (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/jestAdapterInit.js:839:13)
          at _runTestsForDescribeBlock (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/jestAdapterInit.js:829:11)
          at _runTestsForDescribeBlock (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/jestAdapterInit.js:829:11)
          at run (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/jestAdapterInit.js:757:3)
          at runAndTransformResultsToJestFormat (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/jestAdapterInit.js:1920:21)
          at jestAdapter (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/runner.js:101:19)
          at runTestInternal (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-runner/build/testWorker.js:272:16)
          at runTest (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-runner/build/testWorker.js:340:7)
          at Object.worker (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-runner/build/testWorker.js:494:12)

      19 |     })
      20 |   } catch (error) {
    > 21 |     console.error("Failed to fetch players:", error)
         |             ^
      22 |     return NextResponse.json(
      23 |       {
      24 |         success: false,

      at error (src/app/api/players/route.ts:21:13)
      at Object.<anonymous> (src/app/api/players/__tests__/route.test.ts:79:24)

    console.error
      Failed to create player: Error: DB constraint violation
          at Object.<anonymous> (/Users/nyanpass/source/repos/mahjong-point-manager/src/app/api/players/__tests__/route.test.ts:271:11)
          at Promise.finally.completed (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/jestAdapterInit.js:1559:28)
          at new Promise (<anonymous>)
          at callAsyncCircusFn (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/jestAdapterInit.js:1499:10)
          at _callCircusTest (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/jestAdapterInit.js:1009:40)
          at processTicksAndRejections (node:internal/process/task_queues:105:5)
          at _runTest (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/jestAdapterInit.js:949:3)
          at _runTestsForDescribeBlock (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/jestAdapterInit.js:839:13)
          at _runTestsForDescribeBlock (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/jestAdapterInit.js:829:11)
          at _runTestsForDescribeBlock (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/jestAdapterInit.js:829:11)
          at _runTestsForDescribeBlock (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/jestAdapterInit.js:829:11)
          at run (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/jestAdapterInit.js:757:3)
          at runAndTransformResultsToJestFormat (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/jestAdapterInit.js:1920:21)
          at jestAdapter (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/runner.js:101:19)
          at runTestInternal (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-runner/build/testWorker.js:272:16)
          at runTest (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-runner/build/testWorker.js:340:7)
          at Object.worker (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-runner/build/testWorker.js:494:12)

      60 |     }
      61 |
    > 62 |     console.error("Failed to create player:", error)
         |             ^
      63 |     return NextResponse.json(
      64 |       {
      65 |         success: false,

      at error (src/app/api/players/route.ts:62:13)
      at Object.<anonymous> (src/app/api/players/__tests__/route.test.ts:283:26)

    console.error
      Failed to create player: Unknown error

      60 |     }
      61 |
    > 62 |     console.error("Failed to create player:", error)
         |             ^
      63 |     return NextResponse.json(
      64 |       {
      65 |         success: false,

      at error (src/app/api/players/route.ts:62:13)
      at Object.<anonymous> (src/app/api/players/__tests__/route.test.ts:303:26)

    console.error
      Failed to create player: SyntaxError: Unexpected token
          at EventEmitter.json (/Users/nyanpass/source/repos/mahjong-point-manager/src/app/api/players/__tests__/route.test.ts:392:19)
          at json (/Users/nyanpass/source/repos/mahjong-point-manager/src/app/api/players/route.ts:34:32)
          at Object.<anonymous> (/Users/nyanpass/source/repos/mahjong-point-manager/src/app/api/players/__tests__/route.test.ts:396:36)
          at Promise.finally.completed (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/jestAdapterInit.js:1559:28)
          at new Promise (<anonymous>)
          at callAsyncCircusFn (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/jestAdapterInit.js:1499:10)
          at _callCircusTest (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/jestAdapterInit.js:1009:40)
          at processTicksAndRejections (node:internal/process/task_queues:105:5)
          at _runTest (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/jestAdapterInit.js:949:3)
          at _runTestsForDescribeBlock (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/jestAdapterInit.js:839:13)
          at _runTestsForDescribeBlock (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/jestAdapterInit.js:829:11)
          at _runTestsForDescribeBlock (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/jestAdapterInit.js:829:11)
          at _runTestsForDescribeBlock (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/jestAdapterInit.js:829:11)
          at run (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/jestAdapterInit.js:757:3)
          at runAndTransformResultsToJestFormat (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/jestAdapterInit.js:1920:21)
          at jestAdapter (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/runner.js:101:19)
          at runTestInternal (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-runner/build/testWorker.js:272:16)
          at runTest (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-runner/build/testWorker.js:340:7)
          at Object.worker (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-runner/build/testWorker.js:494:12)

      60 |     }
      61 |
    > 62 |     console.error("Failed to create player:", error)
         |             ^
      63 |     return NextResponse.json(
      64 |       {
      65 |         success: false,

      at error (src/app/api/players/route.ts:62:13)
      at Object.<anonymous> (src/app/api/players/__tests__/route.test.ts:396:36)

PASS src/__tests__/api/sessions.test.ts
  ‚óè Console

    console.error
      Session creation error: Error: Database error
          at Object.<anonymous> (/Users/nyanpass/source/repos/mahjong-point-manager/src/__tests__/api/sessions.test.ts:175:9)
          at Promise.finally.completed (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/jestAdapterInit.js:1559:28)
          at new Promise (<anonymous>)
          at callAsyncCircusFn (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/jestAdapterInit.js:1499:10)
          at _callCircusTest (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/jestAdapterInit.js:1009:40)
          at processTicksAndRejections (node:internal/process/task_queues:105:5)
          at _runTest (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/jestAdapterInit.js:949:3)
          at _runTestsForDescribeBlock (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/jestAdapterInit.js:839:13)
          at _runTestsForDescribeBlock (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/jestAdapterInit.js:829:11)
          at _runTestsForDescribeBlock (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/jestAdapterInit.js:829:11)
          at run (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/jestAdapterInit.js:757:3)
          at runAndTransformResultsToJestFormat (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/jestAdapterInit.js:1920:21)
          at jestAdapter (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/runner.js:101:19)
          at runTestInternal (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-runner/build/testWorker.js:272:16)
          at runTest (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-runner/build/testWorker.js:340:7)
          at Object.worker (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-runner/build/testWorker.js:494:12)

      163 |     )
      164 |   } catch (error) {
    > 165 |     console.error("Session creation error:", error)
          |             ^
      166 |     return NextResponse.json(
      167 |       {
      168 |         success: false,

      at error (src/app/api/sessions/route.ts:165:13)
      at Object.<anonymous> (src/__tests__/api/sessions.test.ts:185:24)

PASS src/app/api/solo/[gameId]/__tests__/route.test.ts
PASS src/lib/__tests__/vote-analysis.test.ts
PASS src/app/api/stats/[playerId]/__tests__/route.test.ts
PASS src/hooks/__tests__/usePerformanceMonitor.test.ts
PASS src/lib/__tests__/solo-point-manager.test.ts
  ‚óè Console

    console.log
      üèÅ Solo Starting settlement calculation with settings: { initialPoints: 25000, basePoints: 30000, uma: [ 30, 10, -10, -30 ] }

      at SoloPointManager.log [as calculateSettlement] (src/lib/solo/solo-point-manager.ts:572:13)

    console.log
      üèÅ Solo Sorted players: [
        { name: 'Player 1', points: 45000, position: 0 },
        { name: 'Player 2', points: 25000, position: 1 },
        { name: 'Player 3', points: 20000, position: 2 },
        { name: 'Player 4', points: 10000, position: 3 }
      ]

      at SoloPointManager.log [as calculateSettlement] (src/lib/solo/solo-point-manager.ts:589:13)

    console.log
      üèÅ Solo Results before adjustment: [
        {
          position: 0,
          finalPoints: 45000,
          rank: 1,
          pointDiff: 15000,
          roundedDiff: 15,
          uma: 30,
          settlement: 0
        },
        {
          position: 1,
          finalPoints: 25000,
          rank: 2,
          pointDiff: -5000,
          roundedDiff: -5,
          uma: 10,
          settlement: 5
        },
        {
          position: 2,
          finalPoints: 20000,
          rank: 3,
          pointDiff: -10000,
          roundedDiff: -10,
          uma: -10,
          settlement: -20
        },
        {
          position: 3,
          finalPoints: 10000,
          rank: 4,
          pointDiff: -20000,
          roundedDiff: -20,
          uma: -30,
          settlement: -50
        }
      ]

      at SoloPointManager.log [as calculateSettlement] (src/lib/solo/solo-point-manager.ts:635:13)

    console.log
      üèÅ Solo Others rounded diff total: -35

      at SoloPointManager.log [as calculateSettlement] (src/lib/solo/solo-point-manager.ts:650:13)

    console.log
      üèÅ Solo First place rounded diff: 35 (= --35)

      at SoloPointManager.log [as calculateSettlement] (src/lib/solo/solo-point-manager.ts:651:13)

    console.log
      üèÅ Solo First place uma: 30

      at SoloPointManager.log [as calculateSettlement] (src/lib/solo/solo-point-manager.ts:654:13)

    console.log
      üèÅ Solo First place settlement: 35 + 30 = 65

      at SoloPointManager.log [as calculateSettlement] (src/lib/solo/solo-point-manager.ts:655:13)

    console.log
      üèÅ Solo Final total check (should be 0): 0

      at SoloPointManager.log [as calculateSettlement] (src/lib/solo/solo-point-manager.ts:661:13)

    console.log
      üèÅ Solo Final results: [
        {
          position: 0,
          finalPoints: 45000,
          rank: 1,
          pointDiff: 15000,
          roundedDiff: 35,
          uma: 30,
          settlement: 65
        },
        {
          position: 1,
          finalPoints: 25000,
          rank: 2,
          pointDiff: -5000,
          roundedDiff: -5,
          uma: 10,
          settlement: 5
        },
        {
          position: 2,
          finalPoints: 20000,
          rank: 3,
          pointDiff: -10000,
          roundedDiff: -10,
          uma: -10,
          settlement: -20
        },
        {
          position: 3,
          finalPoints: 10000,
          rank: 4,
          pointDiff: -20000,
          roundedDiff: -20,
          uma: -30,
          settlement: -50
        }
      ]

      at SoloPointManager.log [as calculateSettlement] (src/lib/solo/solo-point-manager.ts:663:13)

    console.log
      üèÅ Solo Starting settlement calculation with settings: { initialPoints: 25000, basePoints: 30000, uma: [ 20, 10, -10, -20 ] }

      at SoloPointManager.log [as calculateSettlement] (src/lib/solo/solo-point-manager.ts:572:13)

    console.log
      üèÅ Solo Sorted players: [
        { name: 'Player 1', points: 35000, position: 0 },
        { name: 'Player 2', points: 35000, position: 1 },
        { name: 'Player 3', points: 15000, position: 2 },
        { name: 'Player 4', points: 15000, position: 3 }
      ]

      at SoloPointManager.log [as calculateSettlement] (src/lib/solo/solo-point-manager.ts:589:13)

    console.log
      üèÅ Solo Results before adjustment: [
        {
          position: 0,
          finalPoints: 35000,
          rank: 1,
          pointDiff: 5000,
          roundedDiff: 5,
          uma: 20,
          settlement: 0
        },
        {
          position: 1,
          finalPoints: 35000,
          rank: 2,
          pointDiff: 5000,
          roundedDiff: 5,
          uma: 10,
          settlement: 15
        },
        {
          position: 2,
          finalPoints: 15000,
          rank: 3,
          pointDiff: -15000,
          roundedDiff: -15,
          uma: -10,
          settlement: -25
        },
        {
          position: 3,
          finalPoints: 15000,
          rank: 4,
          pointDiff: -15000,
          roundedDiff: -15,
          uma: -20,
          settlement: -35
        }
      ]

      at SoloPointManager.log [as calculateSettlement] (src/lib/solo/solo-point-manager.ts:635:13)

    console.log
      üèÅ Solo Others rounded diff total: -25

      at SoloPointManager.log [as calculateSettlement] (src/lib/solo/solo-point-manager.ts:650:13)

    console.log
      üèÅ Solo First place rounded diff: 25 (= --25)

      at SoloPointManager.log [as calculateSettlement] (src/lib/solo/solo-point-manager.ts:651:13)

    console.log
      üèÅ Solo First place uma: 20

      at SoloPointManager.log [as calculateSettlement] (src/lib/solo/solo-point-manager.ts:654:13)

    console.log
      üèÅ Solo First place settlement: 25 + 20 = 45

      at SoloPointManager.log [as calculateSettlement] (src/lib/solo/solo-point-manager.ts:655:13)

    console.log
      üèÅ Solo Final total check (should be 0): 0

      at SoloPointManager.log [as calculateSettlement] (src/lib/solo/solo-point-manager.ts:661:13)

    console.log
      üèÅ Solo Final results: [
        {
          position: 0,
          finalPoints: 35000,
          rank: 1,
          pointDiff: 5000,
          roundedDiff: 25,
          uma: 20,
          settlement: 45
        },
        {
          position: 1,
          finalPoints: 35000,
          rank: 2,
          pointDiff: 5000,
          roundedDiff: 5,
          uma: 10,
          settlement: 15
        },
        {
          position: 2,
          finalPoints: 15000,
          rank: 3,
          pointDiff: -15000,
          roundedDiff: -15,
          uma: -10,
          settlement: -25
        },
        {
          position: 3,
          finalPoints: 15000,
          rank: 4,
          pointDiff: -15000,
          roundedDiff: -15,
          uma: -20,
          settlement: -35
        }
      ]

      at SoloPointManager.log [as calculateSettlement] (src/lib/solo/solo-point-manager.ts:663:13)

    console.log
      üèÅ Solo calculateFinalResults called for soloGameId: test-solo-game-id

      at SoloPointManager.log [as calculateFinalResults] (src/lib/solo/solo-point-manager.ts:505:13)

    console.log
      üèÅ Solo Game and players: {
        game: {
          id: 'test-solo-game-id',
          gameType: undefined,
          initialPoints: 25000
        },
        players: 4
      }

      at SoloPointManager.log [as calculateFinalResults] (src/lib/solo/solo-point-manager.ts:514:13)

    console.log
      üèÅ Using settings: { initialPoints: 25000, basePoints: 30000, uma: [ 10, 5, -5, -10 ] }

      at SoloPointManager.log [as calculateFinalResults] (src/lib/solo/solo-point-manager.ts:555:13)

    console.log
      üèÅ Solo Starting settlement calculation with settings: { initialPoints: 25000, basePoints: 30000, uma: [ 10, 5, -5, -10 ] }

      at SoloPointManager.log (src/lib/solo/solo-point-manager.ts:572:13)

    console.log
      üèÅ Solo Sorted players: [
        { name: 'Player 1', points: 40000, position: 0 },
        { name: 'Player 2', points: 30000, position: 1 },
        { name: 'Player 3', points: 20000, position: 2 },
        { name: 'Player 4', points: 10000, position: 3 }
      ]

      at SoloPointManager.log (src/lib/solo/solo-point-manager.ts:589:13)

    console.log
      üèÅ Solo Results before adjustment: [
        {
          position: 0,
          finalPoints: 40000,
          rank: 1,
          pointDiff: 10000,
          roundedDiff: 10,
          uma: 10,
          settlement: 0
        },
        {
          position: 1,
          finalPoints: 30000,
          rank: 2,
          pointDiff: 0,
          roundedDiff: 0,
          uma: 5,
          settlement: 5
        },
        {
          position: 2,
          finalPoints: 20000,
          rank: 3,
          pointDiff: -10000,
          roundedDiff: -10,
          uma: -5,
          settlement: -15
        },
        {
          position: 3,
          finalPoints: 10000,
          rank: 4,
          pointDiff: -20000,
          roundedDiff: -20,
          uma: -10,
          settlement: -30
        }
      ]

      at SoloPointManager.log (src/lib/solo/solo-point-manager.ts:635:13)

    console.log
      üèÅ Solo Others rounded diff total: -30

      at SoloPointManager.log (src/lib/solo/solo-point-manager.ts:650:13)

    console.log
      üèÅ Solo First place rounded diff: 30 (= --30)

      at SoloPointManager.log (src/lib/solo/solo-point-manager.ts:651:13)

    console.log
      üèÅ Solo First place uma: 10

      at SoloPointManager.log (src/lib/solo/solo-point-manager.ts:654:13)

    console.log
      üèÅ Solo First place settlement: 30 + 10 = 40

      at SoloPointManager.log (src/lib/solo/solo-point-manager.ts:655:13)

    console.log
      üèÅ Solo Final total check (should be 0): 0

      at SoloPointManager.log (src/lib/solo/solo-point-manager.ts:661:13)

    console.log
      üèÅ Solo Final results: [
        {
          position: 0,
          finalPoints: 40000,
          rank: 1,
          pointDiff: 10000,
          roundedDiff: 30,
          uma: 10,
          settlement: 40
        },
        {
          position: 1,
          finalPoints: 30000,
          rank: 2,
          pointDiff: 0,
          roundedDiff: 0,
          uma: 5,
          settlement: 5
        },
        {
          position: 2,
          finalPoints: 20000,
          rank: 3,
          pointDiff: -10000,
          roundedDiff: -10,
          uma: -5,
          settlement: -15
        },
        {
          position: 3,
          finalPoints: 10000,
          rank: 4,
          pointDiff: -20000,
          roundedDiff: -20,
          uma: -10,
          settlement: -30
        }
      ]

      at SoloPointManager.log (src/lib/solo/solo-point-manager.ts:663:13)

    console.log
      üèÅ Solo Updating player 0: {
        position: 0,
        finalPoints: 40000,
        rank: 1,
        pointDiff: 10000,
        roundedDiff: 30,
        uma: 10,
        settlement: 40
      }

      at SoloPointManager.log [as saveFinalResults] (src/lib/solo/solo-point-manager.ts:679:17)

    console.log
      üèÅ Solo Updating player 1: {
        position: 1,
        finalPoints: 30000,
        rank: 2,
        pointDiff: 0,
        roundedDiff: 0,
        uma: 5,
        settlement: 5
      }

      at SoloPointManager.log [as saveFinalResults] (src/lib/solo/solo-point-manager.ts:679:17)

    console.log
      üèÅ Solo Updating player 2: {
        position: 2,
        finalPoints: 20000,
        rank: 3,
        pointDiff: -10000,
        roundedDiff: -10,
        uma: -5,
        settlement: -15
      }

      at SoloPointManager.log [as saveFinalResults] (src/lib/solo/solo-point-manager.ts:679:17)

    console.log
      üèÅ Solo Updating player 3: {
        position: 3,
        finalPoints: 10000,
        rank: 4,
        pointDiff: -20000,
        roundedDiff: -20,
        uma: -10,
        settlement: -30
      }

      at SoloPointManager.log [as saveFinalResults] (src/lib/solo/solo-point-manager.ts:679:17)

    console.log
      Player position 1, currentOya: 0, isThisPlayerOya: false, payment: 4000

      at SoloPointManager.log [as handleTsumoDistribution] (src/lib/solo/solo-point-manager.ts:175:17)

    console.log
      Player position 2, currentOya: 0, isThisPlayerOya: false, payment: 4000

      at SoloPointManager.log [as handleTsumoDistribution] (src/lib/solo/solo-point-manager.ts:175:17)

    console.log
      Player position 3, currentOya: 0, isThisPlayerOya: false, payment: 4000

      at SoloPointManager.log [as handleTsumoDistribution] (src/lib/solo/solo-point-manager.ts:175:17)

    console.log
      Ë¶™ÈÄ£Ëçò: Ë¶™=0Á∂ôÁ∂ö, Êú¨Â†¥=1 ‚Üí 2, Â±Ä=5

      at SoloPointManager.log [as rotateDealer] (src/lib/solo/solo-point-manager.ts:414:15)

    console.log
      Â≠êÂíå‰∫Ü: ÊóßË¶™=0 ‚Üí Êñ∞Ë¶™=1, ÊóßÂ±Ä=5 ‚Üí Êñ∞Â±Ä=6, Êú¨Â†¥„É™„Çª„ÉÉ„Éà

      at SoloPointManager.log [as rotateDealer] (src/lib/solo/solo-point-manager.ts:422:15)

    console.log
      üéØ Solo Game end check: gameType=HANCHAN, currentRound=4, currentOya=0

      at SoloPointManager.log [as checkRoundEnd] (src/lib/solo/solo-point-manager.ts:816:13)

    console.log
      üéØ Solo HANCHAN check: currentRound=4 > 8? false

      at SoloPointManager.log [as checkRoundEnd] (src/lib/solo/solo-point-manager.ts:836:15)

    console.log
      üéØ Solo Game continues: gameType=HANCHAN, round=4

      at SoloPointManager.log [as checkRoundEnd] (src/lib/solo/solo-point-manager.ts:852:13)

    console.log
      üèÅ Solo forceEndGame called with reason: „ÉÜ„Çπ„ÉàÂº∑Âà∂ÁµÇ‰∫Ü soloGameId: test-solo-game-id

      at SoloPointManager.log [as forceEndGame] (src/lib/solo/solo-point-manager.ts:862:13)

    console.log
      üèÅ Solo Game status updated to FINISHED in forceEndGame, calling calculateFinalResults

      at SoloPointManager.log [as forceEndGame] (src/lib/solo/solo-point-manager.ts:890:13)

    console.log
      üèÅ Solo calculateFinalResults completed in forceEndGame

      at SoloPointManager.log [as forceEndGame] (src/lib/solo/solo-point-manager.ts:897:13)

    console.log
      üèÅ Solo Starting settlement calculation with settings: {
        initialPoints: 25000,
        basePoints: 30000,
        uma: [ 15000, 5000, -5000, -15000 ]
      }

      at SoloPointManager.log [as calculateSettlement] (src/lib/solo/solo-point-manager.ts:572:13)

    console.log
      üèÅ Solo Sorted players: [
        { name: '„Éó„É¨„Ç§„É§„Éº1', points: 100000, position: 0 },
        { name: '„Éó„É¨„Ç§„É§„Éº1', points: 0, position: 1 },
        { name: '„Éó„É¨„Ç§„É§„Éº1', points: 0, position: 2 },
        { name: '„Éó„É¨„Ç§„É§„Éº1', points: 0, position: 3 }
      ]

      at SoloPointManager.log [as calculateSettlement] (src/lib/solo/solo-point-manager.ts:589:13)

    console.log
      üèÅ Solo Results before adjustment: [
        {
          position: 0,
          finalPoints: 100000,
          rank: 1,
          pointDiff: 70000,
          roundedDiff: 70,
          uma: 15000,
          settlement: 0
        },
        {
          position: 1,
          finalPoints: 0,
          rank: 2,
          pointDiff: -30000,
          roundedDiff: -30,
          uma: 5000,
          settlement: 4970
        },
        {
          position: 2,
          finalPoints: 0,
          rank: 3,
          pointDiff: -30000,
          roundedDiff: -30,
          uma: -5000,
          settlement: -5030
        },
        {
          position: 3,
          finalPoints: 0,
          rank: 4,
          pointDiff: -30000,
          roundedDiff: -30,
          uma: -15000,
          settlement: -15030
        }
      ]

      at SoloPointManager.log [as calculateSettlement] (src/lib/solo/solo-point-manager.ts:635:13)

    console.log
      üèÅ Solo Others rounded diff total: -90

      at SoloPointManager.log [as calculateSettlement] (src/lib/solo/solo-point-manager.ts:650:13)

    console.log
      üèÅ Solo First place rounded diff: 90 (= --90)

      at SoloPointManager.log [as calculateSettlement] (src/lib/solo/solo-point-manager.ts:651:13)

    console.log
      üèÅ Solo First place uma: 15000

      at SoloPointManager.log [as calculateSettlement] (src/lib/solo/solo-point-manager.ts:654:13)

    console.log
      üèÅ Solo First place settlement: 90 + 15000 = 15090

      at SoloPointManager.log [as calculateSettlement] (src/lib/solo/solo-point-manager.ts:655:13)

    console.log
      üèÅ Solo Final total check (should be 0): 0

      at SoloPointManager.log [as calculateSettlement] (src/lib/solo/solo-point-manager.ts:661:13)

    console.log
      üèÅ Solo Final results: [
        {
          position: 0,
          finalPoints: 100000,
          rank: 1,
          pointDiff: 70000,
          roundedDiff: 90,
          uma: 15000,
          settlement: 15090
        },
        {
          position: 1,
          finalPoints: 0,
          rank: 2,
          pointDiff: -30000,
          roundedDiff: -30,
          uma: 5000,
          settlement: 4970
        },
        {
          position: 2,
          finalPoints: 0,
          rank: 3,
          pointDiff: -30000,
          roundedDiff: -30,
          uma: -5000,
          settlement: -5030
        },
        {
          position: 3,
          finalPoints: 0,
          rank: 4,
          pointDiff: -30000,
          roundedDiff: -30,
          uma: -15000,
          settlement: -15030
        }
      ]

      at SoloPointManager.log [as calculateSettlement] (src/lib/solo/solo-point-manager.ts:663:13)

    console.log
      üèÅ Solo Starting settlement calculation with settings: {
        initialPoints: 25000,
        basePoints: 30000,
        uma: [ 15000, 5000, -5000, -15000 ]
      }

      at SoloPointManager.log [as calculateSettlement] (src/lib/solo/solo-point-manager.ts:572:13)

    console.log
      üèÅ Solo Sorted players: [
        { name: '„Éó„É¨„Ç§„É§„Éº1', points: 50000, position: 0 },
        { name: '„Éó„É¨„Ç§„É§„Éº1', points: 25000, position: 1 },
        { name: '„Éó„É¨„Ç§„É§„Éº1', points: 25000, position: 2 },
        { name: '„Éó„É¨„Ç§„É§„Éº1', points: -10000, position: 3 }
      ]

      at SoloPointManager.log [as calculateSettlement] (src/lib/solo/solo-point-manager.ts:589:13)

    console.log
      üèÅ Solo Results before adjustment: [
        {
          position: 0,
          finalPoints: 50000,
          rank: 1,
          pointDiff: 20000,
          roundedDiff: 20,
          uma: 15000,
          settlement: 0
        },
        {
          position: 1,
          finalPoints: 25000,
          rank: 2,
          pointDiff: -5000,
          roundedDiff: -5,
          uma: 5000,
          settlement: 4995
        },
        {
          position: 2,
          finalPoints: 25000,
          rank: 3,
          pointDiff: -5000,
          roundedDiff: -5,
          uma: -5000,
          settlement: -5005
        },
        {
          position: 3,
          finalPoints: -10000,
          rank: 4,
          pointDiff: -40000,
          roundedDiff: -40,
          uma: -15000,
          settlement: -15040
        }
      ]

      at SoloPointManager.log [as calculateSettlement] (src/lib/solo/solo-point-manager.ts:635:13)

    console.log
      üèÅ Solo Others rounded diff total: -50

      at SoloPointManager.log [as calculateSettlement] (src/lib/solo/solo-point-manager.ts:650:13)

    console.log
      üèÅ Solo First place rounded diff: 50 (= --50)

      at SoloPointManager.log [as calculateSettlement] (src/lib/solo/solo-point-manager.ts:651:13)

    console.log
      üèÅ Solo First place uma: 15000

      at SoloPointManager.log [as calculateSettlement] (src/lib/solo/solo-point-manager.ts:654:13)

    console.log
      üèÅ Solo First place settlement: 50 + 15000 = 15050

      at SoloPointManager.log [as calculateSettlement] (src/lib/solo/solo-point-manager.ts:655:13)

    console.log
      üèÅ Solo Final total check (should be 0): 0

      at SoloPointManager.log [as calculateSettlement] (src/lib/solo/solo-point-manager.ts:661:13)

    console.log
      üèÅ Solo Final results: [
        {
          position: 0,
          finalPoints: 50000,
          rank: 1,
          pointDiff: 20000,
          roundedDiff: 50,
          uma: 15000,
          settlement: 15050
        },
        {
          position: 1,
          finalPoints: 25000,
          rank: 2,
          pointDiff: -5000,
          roundedDiff: -5,
          uma: 5000,
          settlement: 4995
        },
        {
          position: 2,
          finalPoints: 25000,
          rank: 3,
          pointDiff: -5000,
          roundedDiff: -5,
          uma: -5000,
          settlement: -5005
        },
        {
          position: 3,
          finalPoints: -10000,
          rank: 4,
          pointDiff: -40000,
          roundedDiff: -40,
          uma: -15000,
          settlement: -15040
        }
      ]

      at SoloPointManager.log [as calculateSettlement] (src/lib/solo/solo-point-manager.ts:663:13)

PASS src/app/api/room/create/__tests__/route.test.ts
  ‚óè Console

    console.error
      Room creation failed: Error: DB connection failed
          at Object.<anonymous> (/Users/nyanpass/source/repos/mahjong-point-manager/src/app/api/room/create/__tests__/route.test.ts:532:9)
          at Promise.finally.completed (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/jestAdapterInit.js:1559:28)
          at new Promise (<anonymous>)
          at callAsyncCircusFn (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/jestAdapterInit.js:1499:10)
          at _callCircusTest (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/jestAdapterInit.js:1009:40)
          at processTicksAndRejections (node:internal/process/task_queues:105:5)
          at _runTest (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/jestAdapterInit.js:949:3)
          at _runTestsForDescribeBlock (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/jestAdapterInit.js:839:13)
          at _runTestsForDescribeBlock (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/jestAdapterInit.js:829:11)
          at _runTestsForDescribeBlock (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/jestAdapterInit.js:829:11)
          at run (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/jestAdapterInit.js:757:3)
          at runAndTransformResultsToJestFormat (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/jestAdapterInit.js:1920:21)
          at jestAdapter (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/runner.js:101:19)
          at runTestInternal (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-runner/build/testWorker.js:272:16)
          at runTest (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-runner/build/testWorker.js:340:7)
          at Object.worker (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-runner/build/testWorker.js:494:12)

      203 |     }
      204 |
    > 205 |     console.error("Room creation failed:", error)
          |             ^
      206 |     return NextResponse.json(
      207 |       {
      208 |         success: false,

      at error (src/app/api/room/create/route.ts:205:13)
      at Object.<anonymous> (src/app/api/room/create/__tests__/route.test.ts:544:24)

    console.error
      Room creation failed: Unknown error

      203 |     }
      204 |
    > 205 |     console.error("Room creation failed:", error)
          |             ^
      206 |     return NextResponse.json(
      207 |       {
      208 |         success: false,

      at error (src/app/api/room/create/route.ts:205:13)
      at Object.<anonymous> (src/app/api/room/create/__tests__/route.test.ts:565:24)

PASS src/app/api/solo/[gameId]/score/__tests__/route.test.ts
PASS src/app/api/__tests__/health-route.test.ts
  ‚óè Console

    console.error
      Health check failed: Error: db failure
          at Object.<anonymous> (/Users/nyanpass/source/repos/mahjong-point-manager/src/app/api/__tests__/health-route.test.ts:32:47)
          at Promise.finally.completed (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/jestAdapterInit.js:1559:28)
          at new Promise (<anonymous>)
          at callAsyncCircusFn (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/jestAdapterInit.js:1499:10)
          at _callCircusTest (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/jestAdapterInit.js:1009:40)
          at processTicksAndRejections (node:internal/process/task_queues:105:5)
          at _runTest (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/jestAdapterInit.js:949:3)
          at _runTestsForDescribeBlock (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/jestAdapterInit.js:839:13)
          at _runTestsForDescribeBlock (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/jestAdapterInit.js:829:11)
          at run (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/jestAdapterInit.js:757:3)
          at runAndTransformResultsToJestFormat (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/jestAdapterInit.js:1920:21)
          at jestAdapter (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/runner.js:101:19)
          at runTestInternal (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-runner/build/testWorker.js:272:16)
          at runTest (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-runner/build/testWorker.js:340:7)
          at Object.worker (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-runner/build/testWorker.js:494:12)

      18 |     })
      19 |   } catch (error) {
    > 20 |     console.error("Health check failed:", error)
         |             ^
      21 |
      22 |     return NextResponse.json(
      23 |       {

      at error (src/app/api/health/route.ts:20:13)
      at Object.<anonymous> (src/app/api/__tests__/health-route.test.ts:34:17)

PASS src/app/api/game/[gameId]/rematch/__tests__/route.test.ts
  ‚óè Console

    console.log
      üîÑ === REMATCH API START ===

      at log (src/app/api/game/[gameId]/rematch/route.ts:27:13)

    console.log
      üîÑ Environment: test

      at log (src/app/api/game/[gameId]/rematch/route.ts:28:13)

    console.log
      üîÑ GameId: g1

      at log (src/app/api/game/[gameId]/rematch/route.ts:29:13)

    console.log
      üîÑ Request body: { continueSession: true }

      at log (src/app/api/game/[gameId]/rematch/route.ts:30:13)

    console.log
      üîÑ Request headers: {}

      at log (src/app/api/game/[gameId]/rematch/route.ts:31:13)

    console.log
      üîÑ Fetching game data for gameId: g1

      at log (src/app/api/game/[gameId]/rematch/route.ts:36:13)

    console.error
      üîÑ === GAME NOT FOUND ERROR ===

      46 |
      47 |     if (!game) {
    > 48 |       console.error(`üîÑ === GAME NOT FOUND ERROR ===`)
         |               ^
      49 |       console.error(`üîÑ GameId searched: ${gameId}`)
      50 |       console.error(`üîÑ Type of gameId: ${typeof gameId}`)
      51 |       console.error(`üîÑ GameId length: ${gameId.length}`)

      at error (src/app/api/game/[gameId]/rematch/route.ts:48:15)
      at Object.<anonymous> (src/app/api/game/[gameId]/rematch/__tests__/route.test.ts:38:21)

    console.error
      üîÑ GameId searched: g1

      47 |     if (!game) {
      48 |       console.error(`üîÑ === GAME NOT FOUND ERROR ===`)
    > 49 |       console.error(`üîÑ GameId searched: ${gameId}`)
         |               ^
      50 |       console.error(`üîÑ Type of gameId: ${typeof gameId}`)
      51 |       console.error(`üîÑ GameId length: ${gameId.length}`)
      52 |       return NextResponse.json(

      at error (src/app/api/game/[gameId]/rematch/route.ts:49:15)
      at Object.<anonymous> (src/app/api/game/[gameId]/rematch/__tests__/route.test.ts:38:21)

    console.error
      üîÑ Type of gameId: string

      48 |       console.error(`üîÑ === GAME NOT FOUND ERROR ===`)
      49 |       console.error(`üîÑ GameId searched: ${gameId}`)
    > 50 |       console.error(`üîÑ Type of gameId: ${typeof gameId}`)
         |               ^
      51 |       console.error(`üîÑ GameId length: ${gameId.length}`)
      52 |       return NextResponse.json(
      53 |         { success: false, error: { message: "„Ç≤„Éº„É†„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì" } },

      at error (src/app/api/game/[gameId]/rematch/route.ts:50:15)
      at Object.<anonymous> (src/app/api/game/[gameId]/rematch/__tests__/route.test.ts:38:21)

    console.error
      üîÑ GameId length: 2

      49 |       console.error(`üîÑ GameId searched: ${gameId}`)
      50 |       console.error(`üîÑ Type of gameId: ${typeof gameId}`)
    > 51 |       console.error(`üîÑ GameId length: ${gameId.length}`)
         |               ^
      52 |       return NextResponse.json(
      53 |         { success: false, error: { message: "„Ç≤„Éº„É†„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì" } },
      54 |         { status: 404 }

      at error (src/app/api/game/[gameId]/rematch/route.ts:51:15)
      at Object.<anonymous> (src/app/api/game/[gameId]/rematch/__tests__/route.test.ts:38:21)

    console.log
      üîÑ === REMATCH API START ===

      at log (src/app/api/game/[gameId]/rematch/route.ts:27:13)

    console.log
      üîÑ Environment: test

      at log (src/app/api/game/[gameId]/rematch/route.ts:28:13)

    console.log
      üîÑ GameId: old

      at log (src/app/api/game/[gameId]/rematch/route.ts:29:13)

    console.log
      üîÑ Request body: { continueSession: true }

      at log (src/app/api/game/[gameId]/rematch/route.ts:30:13)

    console.log
      üîÑ Request headers: {}

      at log (src/app/api/game/[gameId]/rematch/route.ts:31:13)

    console.log
      üîÑ Fetching game data for gameId: old

      at log (src/app/api/game/[gameId]/rematch/route.ts:36:13)

    console.log
      üîÑ Found game: old, session: sess, participants: 0

      at log (src/app/api/game/[gameId]/rematch/route.ts:58:13)

    console.log
      üîÑ Continuing existing session: sess

      at log (src/app/api/game/[gameId]/rematch/route.ts:68:15)

    console.log
      üîÑ Continuing session with NEW roomCode: DQP89F, sessionOrder: 2, existing games in session: 1

      at log (src/app/api/game/[gameId]/rematch/route.ts:86:15)

    console.log
      üîÑ === CREATING NEW GAME ===

      at log (src/app/api/game/[gameId]/rematch/route.ts:138:13)

    console.log
      üîÑ RoomCode: DQP89F

      at log (src/app/api/game/[gameId]/rematch/route.ts:139:13)

    console.log
      üîÑ SessionId: sess

      at log (src/app/api/game/[gameId]/rematch/route.ts:140:13)

    console.log
      üîÑ SessionOrder: 2

      at log (src/app/api/game/[gameId]/rematch/route.ts:141:13)

    console.log
      üîÑ HostPlayerId: h

      at log (src/app/api/game/[gameId]/rematch/route.ts:142:13)

    console.log
      üîÑ SettingsId: s

      at log (src/app/api/game/[gameId]/rematch/route.ts:143:13)

    console.log
      üîÑ Creating game with data: {
        roomCode: 'DQP89F',
        hostPlayerId: 'h',
        settingsId: 's',
        sessionId: 'sess',
        sessionOrder: 2,
        status: 'WAITING',
        currentRound: 1,
        currentOya: 0,
        honba: 0,
        kyotaku: 0
      }

      at log (src/app/api/game/[gameId]/rematch/route.ts:152:13)

    console.log
      üîÑ === NEW GAME CREATED ===

      at log (src/app/api/game/[gameId]/rematch/route.ts:180:13)

    console.log
      üîÑ New Game ID: new

      at log (src/app/api/game/[gameId]/rematch/route.ts:181:13)

    console.log
      üîÑ New Game RoomCode: NEW

      at log (src/app/api/game/[gameId]/rematch/route.ts:182:13)

    console.log
      üîÑ === CREATING PARTICIPANTS ===

      at log (src/app/api/game/[gameId]/rematch/route.ts:185:13)

    console.log
      üîÑ Participants to create: 0

      at log (src/app/api/game/[gameId]/rematch/route.ts:186:13)

    console.log
      üîÑ Initial points: 25000

      at log (src/app/api/game/[gameId]/rematch/route.ts:187:13)

    console.log
      üîÑ === PARTICIPANTS CREATED ===

      at log (src/app/api/game/[gameId]/rematch/route.ts:206:13)

    console.log
      üîÑ Successfully created 0 participants for new game

      at log (src/app/api/game/[gameId]/rematch/route.ts:207:13)

    console.log
      üîÑ Participant IDs:

      at log (src/app/api/game/[gameId]/rematch/route.ts:210:13)

PASS src/app/api/game/[gameId]/start/__tests__/route.test.ts
  ‚óè Console

    console.log
      Game start request: { gameId: 'g1', body: { hostPlayerId: 'host' } }

      at log (src/app/api/game/[gameId]/start/route.ts:19:13)

    console.log
      Found game: { id: 'g1', status: 'WAITING', participantsCount: 4 }

      at log (src/app/api/game/[gameId]/start/route.ts:32:13)

    console.log
      Game start request: { gameId: 'x', body: { hostPlayerId: 'x' } }

      at log (src/app/api/game/[gameId]/start/route.ts:19:13)

    console.log
      Found game: null

      at log (src/app/api/game/[gameId]/start/route.ts:32:13)

PASS src/schemas/__tests__/solo.test.ts
PASS src/schemas/__tests__/index.test.ts
PASS src/__tests__/api/sessions-auth.test.ts
  ‚óè Console

    console.error
      Session access check failed: Error: Database error
          at Object.<anonymous> (/Users/nyanpass/source/repos/mahjong-point-manager/src/__tests__/api/sessions-auth.test.ts:62:9)
          at Promise.finally.completed (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/jestAdapterInit.js:1559:28)
          at new Promise (<anonymous>)
          at callAsyncCircusFn (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/jestAdapterInit.js:1499:10)
          at _callCircusTest (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/jestAdapterInit.js:1009:40)
          at processTicksAndRejections (node:internal/process/task_queues:105:5)
          at _runTest (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/jestAdapterInit.js:949:3)
          at _runTestsForDescribeBlock (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/jestAdapterInit.js:839:13)
          at _runTestsForDescribeBlock (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/jestAdapterInit.js:829:11)
          at _runTestsForDescribeBlock (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/jestAdapterInit.js:829:11)
          at run (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/jestAdapterInit.js:757:3)
          at runAndTransformResultsToJestFormat (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/jestAdapterInit.js:1920:21)
          at jestAdapter (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/runner.js:101:19)
          at runTestInternal (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-runner/build/testWorker.js:272:16)
          at runTest (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-runner/build/testWorker.js:340:7)
          at Object.worker (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-runner/build/testWorker.js:494:12)

       98 |     return !!participant
       99 |   } catch (error) {
    > 100 |     console.error("Session access check failed:", error)
          |             ^
      101 |     return false
      102 |   }
      103 | }

      at error (src/lib/auth.ts:100:13)
      at Object.<anonymous> (src/__tests__/api/sessions-auth.test.ts:65:22)

PASS src/components/__tests__/AlertModal.test.tsx
PASS src/app/api/auth/logout/__tests__/route.test.ts
  ‚óè Console

    console.error
      Logout failed: Error: fail
          at /Users/nyanpass/source/repos/mahjong-point-manager/src/app/api/auth/logout/__tests__/route.test.ts:41:13
          at /Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-mock/build/index.js:305:39
          at /Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-mock/build/index.js:312:13
          at mockConstructor (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-mock/build/index.js:102:19)
          at POST (/Users/nyanpass/source/repos/mahjong-point-manager/src/app/api/auth/logout/route.ts:6:38)
          at Object.<anonymous> (/Users/nyanpass/source/repos/mahjong-point-manager/src/app/api/auth/logout/__tests__/route.test.ts:44:27)
          at Promise.finally.completed (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/jestAdapterInit.js:1559:28)
          at new Promise (<anonymous>)
          at callAsyncCircusFn (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/jestAdapterInit.js:1499:10)
          at _callCircusTest (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/jestAdapterInit.js:1009:40)
          at processTicksAndRejections (node:internal/process/task_queues:105:5)
          at _runTest (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/jestAdapterInit.js:949:3)
          at _runTestsForDescribeBlock (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/jestAdapterInit.js:839:13)
          at _runTestsForDescribeBlock (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/jestAdapterInit.js:829:11)
          at run (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/jestAdapterInit.js:757:3)
          at runAndTransformResultsToJestFormat (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/jestAdapterInit.js:1920:21)
          at jestAdapter (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/runner.js:101:19)
          at runTestInternal (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-runner/build/testWorker.js:272:16)
          at runTest (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-runner/build/testWorker.js:340:7)
          at Object.worker (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-runner/build/testWorker.js:494:12)

      25 |     })
      26 |   } catch (error) {
    > 27 |     console.error("Logout failed:", error)
         |             ^
      28 |     return NextResponse.json(
      29 |       {
      30 |         success: false,

      at error (src/app/api/auth/logout/route.ts:27:13)
      at Object.<anonymous> (src/app/api/auth/logout/__tests__/route.test.ts:44:27)

PASS src/__tests__/api/sessions-detail-privacy.test.ts
PASS src/app/api/solo/[gameId]/force-end/__tests__/route.test.ts
PASS src/app/api/solo/[gameId]/reach/__tests__/route.test.ts
  ‚óè Console

    console.error
      Unexpected error: Error: „Ç≤„Éº„É†„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì
          at /Users/nyanpass/source/repos/mahjong-point-manager/src/app/api/solo/[gameId]/reach/route.ts:41:13
          at processTicksAndRejections (node:internal/process/task_queues:105:5)
          at /Users/nyanpass/source/repos/mahjong-point-manager/src/lib/error-handler.ts:196:14
          at Object.<anonymous> (/Users/nyanpass/source/repos/mahjong-point-manager/src/app/api/solo/[gameId]/reach/__tests__/route.test.ts:46:21)

      137 |     statusCode = 400
      138 |   } else if (error instanceof Error) {
    > 139 |     console.error("Unexpected error:", error)
          |             ^
      140 |     apiError = {
      141 |       code: "INTERNAL_ERROR",
      142 |       message: defaultMessage,

      at error (src/lib/error-handler.ts:139:13)
      at createErrorResponse (src/lib/error-handler.ts:198:14)
      at Object.<anonymous> (src/app/api/solo/[gameId]/reach/__tests__/route.test.ts:46:21)

PASS src/lib/__tests__/prisma.test.ts
PASS src/app/api/__tests__/game-end-auth.test.ts
  ‚óè Console

    console.log
      üèÅ API: Starting force end game for gameId: test-game-id reason: „Éõ„Çπ„Éà„Å´„Çà„ÇãÂº∑Âà∂ÁµÇ‰∫Ü

      at log (src/app/api/game/[gameId]/end/route.ts:61:13)

    console.log
      üèÅ API: Force end game completed

      at log (src/app/api/game/[gameId]/end/route.ts:71:13)

    console.log
      üîå API: Found WebSocket instance in process

      at log (src/app/api/game/[gameId]/end/route.ts:23:13)

    console.log
      Game force ended: „Éõ„Çπ„Éà„Å´„Çà„ÇãÂº∑Âà∂ÁµÇ‰∫Ü

      at log (src/app/api/game/[gameId]/end/route.ts:80:15)

    console.log
      üèÅ API: Starting force end game for gameId: test-game-id reason: Âº∑Âà∂ÁµÇ‰∫Ü

      at log (src/app/api/game/[gameId]/end/route.ts:61:13)

    console.log
      üèÅ API: Force end game completed

      at log (src/app/api/game/[gameId]/end/route.ts:71:13)

    console.log
      üîå API: Found WebSocket instance in process

      at log (src/app/api/game/[gameId]/end/route.ts:23:13)

    console.log
      Game force ended: Âº∑Âà∂ÁµÇ‰∫Ü

      at log (src/app/api/game/[gameId]/end/route.ts:80:15)

    console.log
      üèÅ API: Starting force end game for gameId: test-game-id reason: „ÉÜ„Çπ„ÉàÁµÇ‰∫Ü

      at log (src/app/api/game/[gameId]/end/route.ts:61:13)

    console.log
      üèÅ API: Force end game completed

      at log (src/app/api/game/[gameId]/end/route.ts:71:13)

    console.log
      üîå API: Found WebSocket instance in process

      at log (src/app/api/game/[gameId]/end/route.ts:23:13)

    console.log
      Game force ended: „ÉÜ„Çπ„ÉàÁµÇ‰∫Ü

      at log (src/app/api/game/[gameId]/end/route.ts:80:15)

PASS src/lib/__tests__/socket.test.ts
PASS src/app/api/__tests__/websocket-status-route.test.ts
PASS src/lib/__tests__/error-handler.test.ts
  ‚óè Console

    console.error
      Unexpected error: Error: oops
          at Object.<anonymous> (/Users/nyanpass/source/repos/mahjong-point-manager/src/lib/__tests__/error-handler.test.ts:28:60)
          at Promise.finally.completed (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/jestAdapterInit.js:1559:28)
          at new Promise (<anonymous>)
          at callAsyncCircusFn (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/jestAdapterInit.js:1499:10)
          at _callCircusTest (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/jestAdapterInit.js:1009:40)
          at processTicksAndRejections (node:internal/process/task_queues:105:5)
          at _runTest (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/jestAdapterInit.js:949:3)
          at _runTestsForDescribeBlock (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/jestAdapterInit.js:839:13)
          at _runTestsForDescribeBlock (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/jestAdapterInit.js:829:11)
          at run (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/jestAdapterInit.js:757:3)
          at runAndTransformResultsToJestFormat (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/jestAdapterInit.js:1920:21)
          at jestAdapter (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/runner.js:101:19)
          at runTestInternal (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-runner/build/testWorker.js:272:16)
          at runTest (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-runner/build/testWorker.js:340:7)
          at Object.worker (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-runner/build/testWorker.js:494:12)

      137 |     statusCode = 400
      138 |   } else if (error instanceof Error) {
    > 139 |     console.error("Unexpected error:", error)
          |             ^
      140 |     apiError = {
      141 |       code: "INTERNAL_ERROR",
      142 |       message: defaultMessage,

      at error (src/lib/error-handler.ts:139:13)
      at Object.<anonymous> (src/lib/__tests__/error-handler.test.ts:28:59)

    console.error
      Unexpected error: Error: boom
          at /Users/nyanpass/source/repos/mahjong-point-manager/src/lib/__tests__/error-handler.test.ts:62:19
          at fn (/Users/nyanpass/source/repos/mahjong-point-manager/src/lib/error-handler.ts:196:20)
          at Object.<anonymous> (/Users/nyanpass/source/repos/mahjong-point-manager/src/lib/__tests__/error-handler.test.ts:64:30)
          at processTicksAndRejections (node:internal/process/task_queues:105:5)

      137 |     statusCode = 400
      138 |   } else if (error instanceof Error) {
    > 139 |     console.error("Unexpected error:", error)
          |             ^
      140 |     apiError = {
      141 |       code: "INTERNAL_ERROR",
      142 |       message: defaultMessage,

      at error (src/lib/error-handler.ts:139:13)
      at createErrorResponse (src/lib/error-handler.ts:198:14)
      at Object.<anonymous> (src/lib/__tests__/error-handler.test.ts:64:24)

PASS src/schemas/__tests__/common-utils.test.ts
PASS src/lib/__tests__/rematch-service.test.ts
  ‚óè Console

    console.log
      üîÑ === REMATCH SERVICE START ===

      at log (src/lib/rematch-service.ts:47:13)

    console.log
      üîÑ Environment: test

      at log (src/lib/rematch-service.ts:48:13)

    console.log
      üîÑ GameId: missing

      at log (src/lib/rematch-service.ts:49:13)

    console.log
      üîÑ Request data: { continueSession: true }

      at log (src/lib/rematch-service.ts:50:13)

    console.log
      üîÑ Fetching game data for gameId: missing

      at log (src/lib/rematch-service.ts:52:13)

    console.error
      üîÑ === GAME NOT FOUND ERROR ===

      62 |
      63 |     if (!game) {
    > 64 |       console.error(`üîÑ === GAME NOT FOUND ERROR ===`)
         |               ^
      65 |       console.error(`üîÑ GameId searched: ${gameId}`)
      66 |       console.error(`üîÑ Type of gameId: ${typeof gameId}`)
      67 |       console.error(`üîÑ GameId length: ${gameId.length}`)

      at error (src/lib/rematch-service.ts:64:15)
      at Object.<anonymous> (src/lib/__tests__/rematch-service.test.ts:35:20)

    console.error
      üîÑ GameId searched: missing

      63 |     if (!game) {
      64 |       console.error(`üîÑ === GAME NOT FOUND ERROR ===`)
    > 65 |       console.error(`üîÑ GameId searched: ${gameId}`)
         |               ^
      66 |       console.error(`üîÑ Type of gameId: ${typeof gameId}`)
      67 |       console.error(`üîÑ GameId length: ${gameId.length}`)
      68 |       return {

      at error (src/lib/rematch-service.ts:65:15)
      at Object.<anonymous> (src/lib/__tests__/rematch-service.test.ts:35:20)

    console.error
      üîÑ Type of gameId: string

      64 |       console.error(`üîÑ === GAME NOT FOUND ERROR ===`)
      65 |       console.error(`üîÑ GameId searched: ${gameId}`)
    > 66 |       console.error(`üîÑ Type of gameId: ${typeof gameId}`)
         |               ^
      67 |       console.error(`üîÑ GameId length: ${gameId.length}`)
      68 |       return {
      69 |         success: false,

      at error (src/lib/rematch-service.ts:66:15)
      at Object.<anonymous> (src/lib/__tests__/rematch-service.test.ts:35:20)

    console.error
      üîÑ GameId length: 7

      65 |       console.error(`üîÑ GameId searched: ${gameId}`)
      66 |       console.error(`üîÑ Type of gameId: ${typeof gameId}`)
    > 67 |       console.error(`üîÑ GameId length: ${gameId.length}`)
         |               ^
      68 |       return {
      69 |         success: false,
      70 |         error: {

      at error (src/lib/rematch-service.ts:67:15)
      at Object.<anonymous> (src/lib/__tests__/rematch-service.test.ts:35:20)

    console.log
      üîÑ === REMATCH SERVICE START ===

      at log (src/lib/rematch-service.ts:47:13)

    console.log
      üîÑ Environment: test

      at log (src/lib/rematch-service.ts:48:13)

    console.log
      üîÑ GameId: game1

      at log (src/lib/rematch-service.ts:49:13)

    console.log
      üîÑ Request data: { continueSession: false }

      at log (src/lib/rematch-service.ts:50:13)

    console.log
      üîÑ Fetching game data for gameId: game1

      at log (src/lib/rematch-service.ts:52:13)

    console.log
      üîÑ Found game: game1, session: undefined, participants: 0

      at log (src/lib/rematch-service.ts:77:13)

    console.log
      üîÑ === CREATING NEW GAME ===

      at log (src/lib/rematch-service.ts:157:13)

    console.log
      üîÑ RoomCode: BUM4E4

      at log (src/lib/rematch-service.ts:158:13)

    console.log
      üîÑ SessionId: s1

      at log (src/lib/rematch-service.ts:159:13)

    console.log
      üîÑ SessionOrder: 1

      at log (src/lib/rematch-service.ts:160:13)

    console.log
      üîÑ HostPlayerId: host

      at log (src/lib/rematch-service.ts:161:13)

    console.log
      üîÑ SettingsId: null

      at log (src/lib/rematch-service.ts:162:13)

    console.error
      üîÑ === SETTINGS NOT FOUND ERROR ===

      163 |
      164 |     if (!game.settingsId) {
    > 165 |       console.error(`üîÑ === SETTINGS NOT FOUND ERROR ===`)
          |               ^
      166 |       console.error(`üîÑ Game.settingsId: ${game.settingsId}`)
      167 |       console.error(`üîÑ Game settings:`, game.settings)
      168 |       throw new Error("„Ç≤„Éº„É†Ë®≠ÂÆö„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì")

      at error (src/lib/rematch-service.ts:165:15)
      at Object.<anonymous> (src/lib/__tests__/rematch-service.test.ts:60:20)

    console.error
      üîÑ Game.settingsId: null

      164 |     if (!game.settingsId) {
      165 |       console.error(`üîÑ === SETTINGS NOT FOUND ERROR ===`)
    > 166 |       console.error(`üîÑ Game.settingsId: ${game.settingsId}`)
          |               ^
      167 |       console.error(`üîÑ Game settings:`, game.settings)
      168 |       throw new Error("„Ç≤„Éº„É†Ë®≠ÂÆö„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì")
      169 |     }

      at error (src/lib/rematch-service.ts:166:15)
      at Object.<anonymous> (src/lib/__tests__/rematch-service.test.ts:60:20)

    console.error
      üîÑ Game settings: null

      165 |       console.error(`üîÑ === SETTINGS NOT FOUND ERROR ===`)
      166 |       console.error(`üîÑ Game.settingsId: ${game.settingsId}`)
    > 167 |       console.error(`üîÑ Game settings:`, game.settings)
          |               ^
      168 |       throw new Error("„Ç≤„Éº„É†Ë®≠ÂÆö„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì")
      169 |     }
      170 |

      at error (src/lib/rematch-service.ts:167:15)
      at Object.<anonymous> (src/lib/__tests__/rematch-service.test.ts:60:20)

    console.error
      üîÑ === REMATCH SERVICE FAILED ===

      242 |     }
      243 |   } catch (err) {
    > 244 |     console.error(`üîÑ === REMATCH SERVICE FAILED ===`)
          |             ^
      245 |     console.error(
      246 |       `üîÑ Error type: ${err instanceof Error ? err.constructor.name : typeof err}`
      247 |     )

      at error (src/lib/rematch-service.ts:244:13)
      at Object.<anonymous> (src/lib/__tests__/rematch-service.test.ts:60:20)

    console.error
      üîÑ Error type: Error

      243 |   } catch (err) {
      244 |     console.error(`üîÑ === REMATCH SERVICE FAILED ===`)
    > 245 |     console.error(
          |             ^
      246 |       `üîÑ Error type: ${err instanceof Error ? err.constructor.name : typeof err}`
      247 |     )
      248 |     console.error(

      at error (src/lib/rematch-service.ts:245:13)
      at Object.<anonymous> (src/lib/__tests__/rematch-service.test.ts:60:20)

    console.error
      üîÑ Error message: „Ç≤„Éº„É†Ë®≠ÂÆö„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì

      246 |       `üîÑ Error type: ${err instanceof Error ? err.constructor.name : typeof err}`
      247 |     )
    > 248 |     console.error(
          |             ^
      249 |       `üîÑ Error message: ${err instanceof Error ? err.message : String(err)}`
      250 |     )
      251 |     console.error(`üîÑ Full error:`, err)

      at error (src/lib/rematch-service.ts:248:13)
      at Object.<anonymous> (src/lib/__tests__/rematch-service.test.ts:60:20)

    console.error
      üîÑ Full error: Error: „Ç≤„Éº„É†Ë®≠ÂÆö„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì
          at createRematch (/Users/nyanpass/source/repos/mahjong-point-manager/src/lib/rematch-service.ts:168:13)
          at processTicksAndRejections (node:internal/process/task_queues:105:5)
          at Object.<anonymous> (/Users/nyanpass/source/repos/mahjong-point-manager/src/lib/__tests__/rematch-service.test.ts:60:20)

      249 |       `üîÑ Error message: ${err instanceof Error ? err.message : String(err)}`
      250 |     )
    > 251 |     console.error(`üîÑ Full error:`, err)
          |             ^
      252 |
      253 |     if (err instanceof Error) {
      254 |       console.error(`üîÑ Error stack:`)

      at error (src/lib/rematch-service.ts:251:13)
      at Object.<anonymous> (src/lib/__tests__/rematch-service.test.ts:60:20)

    console.error
      üîÑ Error stack:

      252 |
      253 |     if (err instanceof Error) {
    > 254 |       console.error(`üîÑ Error stack:`)
          |               ^
      255 |       console.error(err.stack)
      256 |     }
      257 |

      at error (src/lib/rematch-service.ts:254:15)
      at Object.<anonymous> (src/lib/__tests__/rematch-service.test.ts:60:20)

    console.error
      Error: „Ç≤„Éº„É†Ë®≠ÂÆö„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì
          at createRematch (/Users/nyanpass/source/repos/mahjong-point-manager/src/lib/rematch-service.ts:168:13)
          at processTicksAndRejections (node:internal/process/task_queues:105:5)
          at Object.<anonymous> (/Users/nyanpass/source/repos/mahjong-point-manager/src/lib/__tests__/rematch-service.test.ts:60:20)

      253 |     if (err instanceof Error) {
      254 |       console.error(`üîÑ Error stack:`)
    > 255 |       console.error(err.stack)
          |               ^
      256 |     }
      257 |
      258 |     let errorMessage = "ÂÜçÊà¶‰ΩúÊàê„Å´Â§±Êïó„Åó„Åæ„Åó„Åü"

      at error (src/lib/rematch-service.ts:255:15)
      at Object.<anonymous> (src/lib/__tests__/rematch-service.test.ts:60:20)

    console.error
      üîÑ Settings error detected

      261 |       if (err.message.includes("„Ç≤„Éº„É†Ë®≠ÂÆö„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì")) {
      262 |         errorMessage = "„Ç≤„Éº„É†Ë®≠ÂÆö„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì"
    > 263 |         console.error(`üîÑ Settings error detected`)
          |                 ^
      264 |       } else if (err.message.includes("„É´„Éº„É†„Ç≥„Éº„ÉâÁîüÊàê„Å´Â§±Êïó")) {
      265 |         errorMessage = "„É´„Éº„É†„Ç≥„Éº„ÉâÁîüÊàê„Å´Â§±Êïó„Åó„Åæ„Åó„Åü"
      266 |         console.error(`üîÑ Room code generation error detected`)

      at error (src/lib/rematch-service.ts:263:17)
      at Object.<anonymous> (src/lib/__tests__/rematch-service.test.ts:60:20)

    console.error
      üîÑ Final error response: message="„Ç≤„Éº„É†Ë®≠ÂÆö„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì"

      283 |     }
      284 |
    > 285 |     console.error(`üîÑ Final error response: message="${errorMessage}"`)
          |             ^
      286 |
      287 |     return {
      288 |       success: false,

      at error (src/lib/rematch-service.ts:285:13)
      at Object.<anonymous> (src/lib/__tests__/rematch-service.test.ts:60:20)

    console.log
      üîÑ === REMATCH SERVICE START ===

      at log (src/lib/rematch-service.ts:47:13)

    console.log
      üîÑ Environment: test

      at log (src/lib/rematch-service.ts:48:13)

    console.log
      üîÑ GameId: game1

      at log (src/lib/rematch-service.ts:49:13)

    console.log
      üîÑ Request data: { continueSession: false }

      at log (src/lib/rematch-service.ts:50:13)

    console.log
      üîÑ Fetching game data for gameId: game1

      at log (src/lib/rematch-service.ts:52:13)

    console.log
      üîÑ Found game: game1, session: undefined, participants: 2

      at log (src/lib/rematch-service.ts:77:13)

    console.log
      üîÑ === CREATING NEW GAME ===

      at log (src/lib/rematch-service.ts:157:13)

    console.log
      üîÑ RoomCode: WDAVO1

      at log (src/lib/rematch-service.ts:158:13)

    console.log
      üîÑ SessionId: s1

      at log (src/lib/rematch-service.ts:159:13)

    console.log
      üîÑ SessionOrder: 1

      at log (src/lib/rematch-service.ts:160:13)

    console.log
      üîÑ HostPlayerId: host

      at log (src/lib/rematch-service.ts:161:13)

    console.log
      üîÑ SettingsId: settings1

      at log (src/lib/rematch-service.ts:162:13)

    console.log
      üîÑ Creating game with data: {
        roomCode: 'WDAVO1',
        hostPlayerId: 'host',
        settingsId: 'settings1',
        sessionId: 's1',
        sessionOrder: 1,
        status: 'WAITING',
        currentRound: 1,
        currentOya: 0,
        honba: 0,
        kyotaku: 0
      }

      at log (src/lib/rematch-service.ts:171:13)

    console.log
      üîÑ === NEW GAME CREATED ===

      at log (src/lib/rematch-service.ts:199:13)

    console.log
      üîÑ New Game ID: g2

      at log (src/lib/rematch-service.ts:200:13)

    console.log
      üîÑ New Game RoomCode: ROOM

      at log (src/lib/rematch-service.ts:201:13)

    console.log
      üîÑ === CREATING PARTICIPANTS ===

      at log (src/lib/rematch-service.ts:204:13)

    console.log
      üîÑ Participants to create: 2

      at log (src/lib/rematch-service.ts:205:13)

    console.log
      üîÑ Initial points: 25000

      at log (src/lib/rematch-service.ts:206:13)

    console.log
      üîÑ Creating participant 1: p1 at position 0

      at log (src/lib/rematch-service.ts:210:17)
          at Array.map (<anonymous>)

    console.log
      üîÑ Creating participant 2: p2 at position 1

      at log (src/lib/rematch-service.ts:210:17)
          at Array.map (<anonymous>)

    console.log
      üîÑ === PARTICIPANTS CREATED ===

      at log (src/lib/rematch-service.ts:225:13)

    console.log
      üîÑ Successfully created 2 participants for new game

      at log (src/lib/rematch-service.ts:226:13)

    console.log
      üîÑ Participant IDs: gp, gp

      at log (src/lib/rematch-service.ts:229:13)

    console.log
      üîÑ === REMATCH SERVICE SUCCESS ===

      at log (src/lib/rematch-service.ts:233:13)

PASS src/__tests__/api/sessionActiveGame.test.ts
PASS src/app/api/score/patterns/__tests__/route.test.ts
  ‚óè Console

    console.error
      Failed to fetch score patterns: Error: db
          at Object.<anonymous> (/Users/nyanpass/source/repos/mahjong-point-manager/src/app/api/score/patterns/__tests__/route.test.ts:32:56)
          at Promise.finally.completed (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/jestAdapterInit.js:1559:28)
          at new Promise (<anonymous>)
          at callAsyncCircusFn (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/jestAdapterInit.js:1499:10)
          at _callCircusTest (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/jestAdapterInit.js:1009:40)
          at processTicksAndRejections (node:internal/process/task_queues:105:5)
          at _runTest (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/jestAdapterInit.js:949:3)
          at _runTestsForDescribeBlock (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/jestAdapterInit.js:839:13)
          at _runTestsForDescribeBlock (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/jestAdapterInit.js:829:11)
          at run (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/jestAdapterInit.js:757:3)
          at runAndTransformResultsToJestFormat (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/jestAdapterInit.js:1920:21)
          at jestAdapter (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/runner.js:101:19)
          at runTestInternal (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-runner/build/testWorker.js:272:16)
          at runTest (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-runner/build/testWorker.js:340:7)
          at Object.worker (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-runner/build/testWorker.js:494:12)

      13 |     })
      14 |   } catch (error) {
    > 15 |     console.error("Failed to fetch score patterns:", error)
         |             ^
      16 |     return NextResponse.json(
      17 |       {
      18 |         success: false,

      at error (src/app/api/score/patterns/route.ts:15:13)
      at Object.<anonymous> (src/app/api/score/patterns/__tests__/route.test.ts:33:17)

PASS src/__tests__/api/room-join-session-participant.test.ts
PASS src/schemas/__tests__/solo-uma.test.ts
PASS src/lib/__tests__/auth-fallback.test.ts
  ‚óè Console

    console.log
      üì± Session saved to localStorage (fallback) {
        playerId: 'p1',
        sessionToken: 't1',
        expiresAt: 1751501541421,
        timestamp: 1751501531421
      }

      at Function.log [as setSession] (src/lib/auth-fallback.ts:50:15)

    console.log
      üì± Session saved to localStorage (fallback) {
        playerId: 'p1',
        sessionToken: 't1',
        expiresAt: 1751501530422,
        timestamp: 1751501531422
      }

      at Function.log [as setSession] (src/lib/auth-fallback.ts:50:15)

    console.log
      üì± Session cleared from localStorage

      at Function.log [as clearSession] (src/lib/auth-fallback.ts:81:15)

    console.log
      üì± Session saved to localStorage (fallback) {
        playerId: 'p1',
        sessionToken: 't1',
        expiresAt: 1751501541423,
        timestamp: 1751501531423
      }

      at Function.log [as setSession] (src/lib/auth-fallback.ts:50:15)

    console.log
      üì± Session cleared from localStorage

      at Function.log [as clearSession] (src/lib/auth-fallback.ts:81:15)

    console.log
      üì± Session saved to localStorage (fallback) {
        playerId: 'p1',
        sessionToken: 't1',
        expiresAt: 1751501541423,
        timestamp: 1751501531423
      }

      at Function.log [as setSession] (src/lib/auth-fallback.ts:50:15)

    console.log
      üì± Session cleared from localStorage

      at Function.log [as clearSession] (src/lib/auth-fallback.ts:81:15)

    console.log
      üì± Session saved to localStorage (fallback) {
        playerId: 'p1',
        sessionToken: 't1',
        expiresAt: 1751501541423,
        timestamp: 1751501531423
      }

      at Function.log [as setSession] (src/lib/auth-fallback.ts:50:15)

    console.log
      üì± Session cleared from localStorage

      at Function.log [as clearSession] (src/lib/auth-fallback.ts:81:15)

    console.log
      üì± Session saved to localStorage (fallback) {
        playerId: 'p1',
        sessionToken: 't1',
        expiresAt: 1751501541424,
        timestamp: 1751501531424
      }

      at Function.log [as setSession] (src/lib/auth-fallback.ts:50:15)

    console.log
      üì± Using header-based auth for {
        browserInfo: {
          isSafari: true,
          isMobile: false,
          isIOS: false,
          cookieSupported: false
        },
        headers: { Foo: 'bar', 'X-Session-Token': 't1', 'X-Player-Id': 'p1' }
      }

      at log (src/lib/auth-fallback.ts:124:13)

PASS src/lib/__tests__/auth.test.ts
PASS src/lib/__tests__/storage-utils.test.ts
  ‚óè Console

    console.error
      Failed to save to localStorage (foo): Error [QuotaExceededError]: full
          at Proxy.<anonymous> (/Users/nyanpass/source/repos/mahjong-point-manager/src/lib/__tests__/storage-utils.test.ts:25:21)
          at /Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-mock/build/index.js:305:39
          at Proxy.<anonymous> (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-mock/build/index.js:312:13)
          at Proxy.mockConstructor (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-mock/build/index.js:102:19)
          at setItem (/Users/nyanpass/source/repos/mahjong-point-manager/src/lib/storage-utils.ts:55:18)
          at Object.<anonymous> (/Users/nyanpass/source/repos/mahjong-point-manager/src/lib/__tests__/storage-utils.test.ts:31:35)
          at Promise.finally.completed (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/jestAdapterInit.js:1559:28)
          at new Promise (<anonymous>)
          at callAsyncCircusFn (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/jestAdapterInit.js:1499:10)
          at _callCircusTest (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/jestAdapterInit.js:1009:40)
          at processTicksAndRejections (node:internal/process/task_queues:105:5)
          at _runTest (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/jestAdapterInit.js:949:3)
          at _runTestsForDescribeBlock (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/jestAdapterInit.js:839:13)
          at _runTestsForDescribeBlock (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/jestAdapterInit.js:829:11)
          at run (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/jestAdapterInit.js:757:3)
          at runAndTransformResultsToJestFormat (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/jestAdapterInit.js:1920:21)
          at jestAdapter (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/runner.js:101:19)
          at runTestInternal (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-runner/build/testWorker.js:272:16)
          at runTest (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-runner/build/testWorker.js:340:7)
          at Object.worker (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-runner/build/testWorker.js:494:12)

      56 |     return true
      57 |   } catch (err) {
    > 58 |     console.error(`Failed to save to localStorage (${key}):`, err)
         |             ^
      59 |
      60 |     if (err instanceof Error && err.name === "QuotaExceededError") {
      61 |       // ÂÆπÈáè„Ç®„É©„Éº„ÅÆÂ†¥Âêà„ÅØ„ÇØ„É™„Ç¢„Åó„Å¶ÂÜçË©¶Ë°å

      at error (src/lib/storage-utils.ts:58:13)
      at Object.<anonymous> (src/lib/__tests__/storage-utils.test.ts:31:35)

    console.log
      LocalStorage cleared due to quota exceeded

      at log (src/lib/storage-utils.ts:25:13)

    console.error
      Failed to read from localStorage (foo): Error: fail
          at Proxy.<anonymous> (/Users/nyanpass/source/repos/mahjong-point-manager/src/lib/__tests__/storage-utils.test.ts:39:13)
          at /Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-mock/build/index.js:305:39
          at Proxy.<anonymous> (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-mock/build/index.js:312:13)
          at Proxy.mockConstructor (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-mock/build/index.js:102:19)
          at getItem (/Users/nyanpass/source/repos/mahjong-point-manager/src/lib/storage-utils.ts:83:25)
          at Object.<anonymous> (/Users/nyanpass/source/repos/mahjong-point-manager/src/lib/__tests__/storage-utils.test.ts:41:31)
          at Promise.finally.completed (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/jestAdapterInit.js:1559:28)
          at new Promise (<anonymous>)
          at callAsyncCircusFn (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/jestAdapterInit.js:1499:10)
          at _callCircusTest (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/jestAdapterInit.js:1009:40)
          at processTicksAndRejections (node:internal/process/task_queues:105:5)
          at _runTest (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/jestAdapterInit.js:949:3)
          at _runTestsForDescribeBlock (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/jestAdapterInit.js:839:13)
          at _runTestsForDescribeBlock (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/jestAdapterInit.js:829:11)
          at run (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/jestAdapterInit.js:757:3)
          at runAndTransformResultsToJestFormat (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/jestAdapterInit.js:1920:21)
          at jestAdapter (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/runner.js:101:19)
          at runTestInternal (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-runner/build/testWorker.js:272:16)
          at runTest (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-runner/build/testWorker.js:340:7)
          at Object.worker (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-runner/build/testWorker.js:494:12)

      83 |     return localStorage.getItem(key)
      84 |   } catch (err) {
    > 85 |     console.error(`Failed to read from localStorage (${key}):`, err)
         |             ^
      86 |     return null
      87 |   }
      88 | }

      at error (src/lib/storage-utils.ts:85:13)
      at Object.<anonymous> (src/lib/__tests__/storage-utils.test.ts:41:31)

    console.log
      LocalStorage cleared due to quota exceeded

      at log (src/lib/storage-utils.ts:25:13)

    console.log
      LocalStorage usage: 0.01 KB

      at log (src/lib/storage-utils.ts:42:13)

    console.error
      Failed to save to localStorage (x): Error: bad
          at Proxy.<anonymous> (/Users/nyanpass/source/repos/mahjong-point-manager/src/lib/__tests__/storage-utils.test.ts:61:13)
          at /Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-mock/build/index.js:305:39
          at Proxy.<anonymous> (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-mock/build/index.js:312:13)
          at Proxy.mockConstructor (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-mock/build/index.js:102:19)
          at setItem (/Users/nyanpass/source/repos/mahjong-point-manager/src/lib/storage-utils.ts:55:18)
          at Object.<anonymous> (/Users/nyanpass/source/repos/mahjong-point-manager/src/lib/__tests__/storage-utils.test.ts:63:35)
          at Promise.finally.completed (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/jestAdapterInit.js:1559:28)
          at new Promise (<anonymous>)
          at callAsyncCircusFn (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/jestAdapterInit.js:1499:10)
          at _callCircusTest (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/jestAdapterInit.js:1009:40)
          at processTicksAndRejections (node:internal/process/task_queues:105:5)
          at _runTest (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/jestAdapterInit.js:949:3)
          at _runTestsForDescribeBlock (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/jestAdapterInit.js:839:13)
          at _runTestsForDescribeBlock (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/jestAdapterInit.js:829:11)
          at run (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/jestAdapterInit.js:757:3)
          at runAndTransformResultsToJestFormat (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/jestAdapterInit.js:1920:21)
          at jestAdapter (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/runner.js:101:19)
          at runTestInternal (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-runner/build/testWorker.js:272:16)
          at runTest (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-runner/build/testWorker.js:340:7)
          at Object.worker (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-runner/build/testWorker.js:494:12)

      56 |     return true
      57 |   } catch (err) {
    > 58 |     console.error(`Failed to save to localStorage (${key}):`, err)
         |             ^
      59 |
      60 |     if (err instanceof Error && err.name === "QuotaExceededError") {
      61 |       // ÂÆπÈáè„Ç®„É©„Éº„ÅÆÂ†¥Âêà„ÅØ„ÇØ„É™„Ç¢„Åó„Å¶ÂÜçË©¶Ë°å

      at error (src/lib/storage-utils.ts:58:13)
      at Object.<anonymous> (src/lib/__tests__/storage-utils.test.ts:63:35)

    console.error
      Failed to check localStorage usage: Error: fail
          at Proxy.<anonymous> (/Users/nyanpass/source/repos/mahjong-point-manager/src/lib/__tests__/storage-utils.test.ts:70:13)
          at /Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-mock/build/index.js:305:39
          at Proxy.<anonymous> (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-mock/build/index.js:312:13)
          at Proxy.mockConstructor (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-mock/build/index.js:102:19)
          at hasOwnProperty (/Users/nyanpass/source/repos/mahjong-point-manager/src/lib/storage-utils.ts:38:24)
          at Object.<anonymous> (/Users/nyanpass/source/repos/mahjong-point-manager/src/lib/__tests__/storage-utils.test.ts:72:40)
          at Promise.finally.completed (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/jestAdapterInit.js:1559:28)
          at new Promise (<anonymous>)
          at callAsyncCircusFn (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/jestAdapterInit.js:1499:10)
          at _callCircusTest (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/jestAdapterInit.js:1009:40)
          at processTicksAndRejections (node:internal/process/task_queues:105:5)
          at _runTest (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/jestAdapterInit.js:949:3)
          at _runTestsForDescribeBlock (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/jestAdapterInit.js:839:13)
          at _runTestsForDescribeBlock (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/jestAdapterInit.js:829:11)
          at run (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/jestAdapterInit.js:757:3)
          at runAndTransformResultsToJestFormat (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/jestAdapterInit.js:1920:21)
          at jestAdapter (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-circus/build/runner.js:101:19)
          at runTestInternal (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-runner/build/testWorker.js:272:16)
          at runTest (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-runner/build/testWorker.js:340:7)
          at Object.worker (/Users/nyanpass/source/repos/mahjong-point-manager/node_modules/jest-runner/build/testWorker.js:494:12)

      43 |     return totalSize
      44 |   } catch (err) {
    > 45 |     console.error("Failed to check localStorage usage:", err)
         |             ^
      46 |     return 0
      47 |   }
      48 | }

      at error (src/lib/storage-utils.ts:45:13)
      at Object.<anonymous> (src/lib/__tests__/storage-utils.test.ts:72:40)

    console.log
      LocalStorage cleared due to quota exceeded

      at log (src/lib/storage-utils.ts:25:13)

PASS src/app/__tests__/page.test.tsx
  ‚óè Console

    console.error
      Warning: An update to HomePageContent inside a test was not wrapped in act(...).
      
      When testing, code that causes React state updates should be wrapped into act(...):
      
      act(() => {
        /* fire events that update state */
      });
      /* assert on the output */
      
      This ensures that you're testing the behavior the user would see in the browser. Learn more at https://reactjs.org/link/wrap-tests-with-act
          at HomePageContent (/Users/nyanpass/source/repos/mahjong-point-manager/src/app/page.tsx:16:47)
          at Suspense
          at HomePage

      49 |       const data = await response.json()
      50 |       if (data.success) {
    > 51 |         setActiveSessions(data.data.sessions || [])
         |         ^
      52 |       }
      53 |     } catch (error) {
      54 |       console.error("Failed to fetch active sessions:", error)

      at printWarning (node_modules/react-dom/cjs/react-dom.development.js:86:30)
      at error (node_modules/react-dom/cjs/react-dom.development.js:60:7)
      at warnIfUpdatesNotWrappedWithActDEV (node_modules/react-dom/cjs/react-dom.development.js:27628:9)
      at scheduleUpdateOnFiber (node_modules/react-dom/cjs/react-dom.development.js:25547:5)
      at dispatchSetState (node_modules/react-dom/cjs/react-dom.development.js:16708:7)
      at setActiveSessions (src/app/page.tsx:51:9)

    console.error
      Warning: An update to HomePageContent inside a test was not wrapped in act(...).
      
      When testing, code that causes React state updates should be wrapped into act(...):
      
      act(() => {
        /* fire events that update state */
      });
      /* assert on the output */
      
      This ensures that you're testing the behavior the user would see in the browser. Learn more at https://reactjs.org/link/wrap-tests-with-act
          at HomePageContent (/Users/nyanpass/source/repos/mahjong-point-manager/src/app/page.tsx:16:47)
          at Suspense
          at HomePage

      49 |       const data = await response.json()
      50 |       if (data.success) {
    > 51 |         setActiveSessions(data.data.sessions || [])
         |         ^
      52 |       }
      53 |     } catch (error) {
      54 |       console.error("Failed to fetch active sessions:", error)

      at printWarning (node_modules/react-dom/cjs/react-dom.development.js:86:30)
      at error (node_modules/react-dom/cjs/react-dom.development.js:60:7)
      at warnIfUpdatesNotWrappedWithActDEV (node_modules/react-dom/cjs/react-dom.development.js:27628:9)
      at scheduleUpdateOnFiber (node_modules/react-dom/cjs/react-dom.development.js:25547:5)
      at dispatchSetState (node_modules/react-dom/cjs/react-dom.development.js:16708:7)
      at setActiveSessions (src/app/page.tsx:51:9)

    console.error
      Warning: An update to HomePageContent inside a test was not wrapped in act(...).
      
      When testing, code that causes React state updates should be wrapped into act(...):
      
      act(() => {
        /* fire events that update state */
      });
      /* assert on the output */
      
      This ensures that you're testing the behavior the user would see in the browser. Learn more at https://reactjs.org/link/wrap-tests-with-act
          at HomePageContent (/Users/nyanpass/source/repos/mahjong-point-manager/src/app/page.tsx:16:47)
          at Suspense
          at HomePage

      49 |       const data = await response.json()
      50 |       if (data.success) {
    > 51 |         setActiveSessions(data.data.sessions || [])
         |         ^
      52 |       }
      53 |     } catch (error) {
      54 |       console.error("Failed to fetch active sessions:", error)

      at printWarning (node_modules/react-dom/cjs/react-dom.development.js:86:30)
      at error (node_modules/react-dom/cjs/react-dom.development.js:60:7)
      at warnIfUpdatesNotWrappedWithActDEV (node_modules/react-dom/cjs/react-dom.development.js:27628:9)
      at scheduleUpdateOnFiber (node_modules/react-dom/cjs/react-dom.development.js:25547:5)
      at dispatchSetState (node_modules/react-dom/cjs/react-dom.development.js:16708:7)
      at setActiveSessions (src/app/page.tsx:51:9)

    console.error
      Warning: An update to HomePageContent inside a test was not wrapped in act(...).
      
      When testing, code that causes React state updates should be wrapped into act(...):
      
      act(() => {
        /* fire events that update state */
      });
      /* assert on the output */
      
      This ensures that you're testing the behavior the user would see in the browser. Learn more at https://reactjs.org/link/wrap-tests-with-act
          at HomePageContent (/Users/nyanpass/source/repos/mahjong-point-manager/src/app/page.tsx:16:47)
          at Suspense
          at HomePage

      49 |       const data = await response.json()
      50 |       if (data.success) {
    > 51 |         setActiveSessions(data.data.sessions || [])
         |         ^
      52 |       }
      53 |     } catch (error) {
      54 |       console.error("Failed to fetch active sessions:", error)

      at printWarning (node_modules/react-dom/cjs/react-dom.development.js:86:30)
      at error (node_modules/react-dom/cjs/react-dom.development.js:60:7)
      at warnIfUpdatesNotWrappedWithActDEV (node_modules/react-dom/cjs/react-dom.development.js:27628:9)
      at scheduleUpdateOnFiber (node_modules/react-dom/cjs/react-dom.development.js:25547:5)
      at dispatchSetState (node_modules/react-dom/cjs/react-dom.development.js:16708:7)
      at setActiveSessions (src/app/page.tsx:51:9)

    console.error
      Failed to fetch active sessions: TypeError: Cannot read properties of undefined (reading 'sessions')
          at sessions (/Users/nyanpass/source/repos/mahjong-point-manager/src/app/page.tsx:51:37)

      52 |       }
      53 |     } catch (error) {
    > 54 |       console.error("Failed to fetch active sessions:", error)
         |               ^
      55 |     }
      56 |   }
      57 |

      at error (src/app/page.tsx:54:15)

    console.error
      Warning: An update to HomePageContent inside a test was not wrapped in act(...).
      
      When testing, code that causes React state updates should be wrapped into act(...):
      
      act(() => {
        /* fire events that update state */
      });
      /* assert on the output */
      
      This ensures that you're testing the behavior the user would see in the browser. Learn more at https://reactjs.org/link/wrap-tests-with-act
          at HomePageContent (/Users/nyanpass/source/repos/mahjong-point-manager/src/app/page.tsx:16:47)
          at Suspense
          at HomePage

      49 |       const data = await response.json()
      50 |       if (data.success) {
    > 51 |         setActiveSessions(data.data.sessions || [])
         |         ^
      52 |       }
      53 |     } catch (error) {
      54 |       console.error("Failed to fetch active sessions:", error)

      at printWarning (node_modules/react-dom/cjs/react-dom.development.js:86:30)
      at error (node_modules/react-dom/cjs/react-dom.development.js:60:7)
      at warnIfUpdatesNotWrappedWithActDEV (node_modules/react-dom/cjs/react-dom.development.js:27628:9)
      at scheduleUpdateOnFiber (node_modules/react-dom/cjs/react-dom.development.js:25547:5)
      at dispatchSetState (node_modules/react-dom/cjs/react-dom.development.js:16708:7)
      at setActiveSessions (src/app/page.tsx:51:9)

PASS src/lib/__tests__/utils.test.ts
PASS src/lib/__tests__/socket-client.test.ts
  ‚óè Console

    console.log
      Connecting to WebSocket: http://test NODE_ENV: test

      at SocketClient.log [as connect] (src/lib/socket-client.ts:53:13)

    console.log
      Connecting to WebSocket: http://first NODE_ENV: test

      at SocketClient.log [as connect] (src/lib/socket-client.ts:53:13)

    console.log
      Connecting to WebSocket: http://test NODE_ENV: test

      at SocketClient.log [as connect] (src/lib/socket-client.ts:53:13)

    console.log
      Connecting to WebSocket: http://test NODE_ENV: test

      at SocketClient.log [as connect] (src/lib/socket-client.ts:53:13)

    console.log
      üè† Emitting join_room: { roomCode: 'ROOM1', playerId: 'P1', socketId: 'sock1' }

      at SocketClient.log [as joinRoom] (src/lib/socket-client.ts:101:13)

    console.log
      Connecting to WebSocket: http://test NODE_ENV: test

      at SocketClient.log [as connect] (src/lib/socket-client.ts:53:13)

    console.log
      Connecting to WebSocket: http://test NODE_ENV: test

      at SocketClient.log [as connect] (src/lib/socket-client.ts:53:13)

    console.log
      Connecting to WebSocket: http://test NODE_ENV: test

      at SocketClient.log [as connect] (src/lib/socket-client.ts:53:13)

    console.log
      Connecting to WebSocket: http://test NODE_ENV: test

      at SocketClient.log [as connect] (src/lib/socket-client.ts:53:13)

PASS src/app/api/__tests__/socket-route.test.ts
PASS src/lib/__tests__/solo-auth.test.ts
PASS src/schemas/__tests__/multi-utils.test.ts
PASS src/app/api/__tests__/room-create.test.ts
PASS src/app/api/solo/[gameId]/result/__tests__/route.test.ts
  ‚óè Console

    console.log
      Solo game result query: { gameId: 'x', game: null }

      at log (src/app/api/solo/[gameId]/result/route.ts:31:13)

    console.log
      Solo game result query: {
        gameId: 'g1',
        game: { id: undefined, status: 'PLAYING', players: [] }
      }

      at log (src/app/api/solo/[gameId]/result/route.ts:31:13)

    console.log
      Solo game result query: {
        gameId: 'g1',
        game: { id: 'g1', status: 'FINISHED', players: [ [Object] ] }
      }

      at log (src/app/api/solo/[gameId]/result/route.ts:31:13)

    console.log
      Processed solo results: [
        {
          playerId: '0',
          name: 'A',
          finalPoints: 27000,
          rank: 1,
          uma: 15000,
          settlement: 17000
        }
      ]

      at log (src/app/api/solo/[gameId]/result/route.ts:112:13)

PASS src/lib/__tests__/solo-score-manager.test.ts
-------------------------------------------|---------|----------|---------|---------|-----------------------------------------------------------------------------------------------------------------------
File                                       | % Stmts | % Branch | % Funcs | % Lines | Uncovered Line #s                                                                                                     
-------------------------------------------|---------|----------|---------|---------|-----------------------------------------------------------------------------------------------------------------------
All files                                  |    68.6 |    55.71 |   69.51 |   68.62 |                                                                                                                       
 app                                       |   78.02 |    51.02 |   72.22 |   78.02 |                                                                                                                       
  layout.tsx                               |     100 |      100 |     100 |     100 |                                                                                                                       
  page.tsx                                 |   76.19 |    51.02 |   70.58 |   76.19 | 40,61-62,70,86-101,138,145,210-231,343                                                                                
 app/api/admin/migrate-to-sessions         |     100 |    82.35 |     100 |     100 |                                                                                                                       
  route.ts                                 |     100 |    82.35 |     100 |     100 | 8,99,191                                                                                                              
 app/api/auth/logout                       |     100 |       50 |     100 |     100 |                                                                                                                       
  route.ts                                 |     100 |       50 |     100 |     100 | 14-33                                                                                                                 
 app/api/auth/player                       |     100 |    91.89 |     100 |     100 |                                                                                                                       
  route.ts                                 |     100 |    91.89 |     100 |     100 | 57,144,210                                                                                                            
 app/api/game/[gameId]                     |   59.18 |     42.1 |   58.33 |   58.51 |                                                                                                                       
  route.ts                                 |   59.18 |     42.1 |   58.33 |   58.51 | 151-160,184-260,308-368,387,468                                                                                       
 app/api/game/[gameId]/cancel-vote-session |     100 |    96.77 |     100 |     100 |                                                                                                                       
  route.ts                                 |     100 |    96.77 |     100 |     100 | 36                                                                                                                    
 app/api/game/[gameId]/end                 |   89.18 |    68.75 |     100 |   89.18 |                                                                                                                       
  route.ts                                 |   89.18 |    68.75 |     100 |   89.18 | 26-27,134-135                                                                                                         
 app/api/game/[gameId]/rematch             |   54.28 |     22.5 |   33.33 |   54.28 |                                                                                                                       
  route.ts                                 |   54.28 |     22.5 |   33.33 |   54.28 | 10,77,92-120,146-149,191-194,211,224-274                                                                              
 app/api/game/[gameId]/result              |     100 |    88.42 |     100 |     100 |                                                                                                                       
  route.ts                                 |     100 |    88.42 |     100 |     100 | 161,170-172,175-181,186,233                                                                                           
 app/api/game/[gameId]/riichi              |   94.82 |     90.9 |     100 |   94.64 |                                                                                                                       
  route.ts                                 |   94.82 |     90.9 |     100 |   94.64 | 49-50,140                                                                                                             
 app/api/game/[gameId]/ryukyoku            |   97.26 |    86.04 |     100 |   97.18 |                                                                                                                       
  route.ts                                 |   97.26 |    86.04 |     100 |   97.18 | 53-54                                                                                                                 
 app/api/game/[gameId]/score               |    94.2 |    88.23 |     100 |   94.11 |                                                                                                                       
  route.ts                                 |    94.2 |    88.23 |     100 |   94.11 | 59-60,155,168                                                                                                         
 app/api/game/[gameId]/start               |   79.41 |       50 |     100 |   79.41 |                                                                                                                       
  route.ts                                 |   79.41 |       50 |     100 |   79.41 | 55,66,77,166-180                                                                                                      
 app/api/game/[gameId]/vote-session        |     100 |    84.93 |     100 |     100 |                                                                                                                       
  route.ts                                 |     100 |    84.93 |     100 |     100 | 68,119-122,170-179,195-198,206-213,293                                                                                
 app/api/health                            |     100 |       50 |     100 |     100 |                                                                                                                       
  route.ts                                 |     100 |       50 |     100 |     100 | 27                                                                                                                    
 app/api/players                           |     100 |      100 |     100 |     100 |                                                                                                                       
  route.ts                                 |     100 |      100 |     100 |     100 |                                                                                                                       
 app/api/room/[roomCode]                   |     100 |      100 |     100 |     100 |                                                                                                                       
  route.ts                                 |     100 |      100 |     100 |     100 |                                                                                                                       
 app/api/room/[roomCode]/rejoin            |     100 |       95 |     100 |     100 |                                                                                                                       
  route.ts                                 |     100 |       95 |     100 |     100 | 209                                                                                                                   
 app/api/room/[roomCode]/seat-order        |     100 |    92.85 |     100 |     100 |                                                                                                                       
  route.ts                                 |     100 |    92.85 |     100 |     100 | 130                                                                                                                   
 app/api/room/create                       |     100 |      100 |     100 |     100 |                                                                                                                       
  route.ts                                 |     100 |      100 |     100 |     100 |                                                                                                                       
 app/api/room/join                         |   81.42 |    56.25 |   77.77 |   80.59 |                                                                                                                       
  route.ts                                 |   81.42 |    56.25 |   77.77 |   80.59 | 34,48,67,87-93,110,117,159,248-266                                                                                    
 app/api/score/calculate                   |     100 |    83.33 |     100 |     100 |                                                                                                                       
  route.ts                                 |     100 |    83.33 |     100 |     100 | 62                                                                                                                    
 app/api/score/patterns                    |     100 |      100 |     100 |     100 |                                                                                                                       
  route.ts                                 |     100 |      100 |     100 |     100 |                                                                                                                       
 app/api/sessions                          |   94.11 |    71.42 |     100 |   93.93 |                                                                                                                       
  route.ts                                 |   94.11 |    71.42 |     100 |   93.93 | 118-119                                                                                                               
 app/api/sessions/[sessionId]              |    57.5 |    22.72 |   33.33 |   61.11 |                                                                                                                       
  route.ts                                 |    57.5 |    22.72 |   33.33 |   61.11 | 79,97-121,140,167-168                                                                                                 
 app/api/sessions/[sessionId]/active-game  |   84.61 |    66.66 |     100 |   84.61 |                                                                                                                       
  route.ts                                 |   84.61 |    66.66 |     100 |   84.61 | 47-48                                                                                                                 
 app/api/socket                            |     100 |       50 |     100 |     100 |                                                                                                                       
  route.ts                                 |     100 |       50 |     100 |     100 | 6                                                                                                                     
 app/api/solo/[gameId]                     |     100 |     87.5 |     100 |     100 |                                                                                                                       
  route.ts                                 |     100 |     87.5 |     100 |     100 | 66                                                                                                                    
 app/api/solo/[gameId]/force-end           |   84.61 |       90 |      75 |      84 |                                                                                                                       
  route.ts                                 |   84.61 |       90 |      75 |      84 | 66,100,121-123                                                                                                        
 app/api/solo/[gameId]/reach               |   95.45 |       75 |     100 |      95 |                                                                                                                       
  route.ts                                 |   95.45 |       75 |     100 |      95 | 45                                                                                                                    
 app/api/solo/[gameId]/result              |   93.75 |    63.63 |   83.33 |   93.54 |                                                                                                                       
  route.ts                                 |   93.75 |    63.63 |   83.33 |   93.54 | 71,85                                                                                                                 
 app/api/solo/[gameId]/ryukyoku            |   97.43 |    86.66 |     100 |   97.22 |                                                                                                                       
  route.ts                                 |   97.43 |    86.66 |     100 |   97.22 | 48                                                                                                                    
 app/api/solo/[gameId]/score               |   92.59 |       80 |     100 |    92.3 |                                                                                                                       
  route.ts                                 |   92.59 |       80 |     100 |    92.3 | 36,41                                                                                                                 
 app/api/solo/create                       |   68.75 |    41.66 |      50 |   67.74 |                                                                                                                       
  route.ts                                 |   68.75 |    41.66 |      50 |   67.74 | 36,50,66-71,85-129                                                                                                    
 app/api/stats/[playerId]                  |   97.46 |    83.33 |     100 |   98.68 |                                                                                                                       
  route.ts                                 |   97.46 |    83.33 |     100 |   98.68 | 41                                                                                                                    
 app/api/websocket-status                  |      75 |       80 |     100 |      75 |                                                                                                                       
  route.ts                                 |      75 |       80 |     100 |      75 | 37-38                                                                                                                 
 app/game/[gameId]                         |       0 |        0 |       0 |       0 |                                                                                                                       
  page.tsx                                 |       0 |        0 |       0 |       0 | 3-1024                                                                                                                
 app/room/[roomCode]                       |       0 |        0 |       0 |       0 |                                                                                                                       
  page.tsx                                 |       0 |        0 |       0 |       0 | 3-689                                                                                                                 
 app/room/create                           |   49.09 |    37.03 |   31.25 |   49.09 |                                                                                                                       
  page.tsx                                 |   49.09 |    37.03 |   31.25 |   49.09 | 23-68,86-88,120-214,256,280-317                                                                                       
 app/sessions                              |       0 |        0 |       0 |       0 |                                                                                                                       
  page.tsx                                 |       0 |        0 |       0 |       0 | 3-346                                                                                                                 
 app/sessions/[sessionId]                  |       0 |      100 |       0 |       0 |                                                                                                                       
  page.tsx                                 |       0 |      100 |       0 |       0 | 3-35                                                                                                                  
 app/solo/create                           |    83.6 |    59.25 |   68.42 |   83.05 |                                                                                                                       
  page.tsx                                 |    83.6 |    59.25 |   68.42 |   83.05 | 77-78,101,109,139-192,234,302                                                                                         
 app/solo/game/[gameId]                    |       0 |        0 |       0 |       0 |                                                                                                                       
  page.tsx                                 |       0 |        0 |       0 |       0 | 3-642                                                                                                                 
 app/stats                                 |       0 |        0 |       0 |       0 |                                                                                                                       
  page.tsx                                 |       0 |        0 |       0 |       0 | 3-535                                                                                                                 
 components                                |   77.94 |    67.16 |   80.99 |   77.58 |                                                                                                                       
  AlertModal.tsx                           |     100 |      100 |     100 |     100 |                                                                                                                       
  ErrorDisplay.tsx                         |     100 |      100 |     100 |     100 |                                                                                                                       
  ForceEndConfirmModal.tsx                 |     100 |    88.88 |     100 |     100 | 33-40                                                                                                                 
  GameEndScreen.tsx                        |     100 |     87.5 |     100 |     100 | 67                                                                                                                    
  GameInfo.tsx                             |    61.9 |    51.11 |   81.81 |   60.97 | 40-48,68,72-74,95,99-101,218-220                                                                                      
  GameResult.tsx                           |   65.32 |    51.17 |   58.06 |   66.53 | 171,176,279,292,301-307,327-331,359-366,374-378,385,390-437,442-474,485-486,491-514,531-533,551,566,790,872-1037,1087 
  LazyComponents.tsx                       |     100 |      100 |     100 |     100 |                                                                                                                       
  LoadingSpinner.tsx                       |     100 |      100 |     100 |     100 |                                                                                                                       
  MenuDrawer.tsx                           |     100 |      100 |     100 |     100 |                                                                                                                       
  OptimizedImage.tsx                       |     100 |      100 |     100 |     100 |                                                                                                                       
  PlayerStatus.tsx                         |    93.1 |    85.71 |   86.66 |    92.3 | 151-235                                                                                                               
  PointAnimation.tsx                       |   95.31 |    89.28 |     100 |   95.16 | 86,102,130                                                                                                            
  QRCodeModal.tsx                          |     100 |      100 |     100 |     100 |                                                                                                                       
  RyukyokuForm.tsx                         |      96 |      100 |    92.3 |      95 | 95                                                                                                                    
  ScoreInputForm.tsx                       |   79.66 |    74.11 |   92.59 |   78.57 | 148-151,162,168,170,176,182,188,195,207,222-223,235-239,246-248,275-278                                               
  SessionHistoryModal.tsx                  |     100 |      100 |     100 |     100 |                                                                                                                       
  SessionHistoryTable.tsx                  |   94.87 |    70.45 |    92.3 |   94.87 | 81,119                                                                                                                
  VotingProgress.tsx                       |   97.36 |    95.45 |     100 |     100 | 87                                                                                                                    
  WebSocketDebug.tsx                       |       0 |        0 |       0 |       0 | 3-191                                                                                                                 
 components/common                         |   87.26 |    82.11 |     100 |   88.19 |                                                                                                                       
  BaseRyukyokuForm.tsx                     |     100 |      100 |     100 |     100 |                                                                                                                       
  BaseScoreInputForm.tsx                   |    87.3 |    79.43 |     100 |    87.5 | 68,171-172,178,184,190,240-242,249-251,314-317                                                                        
  index.ts                                 |       0 |      100 |     100 |       0 | 3-4                                                                                                                   
 components/solo                           |       0 |        0 |       0 |       0 |                                                                                                                       
  SoloRyukyokuForm.tsx                     |       0 |      100 |       0 |       0 | 3-12                                                                                                                  
  SoloScoreForm.tsx                        |       0 |        0 |       0 |       0 | 3-44                                                                                                                  
 components/ui                             |     100 |      100 |     100 |     100 |                                                                                                                       
  button.tsx                               |     100 |      100 |     100 |     100 |                                                                                                                       
 contexts                                  |   69.76 |    29.72 |      70 |   69.76 |                                                                                                                       
  AuthContext.tsx                          |   69.76 |    29.72 |      70 |   69.76 | 66-84,105-106,124,139-144,152-158,180-184,195-196,201,224,230-242                                                     
 hooks                                     |   87.09 |    62.74 |    87.8 |   87.84 |                                                                                                                       
  usePerformanceMonitor.ts                 |   61.29 |       40 |      50 |   62.96 | 33,38,48-50,60-69                                                                                                     
  useSocket.ts                             |   92.25 |    77.41 |   96.96 |    92.2 | 177-188                                                                                                               
 lib                                       |   72.72 |    63.11 |      81 |   72.51 |                                                                                                                       
  auth-fallback.ts                         |   72.72 |     62.5 |      75 |   71.42 | 15-34,52,72-73,83                                                                                                     
  auth.ts                                  |     100 |      100 |     100 |     100 |                                                                                                                       
  error-handler.ts                         |   67.92 |    66.15 |      76 |   67.92 | 38,52-64,76-88,100-108,148-153,206-219,238-243,283,298,302,306,310,314-340                                            
  point-manager.ts                         |   72.11 |    64.88 |   77.77 |   72.07 | 166,297,399,431-434,451-452,462-588,702-722,748,817,878-937,1027-1032,1109-1125                                       
  prisma.ts                                |     100 |       75 |     100 |     100 | 13                                                                                                                    
  rematch-service.ts                       |   77.31 |     42.5 |     100 |   77.31 | 87-105,264-281                                                                                                        
  score.ts                                 |     100 |    94.23 |     100 |     100 | 71-75                                                                                                                 
  socket-client.ts                         |   84.48 |    38.09 |   90.32 |   84.21 | 13,35-41,47,74,78,82                                                                                                  
  socket.ts                                |   87.09 |       70 |   95.23 |   88.43 | 154-159,223,251-252,318-328,375,444-454,477-478                                                                       
  socketjs.js                              |       0 |        0 |       0 |       0 | 2-324                                                                                                                 
  storage-utils.ts                         |   91.89 |      100 |     100 |   91.89 | 27,67-71                                                                                                              
  utils.ts                                 |     100 |       75 |     100 |     100 | 21                                                                                                                    
  vote-analysis.ts                         |   96.66 |       92 |     100 |   96.42 | 129,147                                                                                                               
  vote-globals.ts                          |     100 |    66.66 |     100 |     100 | 30-33                                                                                                                 
 lib/solo                                  |   83.58 |    64.44 |   93.75 |   84.11 |                                                                                                                       
  auth.ts                                  |   89.47 |       75 |     100 |   89.47 | 69-70                                                                                                                 
  score-manager.ts                         |   76.13 |    53.84 |   84.61 |    77.9 | 46,50,111-122,157-174,220,260,271,396-397                                                                             
  solo-point-manager.ts                    |   86.03 |     68.1 |   96.96 |   86.11 | 170,427-430,447-448,458-498,526-527,539-548,719,822-829,842-849                                                       
 schemas                                   |   74.32 |    89.23 |   93.75 |   82.63 |                                                                                                                       
  common.ts                                |      75 |    82.75 |      80 |   89.74 | 139-145                                                                                                               
  index.ts                                 |   50.84 |       90 |     100 |   53.57 | 17-37,196-205                                                                                                         
  multi.ts                                 |   67.85 |       90 |   77.77 |   94.59 | 74,137                                                                                                                
  solo.ts                                  |   95.12 |      100 |     100 |   98.27 | 337                                                                                                                   
 store                                     |     100 |      100 |     100 |     100 |                                                                                                                       
  useAppStore.ts                           |     100 |      100 |     100 |     100 |                                                                                                                       
-------------------------------------------|---------|----------|---------|---------|-----------------------------------------------------------------------------------------------------------------------

Test Suites: 88 passed, 88 total
Tests:       956 passed, 956 total
Snapshots:   0 total
Time:        3.167 s
Ran all test suites.
